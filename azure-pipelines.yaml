pool:
  vmImage: 'macOS-10.13'

steps:
- script: |
    echo "installing miniconda"
    curl -L https://repo.continuum.io/miniconda/Miniconda3-3.7.0-Linux-x86_64.sh > ~/miniconda.sh
    bash ~/miniconda.sh -b -p ~/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    source ~/miniconda/bin/activate root

    echo "configure miniconda"
    conda config --add channels defaults
    conda config --add channels conda-forge
    conda config --set show_channel_urls true
    conda install -y conda-build conda-verify python=3.6

    echo "osx build metadata"
    cat osxmeta.yaml

    echo "build"
    conda build -m osxmeta.yaml recipes/gfortran_build || exit 1
    conda build -m osxmeta.yaml recipes/libgfortran || exit 1
    conda build -m osxmeta.yaml recipes/gfortran || exit 1
