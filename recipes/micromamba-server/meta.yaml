{% set version = "1.4.2" %}
{% set build_num = 0 %}

package:
  name: micromamba-server
  version: {{ version }}

source:
  url: https://github.com/mamba-org/mamba/archive/refs/tags/micromamba-{{ version }}.tar.gz
  sha256: dce034908d02d991c5e9aadeb9d01f139d027ba199aaeb1d47d543e3f24895d1

build:
  number: {{ build_num }}
  string: {{ build_num }}
  skip: true  # [win]
  ignore_run_exports_from:
    - libcurl
    - libarchive-minimal-static
    - reproc-cpp
    - openssl
    - spdlog
    - fmt
    - {{ compiler('c') }}         # [linux]
    - {{ compiler('cxx') }}       # [linux]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - cmake
    - ninja
  host:
    - cli11 >=2.2,<3
    - cpp-expected
    - nlohmann_json
    - spdlog
    - fmt
    - yaml-cpp-static
    - libcurl >=7.88.1,<8
    - libcurl-static >=7.88.1,<8
    - xz-static
    - libssh2-static
    - libarchive-minimal-static
    - krb5-static
    - libsolv-static
    - openssl            {{ openssl }}
    - libopenssl-static  {{ openssl }}
    - zstd-static
    - zlib
    - libnghttp2-static
    - lz4-c-static
    - reproc-static
    - reproc-cpp
    - reproc-cpp-static

  run_constrained:
    # micromamba and micromamba-server both install as `micromamba` binary
    - micromamba <=0.0.0

test:
  commands:
    - test -f $PREFIX/bin/micromamba
    - micromamba server --help
    - export TMPDIR="${TMPDIR:-/tmp}"

about:
  home: https://github.com/mamba-org/mamba
  license_file:
    - LICENSE
    - CURL_LICENSE.txt
    - LIBARCHIVE_LICENSE.txt
    - KRB5_LICENSE.txt
    - LIBSOLV_LICENSE.txt
    - LIBOPENSSL_LICENSE.txt
    - LIBOPENSSL_3_LICENSE.txt
    - CLI11_LICENSE.txt
    - NLOHMANN_JSON_LICENSE.txt
    - ZSTD_LICENSE.txt
    - LIBLZ4_LICENSE.txt
    - C_ARES_LICENSE.txt
    - LIBEV_LICENSE.txt
    - LIBNGHTTP2_LICENSE.txt
    - REPROC_LICENSE.txt
    - SPDLOG_LICENSE.txt
    - FMT_LICENSE.txt
    - TL_EXPECTED_LICENSE.txt
  license: BSD-3-Clause AND MIT AND OpenSSL
  license_family: BSD
  summary: Micromamba is a tiny version of mamba, the fast conda package installer.
  dev_url: https://github.com/mamba-org/mamba

extra:
  recipe-maintainers:
    - wolfv
