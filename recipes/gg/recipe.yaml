context:
  name: gg
  version: "0.29.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/gulbanana/gg/archive/refs/tags/v${{ version }}.tar.gz
  sha256: bf06f189ccf7df091fdc3a5111916bae42ae236ab9cee24439182ca24db64a81

build:
  number: 0
  script:
    - if: unix
      then:
        - TARGET=${TARGET:-$(rustc -vV | grep "host:" | awk '{print $2}')}
        - npm install
        - npm run tauri build -- --no-bundle
        - mkdir -p ${{ PREFIX }}/bin && cp ${{ SRC_DIR }}/src-tauri/target/${TARGET}/release/gg ${{ PREFIX }}/bin
        - cd ${{ SRC_DIR }}/src-tauri && cargo-bundle-licenses --format yaml --output ../THIRDPARTY.yml
    - if: win
      then:
        - cmd /c "npm install"
        - cmd /c "npm run tauri build -- --no-bundle"
        - cmd /c "if not exist %PREFIX%\bin\ mkdir %PREFIX%\bin\"
        - cp %SRC_DIR%\src-tauri\target\release\gg.exe %PREFIX%\bin
        - cd %SRC_DIR%\src-tauri && cargo-bundle-licenses --format yaml --output ../THIRDPARTY.yml

requirements:
  build:
    - ${{ compiler('rust') }}
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - nodejs
    - cargo-bundle-licenses
    - if: linux
      then:
        - pkg-config
        - make
  host:
    - if: linux
      then:
        - zlib
        - glib
        - pango
        - cairo
        - fontconfig
        - libsoup
        - gtk3
        - expat
        - xorg-xorgproto
        - webkit2gtk4.1

tests:
  - script:
      - if: unix
        then: "gg --version"
      - if: win
        then: "gg.exe --version"

about:
  homepage: https://github.com/gulbanana/gg
  summary: GG - Gui for JJ
  description: |
    GG is a GUI for the version control system Jujutsu. It takes advantage 
    of Jujutsu's composable primitives to present an interactive view of 
    your repository. Just imagine: what if you were always in the middle 
    of an interactive rebase, but this was actually good?
  license: Apache-2.0
  license_file: LICENSE
  repository: https://github.com/gulbanana/gg

extra:
  recipe-maintainers:
    - haecker-felix
    - Hofer-Julian
