context:
  name: pgadmin4
  version: "9.2"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://ftp.postgresql.org/pub/pgadmin/pgadmin4/v${{ version }}/source/pgadmin4-${{ version }}.tar.gz
  sha256: 3b41fd0ec898d474c4166a6aa3fe545ece0e3d0faf99a2ede7393331e41fc125
  patches:
    - patches/dbg-runtest.py.patch

build:
  number: 0
  python:
    entry_points:
      - pgadmin4=pgadmin4.pgAdmin4:main
      - pgadmin4-cli=pgadmin4.setup:main

requirements:
  build:
    - ${{ "m2-" if not unix else "" }}make
  host:
    - nodejs
    - python
    # - postgresql
    - yarn
    - if: python >= 3.12
      then:
        - setuptools 75.*
  run:
    - if: python <= 3.8
      then:
        - authlib 1.3.*
        - flask 3.0.*
        - pytz 2024.*
        - qrcode 7.*
        - Werkzeug 3.0.*
      else:
        - authlib 1.4.*
        - flask 3.1.*
        - pytz 2025.*
        - qrcode 8.*
        - Werkzeug 3.1.*

    - if: python <= 3.9
      then:
        - flask-security-too 5.4.*
        - wtforms 3.1.*
      else:
        - flask-security-too 5.5.*
        - wtforms 3.2.*

    - if: not unix
      then: pywinpty 2.0.*

    - azure-identity ==1.19.0
    - azure-mgmt-rdbms ==10.1.0
    - azure-mgmt-resource ==23.2.0
    - azure-mgmt-subscription ==3.1.1
    - bcrypt 4.2.*
    - boto3 1.36.*
    - cryptography 44.0.*
    - flask-Babel 4.0.*
    - flask-Compress 1.*
    - flask-Login 0.*
    - flask-Mail 0.*
    - flask-Migrate 4.*
    - flask-Paranoid 0.*
    - flask-SocketIO 5.5.*
    - flask-SQLAlchemy 3.1.*
    - flask-WTF 1.2.*
    - google-api-python-client 2.*
    - google-auth-oauthlib ==1.2.1
    - jsonformatter =0.3.4
    - python-gssapi 1.9.*
    - keyring 25.*
    - ldap3 2.*
    - libgravatar 1.0.*
    - nodejs
    - passlib 1.*
    - psutil 6.1.*
    - psycopg ==3.2.4
    - pyotp 2.*
    - python
    - python-dateutil 2.*
    - python-gssapi 1.9.*
    - SQLAlchemy 2.*
    - sqlparse 0.*
    - speaklater 1.*
    - sshtunnel 0.*
    - typer 0.15.*
    - urllib3 1.26.*
    - user-agents ==2.2.0

tests:
  - package_contents:
      # bin:
      #   - pgadmin4
      #   - pgadmin4-cli
  - script:
      # - pgadmin4 --help
      - bash test.sh
    requirements: { run: [postgresql 17.*, python, testscenarios] }
    files: { source: [Makefile, web/], recipe: [test.sh, testing/] }

about:
  homepage: https://github.com/pgadmin-org/pgadmin4
  summary: 'pgAdmin 4 is a rewrite of the popular pgAdmin3 management tool for the PostgreSQL'
  description: |
    pgAdmin is the most popular and feature rich Open Source administration and
    development platform for PostgreSQL, the most advanced Open Source database in the world.
  license: PostgreSQL
  license_file: LICENSE
  documentation: https://www.pgadmin.org/
  repository: https://github.com/pgadmin-org/pgadmin4

extra:
  recipe-maintainers:
    - MementoRC
