{% if name_suffix is not defined %}
{% set name_suffix = "3.8" %}
{% endif %}
{% set version = "22.3.0" %}
{% set mx_version = "6.9.7" %}

package:
  name: "graalpy"
  version: {{ version }}

# download graalpython and the mx build tool
source:
  - url: https://github.com/graalvm/mx/archive/refs/tags/{{ mx_version }}.zip
    sha256: 6719145418c9846fb75686190359c69018ac5e61af113aba35e8542fdf09e09c
    folder: mx
  - url: https://github.com/oracle/graal/archive/refs/tags/vm-ce-{{ version }}.zip
    sha256: 9b714747fbff0b9f477a102a22e6558f697322d8fa89b1ac9956938d3afb3b87
    folder: graal
  - url: https://github.com/oracle/graalpython/archive/refs/tags/vm-ce-{{ version }}.zip
    sha256: 72ad9a6e8d8283425768c2838d9f360a42eb1dc6096d0efe44464f4fd5c0982c
    folder: graalpython

build:
  number: 0
  skip: true  # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - python >=3.8
    - make
    - patch
    - zlib
    - git
    - curl
    - cmake
  host:
    - zlib
  run:
    - zlib
  run_constrained:
    - python {{ name_suffix }}.* *_{{ "".join(version.split(".")[:2]) }}_graalpy

test:
  commands:
    - graalpy --help
    - graalpy -c "import platform; print(platform._sys_version())"
    - graalpy -m venv --help

about:
    home: http://graalvm.org/python
    license: UPL-1.0
    license_file: LICENSE_GRAALPY.txt
    summary: >
        GraalPy is a high-performance Python implementation on GraalVM. See
        https://conda-forge.org/blog/posts/2020-03-10-pypy for more information
        about using it in conda, replacing PyPy/pypy/pp with GraalPy/graalpy/gp
        in commands.

extra:
  recipe-maintainers:
    - timfel
    - msimacek
