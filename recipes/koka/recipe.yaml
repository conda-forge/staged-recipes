context:
  version: "3.2.2"

package:
  name: koka
  version: ${{ version }}

source:
  - if: target_platform == 'linux-arm64'
    then:
      url: https://github.com/koka-lang/koka/releases/download/v${{ version }}/koka-v${{ version }}-linux-arm64.tar.gz
      sha256: 8a5be24d591097bf71405f068b9bb4e1a9e94a71004d2ef63c8fef892d8b2ec0
  - if: target_platform == 'linux-64'
    then:
      url: https://github.com/koka-lang/koka/releases/download/v${{ version }}/koka-v${{ version }}-linux-x64.tar.gz
      sha256: 484c56fdf4c1b4b3fd1dc7711f39141f1b3892d2f93e414d1d066887e7d0b3e2
  - if: target_platform == 'osx-arm64'
    then:
      url: https://github.com/koka-lang/koka/releases/download/v${{ version }}/koka-v${{ version }}-macos-arm64.tar.gz
      sha256: e7ee1b42fdafa7c3c08e29eb65f61c69f7d906141998e0e7e6a6b9e232441018
  - if: target_platform == 'win-64'
    then:
      url: https://github.com/koka-lang/koka/releases/download/v${{ version }}/koka-v${{ version }}-windows-x64.tar.gz
      sha256: 6c5dadeee09a27acb43a7c63f6b3dcdf0e464d850260e5d869bfaf1f1583e93c
  - url: https://github.com/koka-lang/koka/archive/refs/tags/v${{ version }}.tar.gz
    sha256: 61203d5970ad58cd62166028ad9c4193af67af78c75f7006a602826b47de3133
    target_directory: src

build:
  number: 0
  skip:
    - osx
  script: build.py

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - python
  host:
    - gmp

tests:
  - script:
      - koka --version

about:
  homepage: https://koka-lang.github.io/koka/doc/index.html
  summary: Koka is a strongly typed functional-style language with effect types and handlers.
  description: |
    Koka is a strongly typed functional-style language with effect types and handlers.
    
    * The core of Koka consists of a small set of well-studied language features, like first-class functions,
      a polymorphic type- and effect system, algebraic data types, and effect handlers. Each of these is
      composable and avoid the addition of “special” extensions by being as general as possible.
    * Koka tracks the (side) _effects_ of every
      function in its type, where pure and effectful computations are
      distinguished. The precise effect typing gives Koka _rock-solid
      semantics_ backed by well-studied category theory, which makes Koka
      particularly easy to reason about for both humans and compilers.
    * _Effect handlers_ let you define advanced control abstractions,
      like exceptions, async/await, or probabilistic programs,
      as a user library in a typed and composable way.
    * [Perceus](https://koka-lang.github.io/koka/doc/book.html#why-perceus) is an advanced compilation method for reference counting.
      Together with [evidence passing][evidence], this lets Koka compile directly to C code _without needing
      a garbage collector or runtime system_.
      Perceus also performs [reuse analysis](https://koka-lang.github.io/koka/doc/book.html#why-fbip) and optimizes
      functional-style programs to use in-place updates when possible.

  license: Apache-2.0
  license_file: LICENSE
  documentation: https://koka-lang.github.io/koka/doc/book.html
  repository: https://github.com/simplejson/simplejson

extra:
  recipe-maintainers:
    - remimimimimi
