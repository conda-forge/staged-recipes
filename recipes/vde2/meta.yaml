{% set name = "vde2" %}
{% set version = "2.3.2" %}
package:
  name: {{ name|lower }}
  version: {{ version }}
source:
  url: https://downloads.sourceforge.net/project/vde/vde2/{{ version }}/vde2-{{ version }}.tar.bz2
  sha256: cbea9b7e03097f87a6b5e98b07890d2275848f1fe4b9fcda77b8994148bc9542
  patches:
    # See patches/README.md for explaination of why there are so many
    - ./patches/0001-tunctl-g-group-permission-and-n-added-TUN-instead-of.patch
    - ./patches/0002-Initial-import-for-vde_router-code.patch
    - ./patches/0003-Removed-erroneously-added-vde_router-should-have-bee.patch
    - ./patches/0004-Reverted-makefile-changes-due-to-wrong-path-commit.patch
    - ./patches/0005-Merged-from-branch-vde-router-r520-r541.patch
    # This is a binary patch of a tarball they had in their source repo, breaks conda-build
    #- ./patches/0006-vde-contiki-support-IP-address-assignment-by-env-var.patch
    - ./patches/0007-Vde_router.patch
    - ./patches/0008-Should-fix-sf-bug-3511034-return-value-for-vde_send-.patch
    - ./patches/0009-some-bugfixes-including-3548041.patch
    - ./patches/0010-Several-BugFixes-see-bug-reports-from-accounts.patch
    - ./patches/0011-Closes-sourceforge-3603894-3603897.patch
    - ./patches/0012-Fixed-encryption-decryption-lenght.patch
    - ./patches/0013-Added-support-for-BIONIC-libc-to-allow-compilation-o.patch
    - ./patches/0014-new-hash-function.patch
    - ./patches/0015-Bugfix-sigsegv-when-a-new-client-got-plugged-in-on-a.patch
    - ./patches/0016-wirefilter-N-missing-in-getopt-s-optstring.patch
    - ./patches/0017-allow-pipes-on-stdin-for-daemonized-switches.patch
    - ./patches/0018-vde_vxlan-initial-release.patch
    - ./patches/0019-Add-format-string-to-fprintf-calls.patch
    - ./patches/0020-Clean-up-unused-variables.patch
    - ./patches/0021-In-2014-I-think-we-can-stop-trying-to-outsmart-the-c.patch
    - ./patches/0022-Add-missing-headers-in-vde_router-Makefile.am.patch
    - ./patches/0023-Add-missing-format-string-in-snprintf.patch
    - ./patches/0024-Add-missing-source-files-in-vde_vxlan-Makefile.am.patch
    - ./patches/0025-Enable-vde_over_ns-when-header-is-present.patch
    - ./patches/0026-vde_autolink-Add-missing-null-entry-in-getopt_long-a.patch
    - ./patches/0027-dpipe-Fixed-error-checking-for-setpgrp-.-This-functi.patch
    - ./patches/0028-vde_router-add-config.h-header-file-to-sources-so-th.patch
    - ./patches/0029-Remove-debugging-macros.patch
    - ./patches/0030-vde_switch-min-packet-length-enforced.patch
    - ./patches/0031-VDE-Cryptcab-new-version.patch
    - ./patches/0032-configure-do-not-test-for-CXX-it-s-not-needed.patch
    - ./patches/0033-Fix-description-for-vlan-delport-command.patch
    - ./patches/0034-Silence-compiler-warning-about-implicit-type.patch
    - ./patches/0035-Generate-chacha-key-with-correct-size.patch
    - ./patches/0036-Read-chacha-key-with-correct-size.patch
    - ./patches/0037-Fix-typo-in-error-message.patch
    - ./patches/0038-Added-missing-include-github-issue-10.patch
    - ./patches/0039-Fixed-typo-in-include-guard-github-issue-7.patch
    - ./patches/0040-removed-unused-variables-github-issue-8.patch
    - ./patches/0041-Fixed-missing-return-value-github-issue-9.patch
    - ./patches/0042-Fixed-memcpy-destination-pointer-overflow-in-vde_rou.patch
    - ./patches/0043-fixed-a-few-more-compiler-warnings.patch
    - ./patches/0044-fstp-Add-static-to-inline-functions.patch
    - ./patches/0045-build-Fix-parallel-make.patch
    - ./patches/0046-configure-Check-for-wolfSSL-instead-of-OpenSSL.patch
    - ./patches/0047-vde_switch-add-nostdin-flag-to-allow-stdin-to-be-clo.patch
    - ./patches/0048-libvdeplug.c-fix-potential-misalignment-problem-for-.patch
    # This is a binary patch of a tarball they had in their source repo, breaks conda-build
    #- ./patches/0049-Removed-contiki-support-obsolete.patch
    - ./patches/0050-Removed-libvirt-support-obsolete.patch
    - ./patches/0051-Removed-kvde_switch-obsolete.patch
    - ./patches/0052-Fixed-configure.ac-obsolete-deprecated-entries.patch
    - ./patches/0053-Removed-slirpvde-code-deprecated.patch
    - ./patches/0054-Removed-old-deprecated-modules.patch
    - ./patches/0055-Fixed-warnings.patch
    - ./patches/0056-use-module-for-libraries-only-closes-PR-24.patch
    - ./patches/0057-vdetaplib-man-page-fix-typos.patch
    - ./patches/0058-doc-README-slirpvde-and-vxlan-replacement-by-vdeplug.patch
    - ./patches/0059-vde_plug-Removed-kvde-IPN-support.patch
    - ./patches/0060-In-vde_switch-retry-send-when-it-returns-ENOBUFS-on-.patch
    - ./patches/0062-Add-CI-GitHub-Actions.patch
    - ./patches/0061-configure.ac-Downgrade-autoconf-from-2.71-to-2.59.patch
build:
  number: 61
  skip: True  # [win]
requirements:
  build:
    # If your project compiles code (such as a C extension) then add the required compilers as separate entries here.
    # Compilers are named 'c', 'cxx' and 'fortran'.
    - {{ compiler('c') }}
    - autoconf
    - automake
    - libtool
    - make
  host:
    - libpcap
    - wolfssl
# XXX Add some tests!
#test:
#  # Some packages might need a `test/commands` key to check CLI.
#  # List all the packages/modules that `run_test.py` imports.
#  imports:
#    - simplejson
#    - simplejson.tests
#  # For python packages, it is useful to run pip check. However, sometimes the
#  # metadata used by pip is out of date. Thus this section is optional if it is
#  # failing.
#  requires:
#    - pip
#  commands:
#    - pip check
about:
  home: https://github.com/virtualsquare/vde-2
  # XXX double check the licenses, there are varying ones depending on which part of the repo
  license: GPL-2.0-only
  license_family: GPL
  license_file: 
      - COPYING
      - COPYING.libvdeplug
  summary: 'Virtual Distributed Ethernet'
  description: |
    Components of the VDE architecture:
    - VDE switches: virtual counterpart of ethernet switches.
    - VDE cables: virtual counterpart of a crossed-cable used to connect two switches.

    - VDE 2 includes:
    - switch management both from console and from a "unix socket terminal"
    - VLAN 801.1q *almost* compatible
    - FSTP (fast spanning tree) already incomplete and currently not tested for 802.1d/w/s
      compatibility. under development. (vde_switch must be compiled with the FSTP flag on)

    Using VDE:
    - All units connected to the VDE see each other as they were on a real ethernet.
    - A real Linux box can be connected to the VDE using a tap interface (TUNTAP)  
      (packets can be further routed using standard linux methods). 
    - It is possible to join two VDE switches -- also running on different
      real conputers -- using virtual VDE cables
    - UML (user-mode-linux) virtual machines can be connected to the VDE
    - MPS (MIPS emulated machines (c) Morsiani/Davoli) can be connected 
      to the virtual VDE.

    Examples of VDE uses:
    - With VDE it is possible to create a virtual network of UML machines running
      on several real computer
    - VDE can be used to create tunnels (even crossing masquerated networks)
    - VDE can provide mobility support. Changing a VDE cable with another does not
      affect the communications in place. The new VDE cable can use a completely 
      different path on the real net. VDE supports also multiple concurrent VDE cables
      between a pair of VDE-switches during the hand-off. This eliminates when possible
      hich-ups of communications due to hand-offs.
  dev_url: https://github.com/virtualsquare/vde-2
extra:
  recipe-maintainers:
    - timsnyder

