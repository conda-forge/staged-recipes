From 794fc365a2f3f236800ca7d00b296eb7370085e7 Mon Sep 17 00:00:00 2001
From: Ryan Schmidt <git@ryandesign.com>
Date: Wed, 2 Oct 2019 00:00:19 -0500
Subject: [PATCH 35/62] Generate chacha key with correct size

---
 src/vde_cryptcab/vde_cryptcab_client.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/vde_cryptcab/vde_cryptcab_client.c b/src/vde_cryptcab/vde_cryptcab_client.c
index 1bf1060b1..7b6cd4886 100644
--- a/src/vde_cryptcab/vde_cryptcab_client.c
+++ b/src/vde_cryptcab/vde_cryptcab_client.c
@@ -109,9 +109,9 @@ rcv_challenge(struct datagram *pkt, struct peer *p)
 			keyname + strlen("/tmp/"),
 			strlen(keyname) - strlen("/tmp/") - strlen(".key"));
 
-	memcpy(ret->key,key,16);
-	memcpy(ret->iv,iv,8);
-	if (write(od,key,16) < 0 || write(od,iv,8) < 0) {
+	memcpy(ret->key,key,CHACHA_MAX_KEY_SZ);
+	memcpy(ret->iv,iv,CHACHA_IV_BYTES);
+	if (write(od,key,CHACHA_MAX_KEY_SZ) < 0 || write(od,iv,CHACHA_IV_BYTES) < 0) {
 		perror("Could not write chacha key");
 		goto failure;
 	}
-- 
2.35.0

