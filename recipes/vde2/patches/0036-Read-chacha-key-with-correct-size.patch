From 65a3277bfee97eff1f8ea31e5b93dea2da0ae436 Mon Sep 17 00:00:00 2001
From: Ryan Schmidt <git@ryandesign.com>
Date: Wed, 2 Oct 2019 00:03:23 -0500
Subject: [PATCH 36/62] Read chacha key with correct size

---
 src/vde_cryptcab/vde_cryptcab_server.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/vde_cryptcab/vde_cryptcab_server.c b/src/vde_cryptcab/vde_cryptcab_server.c
index 6624c3cdd..668f61c98 100644
--- a/src/vde_cryptcab/vde_cryptcab_server.c
+++ b/src/vde_cryptcab/vde_cryptcab_server.c
@@ -258,8 +258,8 @@ rcv_login(struct datagram *pkt, char *pre_shared)
 	sync();
 	usleep(10000);	
 	if (((fd = open (filename, O_RDONLY)) == -1)||
-			((read (fd, pkt->orig->key, 16)) == -1) ||
-			((read (fd, pkt->orig->iv, 8)) == -1) ){
+			((read (fd, pkt->orig->key, CHACHA_MAX_KEY_SZ)) == -1) ||
+			((read (fd, pkt->orig->iv, CHACHA_IV_BYTES)) == -1) ){
 		perror ("chacha.key open error");
 		deny_access(pkt->orig);
 		return;
-- 
2.35.0

