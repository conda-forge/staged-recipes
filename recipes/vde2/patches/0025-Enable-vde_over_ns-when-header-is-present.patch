From 1596fa444822010813af3b2948e95e3d7739d353 Mon Sep 17 00:00:00 2001
From: Ludovico Gardenghi <lu@dovi.co>
Date: Sun, 12 Oct 2014 21:12:39 +0000
Subject: [PATCH 25/62] Enable vde_over_ns when header is present. Remove
 unused variable in vde_over_ns.

---
 configure.ac          | 3 ++-
 src/vde_over_ns/dns.c | 3 +--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/configure.ac b/configure.ac
index 76024c49f..c8f6d3257 100644
--- a/configure.ac
+++ b/configure.ac
@@ -45,7 +45,8 @@ AC_CHECK_HEADERS([syslimits.h sys/syslimits.h])
 AC_CHECK_HEADERS([openssl/blowfish.h], [],
   [add_cryptcab_support=no ; warn_cryptcab=yes])
 
-AC_CHECK_HEADERS([sysexits.h], [],
+AC_CHECK_HEADERS([sysexits.h],
+  [add_over_ns_support=yes],
   [add_over_ns_support=no ; warn_over_ns=yes])
 
 # Checks for typedefs, structures, and compiler characteristics.
diff --git a/src/vde_over_ns/dns.c b/src/vde_over_ns/dns.c
index 29cb2a43b..f07dcd480 100644
--- a/src/vde_over_ns/dns.c
+++ b/src/vde_over_ns/dns.c
@@ -431,11 +431,10 @@ dns_getpktsize(const struct dnspkt *pkt)
 unsigned char *dns_constructpacket (struct dnspkt *pkt, int *l)
 {
    static unsigned char *buf, *ptr;
-   int len, *offsets, qdcount, ancount, i;
+   int len, *offsets, qdcount, i;
    struct rr *list;
    
    qdcount = _get_listlen(pkt->query);
-   ancount = _get_listlen(pkt->answer);
 
    len = dns_getpktsize(pkt);
    ptr = buf = malloc(len);
-- 
2.35.0

