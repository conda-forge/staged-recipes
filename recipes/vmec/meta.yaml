{% set name = "vmec" %}
{% set version = "0.0.5" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/hiddenSymmetries/VMEC2000/archive/refs/tags/v{{ version }}.tar.gz
  sha256: 6ded2f63c21f3cffd8252e4d2544fef29b07f04ca8e9525f45e9481ec35cefca

build:
  number: 0
  skip: True  # [win or py<37]
  script:
    - mv {{ SRC_DIR }}/cmake/machines/conda.json {{ SRC_DIR }}/cmake_config_file.json
    - "{{ PYTHON }} -m pip install . -v"
  run_exports:
    - f90wrap
    - hdf5
    - netcdf4
    - netcdf-fortran
    - scalapack   
    - libblas
    - liblapack

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - {{ compiler('fortran') }}
    - {{ mpi }}
    - cmake
    - ninja
    - f90wrap
    - python
    - scikit-build
    - hdf5
    - netcdf4
    - netcdf-fortran
  host:
    - python
    - pip
    - {{ mpi }}
    - scikit-build
    - numpy >=1.19
    - f90wrap
    - hdf5
    - netcdf4
    - netcdf-fortran
    - scalapack
    - libblas
    - liblapack
  run:
    - python
    - {{ pin_compatible('numpy') }}
    - {{ mpi }}
    - f90wrap
    - hdf5
    - netcdf4
    - netcdf-fortran
    - scalapack
    - libblas
    - liblapack

test:
  imports:
    - vmec

about:
  home: https://github.com/hiddensymmetries/vmec2000
  summary: "Python extension for VMEC"
  license: MIT
  license_family: MIT
  license_file: LICENSE
  description: |
    VMEC is a popular magneto-hydrodynamics (MHD) equilibrium solver. This conda package 
    includes VMEC and its python extension
  doc_url: https://hiddensymmetries.github.io/VMEC2000/
  dev_url: https://github.com/hiddensymmetries/vmec2000

extra:
  recipe-maintainers:
    - mbkumar
    - landreman
