context:
  name: "nnlojet"
  version: "1.0.2"

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://nnlojet.hepforge.org/nnlojet-v${{ version }}.tar.gz
  sha256: 908ea09a8c2a30f03995d8279a274e535833e2b44476be7de7ab9b5762828681

build:
  skip:
    - win
  number: 0
  script:
    env:
      BASIC_ARGS: |
        -DCMAKE_BUILD_TYPE=Release

    content:
      # Get an updated config.sub and config.guess
      - cmake ${CMAKE_ARGS} -DCMAKE_INSTALL_PREFIX="${PREFIX}" -S . -B build
      # - if: win
      #   then: cmake %CMAKE_ARGS% -S . -B build
      - cmake -LH build
      - cmake --build build --parallel=${CPU_COUNT}
      # - if: win
      #   then: cmake --build build --config=Release --parallel="%CPU_COUNT%"
      - cmake --install build

requirements:
  run_exports:
    - ${{ pin_subpackage('nnlojet', upper_bound='x.x') }}
  build:
    - ${{ stdlib('c') }}
    - ${{ compiler('cxx') }}
    - ${{ compiler('fortran') }}
    - lhapdf
    - if: build_platform != target_platform
      then:
        - python
        - cross-python_${{ target_platform }}
    - cmake
    - make
    - binutils
  host:
    - python
    - lhapdf
  run:
    - lhapdf
    - python

tests:
  # - package_contents:
  #     include:
  #       - siscone/config.h
  #       - siscone/geom_2d.h
  #       - siscone/defines.h
  #       - siscone/circulator.h
  #       - siscone/area.h
  #       - siscone/ranlux.h
  #       - siscone/quadtree.h
  #       - siscone/protocones.h
  #       - siscone/momentum.h
  #       - siscone/hash.h
  #       - siscone/vicinity.h
  #       - siscone/split_merge.h
  #       - siscone/siscone.h
  #       - siscone/siscone_error.h
  #       - siscone/reference.h
  #       - siscone/spherical/geom_2d.h
  #       - siscone/spherical/vicinity.h
  #       - siscone/spherical/split_merge.h
  #       - siscone/spherical/siscone.h
  #       - siscone/spherical/protocones.h
  #       - siscone/spherical/momentum.h
  #       - siscone/spherical/hash.h
  - script:
    - NNLOJET --help

about:
  homepage: https://nnlojet.hepforge.org/index.html
  summary: 'SISCone: the Seedless Infrared Safe Cone Jet Algorithm'
  description: |
    SISCone was written by Gavin Salam and Gregory Soyez.

    A description of the algorithm is available in the publication
    JHEP 05 (2007) 086
    [[arXiv:0704.0292](https://arxiv.org/abs/0704.0292) (hep-ph)].
    DOI: [10.1088/1126-6708/2007/05/086](https://doi.org/10.1088/1126-6708/2007/05/086)
  license: GPL-3.0-or-later
  license_family: GPL
  license_file:
    - COPYING.txt
    - LICENSE.txt
  repository: https://gitlab.com/fastjet/siscone

extra:
  recipe-maintainers:
    - Snakemonster
    - matthewfeickert
