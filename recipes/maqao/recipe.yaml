# MAQAO conda recipe using rattler-build format (CEP 13)
# MAQAO (Modular Assembly Quality Analyzer and Optimizer) is a performance analysis tool

context:
  name: maqao
  version: "2025.1.0"
  sha256: "26d398e74ee0a3edfc3137183c87c4b13b6b8e0b99bdcdcc907e9204acbb0163"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://gitlab.liparad.uvsq.fr/maqao_release/MAQAO/-/archive/5463caa1666a6d86c068420aff58ac1ef0666978/MAQAO-5463caa1666a6d86c068420aff58ac1ef0666978.tar.gz
  sha256: ${{ sha256 }}
  patches:
    - use-system-deps.patch
build:
  skip: 
    - if: not (linux and (x86_64 or aarch64))
      then: true
  number: 0
  script: 
    - build.sh

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - cmake >=3.3.0
    - make
    - pkg-config
  host:
    - luajit
    - libdwarf-dev

tests:
  - script:
    - maqao --version
    - maqao --help
    - maqao --detect-proc

about:
  homepage: https://www.maqao.org/
  summary: 'MAQAO - Modular Assembly Quality Analyzer and Optimizer'
  description: |
    MAQAO (Modular Assembly Quality Analyzer and Optimizer) is a performance analysis and optimization 
    framework operating at binary level with a focus on core performance.
    
    This package includes the following vendored components with their respective licenses:
    - LuaJIT (MIT license)
    - Lua 5.1/5.2 code (MIT license) 
    - dlmalloc (public domain)
    - libdwarf (LGPL-2.1-or-later)
    - libfcgi (Open Market license)
    - LuaFileSystem (MIT license)
  license: LGPL-3.0-or-later
  license_family: LGPL
  license_file: LICENSE
  documentation: https://maqao.org/documentation.html

extra:
  recipe-maintainers:
    - toprinse
    - cvalensi
