{% set version = "2.9" %}

package:
  name: x265
  version: {{ version }}

source:
  url: https://bitbucket.org/multicoreware/x265/downloads/x265_{{ version }}.tar.gz
  md5: 693ee4ce7929a59735f441107310f0bb

build:
  skip: true  # [win and vc<14]
  number: 0

requirements:
  build:
    - {{ compiler('cxx') }}
    - cmake
    - pkgconfig              # [unix]
    - nasm

test:
  commands:
    - x265 --version
    - test -f ${PREFIX}/include/hdr10plus.h                        # [unix]
    - test -f ${PREFIX}/include/x265.h                             # [unix]
    - test -f ${PREFIX}/include/x265_config.h                      # [unix]
    - test -f ${PREFIX}/lib/libx265.so                             # [linux]
    - test -f ${PREFIX}/lib/libx265.a                              # [linux]
    - test -f ${PREFIX}/lib/libhdr10plus.so                        # [linux]
    - test -f ${PREFIX}/lib/libhdr10plus.a                         # [linux]
    - test -f ${PREFIX}/lib/pkgconfig/x265.pc                      # [linux]
    - conda inspect linkages -p $PREFIX x265                       # [unix]
    - conda inspect objects -p $PREFIX x265                        # [osx]
    - if not exist %PREFIX%/Library/lib/libx265.lib exit 1         # [win]
    - if not exist %PREFIX%/Library/lib/hdr10plus.lib exit 1       # [win]
    - if not exist %PREFIX%/Library/bin/libx265.dll exit 1         # [win]
    - if not exist %PREFIX%/Library/include/x265.h  exit 1         # [win]
    - if not exist %PREFIX%/Library/include/x265_config.h  exit 1  # [win]
    - if not exist %PREFIX%/Library/include/hdr10plus.h  exit 1    # [win]

about:
  home: https://bitbucket.org/multicoreware/x265
  license: GPLv2
  license_file: COPYING
  summary: 'Open Source H265/HEVC video encoder'
  description: |
    The goal of x265 is to become the best open source H.265/HEVC encoder,
    with the highest compression efficiency at the highest performance,
    while also allowing commercial use via a dual GPL and commercial license.
    In a nutshell, we would like to reproduce x264's successful development
    model for HEVC.

extra:
  recipe-maintainers:
    - hmaarrfk
