add_library(dydx_v4_client_lib SHARED ${SOURCES})
target_include_directories(dydx_v4_client_lib PUBLIC ${INCLUDE_DIR} ${dydx_v4_proto_INCLUDE_DIRS})
set_property(TARGET dydx_v4_client_lib PROPERTY POSITION_INDEPENDENT_CODE 1)

if (WIN32)
    set_target_properties(dydx_v4_client_lib PROPERTIES
        WINDOWS_EXPORT_ALL_SYMBOLS ON
        RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin"
        ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib"
    )
    target_link_directories(dydx_v4_client_lib
        PUBLIC ${CMAKE_INSTALL_PREFIX}/lib ${CMAKE_INSTALL_PREFIX}/Library/lib)
    target_compile_definitions(dydx_v4_client_lib
        PRIVATE PROTOBUF_USE_DLLS
        PUBLIC DYDX_V4_CLIENT_EXPORTS
    )
    target_link_libraries(dydx_v4_client_lib
        PRIVATE dydx_v4_proto
        PUBLIC libprotobuf Boost::boost OpenSSL::SSL bip3x toolbox fmt nlohmann_json::nlohmann_json)
elseif (APPLE)
    target_link_libraries(dydx_v4_client_lib
        PRIVATE dydx_v4_proto
        PUBLIC protobuf Boost::boost OpenSSL::SSL crypto boost_context bip3x fmt nlohmann_json::nlohmann_json)
else()
    target_link_libraries(dydx_v4_client_lib
        PRIVATE dydx_v4_proto
        PUBLIC Boost::boost OpenSSL::SSL crypto boost_context bip3x fmt nlohmann_json::nlohmann_json)
endif()
