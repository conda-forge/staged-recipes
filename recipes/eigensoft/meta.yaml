# This recipe is based on the bioconda eigensoft recipe
# Bioconda recipe: https://github.com/bioconda/bioconda-recipes/tree/fb804eb/recipes/eigensoft
# Bioconda licence: https://github.com/bioconda/bioconda-recipes/blob/fb804eb/LICENSE

{% set name = "eigensoft" %}
{% set version = "8.0.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

build:
  number: 0

source:
  url: https://github.com/DReichLab/EIG/archive/v{{ version }}.tar.gz
  sha256: e3459e8ac0134da369910454854eae5c7b261e8816318ccbd2d371b4c6c35741
  patches:
    - patches/0001-Add-gfortran-to-LDLIBS.patch
    - patches/0002-replace-finite.patch
    - patches/0003-remove-wrong-cflag.patch # [osx]

requirements:
  build:
    - make
    - {{ compiler('c') }}
  host:
    - gsl
    - openblas
  run:
    - gsl
    - openblas
    - perl

test:
  commands:
    - smartpca
    # both tools crash without input, there is other way to check whether installation worked...
    - which convertf
    - which mergeit

about:
  home: https://github.com/DReichLab/EIG
  license: Custom OSS
  license_file: LICENSE.txt
  summary: The EIGENSOFT package implements methods for analzing population structure and performing stratification correction

extra:
  identifiers:
    - doi:10.1371/journal.pgen.0020190
  recipe-maintainers:
    - tschuelia
