context:
  name: gtk-sharp-dotnet
  version: "2.12.45"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/mono/gtk-sharp/archive/refs/tags/${{ version }}.tar.gz
  sha256: a4bb3593235ef26e1a38c26760f118126ede2801abc41c674aa4d1eee068d9e0
  patches:
    - patches/fix-TestRange.cs.patch
    - patches/fix-windowmanager.c.patch
    - patches/update-configure-setup.patch
    - patches/update-dotnet-Makefile.include.patch
    - patches/update-dotnet-configure.in.in.patch

build:
  # skip: unix
  number: 0

requirements:
  build:
    - if: unix
      then:
        - ${{ compiler('c') }}
        - ${{ stdlib('c') }}
        - autoconf
        - automake
        - libtool
        - pkg-config
        - python
      else:
        - ${{ compiler('m2w64_c') }}
        - ${{ stdlib('m2w64_c') }}
        - binutils
        - gendef
        - m2-autoconf
        - m2-automake-wrapper
        - m2-bash
        - m2-grep
        - m2-libtool
        - m2-pkg-config
        - m2-sed
        - m2-which
    - cairo
    - dotnet
    - expat
    - fontconfig
    - liblzma-devel
    - make
    - nuget-license
    - pango
    - pkg-config
    - python
    - zlib
  host:
    - atk
    - glib
    - gtk2
    - netifaces
    - psutil
    - pyyaml
    - requests
    - robotframework
    - xorg-xorgproto
  run:
    - dotnet

tests:
  - package_contents:
      lib:
        - libatksharpglue-2.dll
        - libgdksharpglue-2.dll
        - libglibsharpglue-2.dll
        - libgtksharpglue-2.dll
        - libpangosharpglue-2.dll

        - libatksharpglue-2.dll.a
        - libgdksharpglue-2.dll.a
        - libglibsharpglue-2.dll.a
        - libgtksharpglue-2.dll.a
        - libpangosharpglue-2.dll.a

        - atksharpglue-2.lib
        - gdksharpglue-2.lib
        - glibsharpglue-2.lib
        - gtksharpglue-2.lib
        - pangosharpglue-2.lib
      files:
        - Library/gtk-sharp-2.0/gapi2xml.pl
        - Library/gtk-sharp-2.0/gapi_pp.pl

        - share/gapi-2.0/atk-api.xml
        - share/gapi-2.0/gdk-api.xml
        - share/gapi-2.0/glib-api.xml
        - share/gapi-2.0/gtk-api.xml
        - share/gapi-2.0/pango-api.xml

        - Library/lib/pkgconfig/glib-sharp-2.0.pc
        - Library/lib/pkgconfig/gtk-dotnet-2.0.pc
        - Library/lib/pkgconfig/gtk-sharp-2.0.pc
  - script:
      interpreter: python
      content: |
        import os
        from pathlib import Path
        root = Path(os.environ["PREFIX"]) / ("Library" if os.name == "nt" else "") / "lib" / "mono" / "gtk-sharp-2.0"
        vs = ["2.10", "2.4", "2.6", "2.8"]
        ds = ["atk-sharp.dll", "gdk-sharp.dll", "glib-sharp.dll", "gtk-dotnet.dll", "gtk-sharp.dll", "pango-sharp.dll"]
        missing_dlls = [f"policy.{v}.{d}" for v in vs for d in ds if not (root / f"policy.{v}.{d}").exists()]
        if missing_dlls:
            print("\n".join(missing_dlls))
            exit(1)

about:
  homepage: https://github.com/mono/gtk-sharp
  summary: "Gtk# is a Mono/.NET binding to the cross platform Gtk+ GUI toolkit"
  description: |
    Gtk# is a Graphical User Interface Toolkit for mono and .Net. The project binds
    the gtk+ toolkit and assorted GNOME libraries, enabling fully native graphical
    Gnome application development using the Mono and .Net development frameworks.
  license: GPL-2.0-only
  license_file: COPYING
  documentation: http://www.mono-project.com/GtkSharp
  repository: https://github.com/mono/gtk-sharp

extra:
  recipe-maintainers:
    - MementoRC
