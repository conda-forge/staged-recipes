--- a/bootstrap-generic
+++ b/bootstrap-generic
@@ -22 +22 @@
-    -e "s/@ASSEMBLY_VERSION@/$ASSEMBLY_VERSION/" $srcdir/configure.in.in > $srcdir/configure.in
+    -e "s/@ASSEMBLY_VERSION@/$ASSEMBLY_VERSION/" $srcdir/configure.in.in > $srcdir/configure.ac
@@ -51 +51 @@
-(grep "^AM_PROG_LIBTOOL" $srcdir/configure.in >/dev/null) && {
+(grep "^AM_PROG_LIBTOOL" $srcdir/configure.ac >/dev/null) && {
@@ -104,2 +104,2 @@
-
-if grep "^AM_PROG_LIBTOOL" configure.in >/dev/null; then
+autoupdate
+if grep "^AM_PROG_LIBTOOL" configure.ac >/dev/null; then
@@ -123 +123 @@
-if grep "^AC_CONFIG_HEADERS" configure.in >/dev/null; then
+if grep "^AC_CONFIG_HEADERS" configure.ac >/dev/null; then
--- a/configure.in.in
+++ b/configure.in.in
@@ -6,0 +6,1 @@
+AC_CONFIG_MACRO_DIRS([m4])
@@ -25,2 +26,2 @@
-			CC="gcc -g"
-			HOST_CC="gcc"
+			CC="${CC} -g"
+			HOST_CC="${CC}"
@@ -126,1 +127,1 @@
-	AC_MSG_ERROR([No gacutil tool found. You need to install either the mono or .Net SDK.])
+	AC_MSG_WARN([No gacutil tool found. You need to install either the mono or .Net SDK.])
@@ -131,1 +132,1 @@
-	AC_MSG_ERROR([No al tool found. You need to install either the mono or .Net SDK.])
+	AC_MSG_WARN([No al tool found. You need to install either the mono or .Net SDK.])
@@ -135,1 +136,1 @@
-GACUTIL_FLAGS='-package $(PACKAGE_VERSION) -gacdir $(DESTDIR)$(prefix)/lib'
+DOTNET_BUILD_FLAGS='--configuration Release --output $(DESTDIR)$(PREFIX)/lib'
--- a/Makefile.am
+++ b/Makefile.am
@@ -13 +13 @@
-configure.in: bootstrap.status configure.in.in
+configure.ac: bootstrap.status configure.in.in
--- a/Makefile.include
+++ b/Makefile.include
@@ -19 +19 @@
-EXTRA_DIST = $(RAW_API) $(SYMBOLS) $(ASSEMBLY).config.in $(METADATA) $(customs) $(sources) $(add_dist)
+EXTRA_DIST = $(RAW_API) $(SYMBOLS) $(ASSEMBLY).config.in $(METADATA) $(customs) $(sources) $(add_dist) $(DOTNET_FLAGS)
@@ -21 +21 @@
-build_symbols = $(addprefix --symbols=$(srcdir)/, $(SYMBOLS))
+build_symbols = $(addprefix --symbols=$(srcdir)/, $(SYMBOLS)) $(DOTNET_FLAGS)
@@ -53 +53 @@
-	$(AL) -link:policy.$*.config -version:$* -out:$@ -keyfile:$(SNK)
+	dotnet build /p:Configuration=Release /p:AssemblyVersion=$* /p:FileVersion=$* /p:Version=$* /p:SignAssembly=true /p:AssemblyOriginatorKeyFile=$(SNK) -o $@
@@ -60 +60 @@
-	$(CSC) $(CSFLAGS) -nowarn:0169,0612,0618 -unsafe -out:$(ASSEMBLY) -target:library $(build_references) $(GENERATED_SOURCES) $(build_sources)
+	dotnet build -c Release /p:AllowUnsafeBlocks=true /nowarn:0169;0612;0618 -o $@ /p:Target=Library
@@ -62 +62 @@
-install-data-local:
+install-data-local: $(DOTNET_FLAGS)
@@ -64,18 +64,8 @@
-	  echo "$(GACUTIL) -i $(ASSEMBLY) -f $(GACUTIL_FLAGS)";				\
-	  $(GACUTIL) -i $(ASSEMBLY) -f $(GACUTIL_FLAGS) || exit 1;			\
-	  if test -n '$(POLICY_VERSIONS)'; then						\
-	    for i in $(POLICY_VERSIONS); do						\
-	      echo "$(GACUTIL) -i policy.$$i.$(ASSEMBLY) -f $(GACUTIL_FLAGS)";		\
-	      $(GACUTIL) -i policy.$$i.$(ASSEMBLY) -f $(GACUTIL_FLAGS) || exit 1;	\
-	    done									\
-	  fi										\
-	fi
-
-uninstall-local:
-	@if test -n '$(pkg)'; then							\
-	  echo "$(GACUTIL) -u $(ASSEMBLY_NAME) $(GACUTIL_FLAGS)";			\
-	  $(GACUTIL) -u $(ASSEMBLY_NAME) $(GACUTIL_FLAGS) || exit 1;			\
-	  if test -n '$(POLICY_VERSIONS)'; then						\
-	    for i in $(POLICY_VERSIONS); do						\
-	      echo "$(GACUTIL) -u policy.$$i.$(ASSEMBLY_NAME) $(GACUTIL_FLAGS)";	\
-	      $(GACUTIL) -u policy.$$i.$(ASSEMBLY_NAME) $(GACUTIL_FLAGS) || exit 1;	\
+	  echo "dotnet add $(ASSEMBLY) package $(ASSEMBLY_NAME) $(DOTNET_FLAGS)";		\
+	  dotnet add $(ASSEMBLY) package $(ASSEMBLY_NAME) $(DOTNET_FLAGS) || exit 1;	\
+	      echo "dotnet add $(ASSEMBLY) package policy.$$i.$(ASSEMBLY_NAME) $(DOTNET_FLAGS)";		\
+	      dotnet add $(ASSEMBLY) package policy.$$i.$(ASSEMBLY_NAME) $(DOTNET_FLAGS) || exit 1;	\
+	  echo "dotnet remove $(ASSEMBLY_NAME) $(DOTNET_FLAGS)";			\
+	  dotnet remove $(ASSEMBLY_NAME) $(DOTNET_FLAGS) || exit 1;			\
+	      echo "dotnet remove policy.$$i.$(ASSEMBLY_NAME) $(DOTNET_FLAGS)";	\
+	      dotnet remove policy.$$i.$(ASSEMBLY_NAME) $(DOTNET_FLAGS) || exit 1;	\
