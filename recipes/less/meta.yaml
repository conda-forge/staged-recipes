{% set version = "633" %}

package:
  name: less
  version: {{ version }}

source:
  url: https://ftp.gnu.org/gnu/less/less-{{ version }}.tar.gz
  sha256: 2f201d64b828b88af36dfe6cfdba3e0819ece2e446ebe6224813209aaefed04f

build:
  script:
    - ./configure --prefix=${PREFIX} --sysconfdir=/etc --with-regex=pcre2  # [unix]
    - make  # [unix]
    - install -Dm 0755 less ${PREFIX}/bin/less  # [unix]
    - install -Dm 0755 lesskey ${PREFIX}/bin/lesskey  # [unix]
    - install -Dm 0755 lessecho ${PREFIX}/bin/lessecho  # [unix]
    - make -f Makefile.wnm  # [win]
    - if not exist %PREFIX%\bin mkdir %PREFIX%\bin  # [win]
    - copy less.exe %PREFIX%\bin\  # [win]
    - copy lesskey.exe %PREFIX%\bin\  # [win]
    - copy lessecho.exe %PREFIX%\bin\  # [win]
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - make

  host:
    - pcre2
    - ncurses  # [not-win]

test:
  commands:
    - test "$(which less | dirname)" = ${PREFIX}/bin # [unix]
    - where less | findstr /C:"%PREFIX%\bin"  # [win]
    - less --version
    - test "$(which lessecho | dirname)" = ${PREFIX}/bin  # [unix]
    - where lessecho | findstr /C:"%PREFIX%\bin"  # [win]
    - lessecho --version
    - test "$(which lesskey | dirname)" = ${PREFIX}/bin  # [unix]
    - where lesskey | findstr /C:"%PREFIX%\bin"
    - lesskey --version

about:
  home: https://www.greenwoodsoftware.com/less
  summary: 'A terminal based program for viewing text files'
  description: |
    Less is a pager. A pager is a program that displays text files. Other pagers
    commonly in use are more and pg. Pagers are often used in command-line
    environments like the Unix shell and the MS-DOS command prompt to display
    files.
  license: GPL-3.0-only
  license_file:
    - LICENSE
    - COPYING
  doc_url: https://www.greenwoodsoftware.com/less/faq.html
  dev_url: https://github.com/gwsw/less

extra:
  recipe-maintainers:
    - tetov
