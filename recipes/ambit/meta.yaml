{% set version = "0.5.1" %}
{% set name = "ambit" %}

package:
    name: {{ name }}
    version: {{ version }}

source:
    git_url: https://github.com/jturney/ambit.git
    git_tag: loriab-patch-1

build:
    number: 0
    binary_relocation: true
    skip: true                                           # [win]

requirements:
    build:
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - cmake >=3.1
        - llvm-openmp                                   # [osx]
        - libgomp                                       # [linux]
    host:
        - hdf5
        - llvm-openmp                                   # [osx]
        - libgomp                                       # [linux]
        - mkl-devel
        - zlib {{ zlib }}
    run:
        - llvm-openmp                                   # [osx]
        - libgomp                                       # [linux]

test:
    commands:
        - test -f $PREFIX/lib/libambit$SHLIB_EXT
        - ldd -r -u $PREFIX/lib/libambit.so && return 0  # [linux]
        - ldd -v $PREFIX/lib/libambit.so                 # [linux]
        - otool -L $PREFIX/lib/libambit.dylib            # [osx]
        - conda inspect linkages --show-files --groupby=dependency ambit
        - conda inspect objects -p $PREFIX ambit         # [osx]

about:
    home: https://github.com/jturney/ambit
    dev_url: https://github.com/jturney/ambit
    license: LGPL-3.0-only
    license_file: COPYING.LESSER
    license_family: LGPL
    summary: "J. Turney's C++ library for the implementation of tensor product calculations"

extra:
  recipe-maintainers:
    - mattwthompson
    - loriab
    - jturney
