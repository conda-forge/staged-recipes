{% set version = "1.6.0" %}

package:
  name: kddockwidgets
  version: {{ version }}

source:
  url: https://github.com/KDAB/KDDockWidgets/archive/v{{ version }}.tar.gz
  sha256: 16ea63830a59e88bd338d72043d62086b7cef930b72a6c02c9071821f05637a2
  patches:
    - 0001-target_link_directories.patch  # [win]
    - 0002-python-CMakeLists.patch

build:
  number: 0
  ignore_run_exports_from:
    # Just used for shiboken/pyside2 not used for python module
    - clangdev  # [not osx]

requirements:
  build:
    - cmake
    - {{ compiler('cxx') }}
    - make                           # [not win]
    - ninja                          # [win]
    - {{ cdt('mesa-libgl-devel') }}  # [linux]
    - {{ cdt('mesa-dri-drivers') }}  # [linux]
    - {{ cdt('libselinux') }}        # [linux]
    - {{ cdt('libxdamage') }}        # [linux]
    - {{ cdt('libxxf86vm') }}        # [linux]
    - {{ cdt('libxext') }}           # [linux]
    - pkg-config
    - clangdev

  host:
    - python
    - qt-main ==5.15.6
    - pyside2 ==5.15.6
    - setuptools
    - xorg-libxfixes                 # [linux]

  run:
    - python
    - pyside2 ==5.15.6
    
test:
  commands:
    - if not exist %LIBRARY_BIN%\\kddockwidgets1.dll exit 1                               # [win]
    - if not exist %LIBRARY_INC%\\kddockwidgets\\kddockwidgets_version.h exit 1           # [win]
    - if not exist %LIBRARY_LIB%\\cmake\\KDDockWidgets\\KDDockWidgetsConfig.cmake exit 1  # [win]
    - test -f $PREFIX/lib/libkddockwidgets${SHLIB_EXT}                                   # [unix]
    - test -f $PREFIX/include/kddockwidgets/kddockwidgets_version.h                       # [unix]
    - test -f $PREFIX/lib/cmake/KDDockWidgets/KDDockWidgetsConfig.cmake                   # [unix]
    
  imports:
    - PyKDDockWidgets
    - PyKDDockWidgets.KDDockWidgets

about:
  home: https://github.com/KDAB/KDDockWidgets
  license: GPL-2.0-or-later
  license_file: LICENSE.txt
  summary: KDAB's Dock Widget Framework for Qt 

extra:
  recipe-maintainers:
    - n-elie
