context:
  version: "4.8"

package:
  name: chrony
  version: ${{ version }}

source:
  url: https://chrony-project.org/releases/chrony-${{ version }}.tar.gz
  sha256: 33ea8eb2a4daeaa506e8fcafd5d6d89027ed6f2f0609645c6f149b560d301706

build:
  number: 0
  script:
    - ./configure --prefix=$PREFIX --localstatedir=$PREFIX/var
    - make
    - make install

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib("c") }}
    - make
    - pkg-config
  host:
    - gnutls
    - nettle
    - if: linux
      then:
        - libedit
  run:
    - gnutls
    - nettle
    - if: linux
      then:
        - libedit

tests:
  - script:
    - test -f $PREFIX/sbin/chronyd
    - test -f $PREFIX/sbin/chronyc
    - mkdir -p test_dir
    - echo "pool pool.chrony.eu iburst" > test_dir/test.conf
    - $PREFIX/sbin/chronyd -Q -f test_dir/test.conf 2>&1 | grep -E "System clock wrong by -?[0-9]+\.[0-9]+ seconds"

about:
  homepage: https://chrony-project.org
  license: GPL-2.0-only
  license_file: COPYING
  summary: Versatile implementation of the Network Time Protocol (NTP)
  description: |
    Chrony is a versatile implementation of the Network Time Protocol (NTP).
    It can synchronise the system clock with NTP servers, reference clocks,
    and manual input using wristwatch and keyboard.
  repository: https://gitlab.com/chrony/chrony

extra:
  recipe-maintainers:
    - wep21
