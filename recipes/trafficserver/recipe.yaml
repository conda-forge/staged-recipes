context:
  name: trafficserver
  version: "10.1.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://downloads.apache.org/${{ name }}/${{ name }}-${{ version }}.tar.bz2
  sha256: bccc35bbfc80f215b0858a0a7e531ac990b13a9eb1e3e81a3b15eaa3fde0596e

build:
  script:
    - cmake -S . -B build -DBUILD_EXPERIMENTAL_PLUGINS=ON -DEXTERNAL_YAML_CPP=ON ${CMAKE_ARGS}
    - cmake --build build
    - cmake --install build
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - cmake
    - make
    - ninja
    - pkg-config
  host:
    - brotli
    - libhwloc
    - if: unix
      then:
        - imagemagick
        - libmaxminddb
        - flex
    - luajit
    - openssl
    # https://github.com/apache/trafficserver/issues/8780
    - pcre
    - pcre2
    - xz
    - yaml-cpp
    - curl
    - ncurses
    - zlib
    - if: linux
      then:
        - libcap
        - libunwind

tests:
  - script:
      - trafficserver --help
  - package_contents:
      strict: true
      bin:
        - trafficserver

about:
  homepage: https://trafficserver.apache.org
  summary: Apache Traffic Serverâ„¢ is a fast, scalable and extensible HTTP/1.1 and HTTP/2 compliant caching proxy server.
  description: |
    Traffic Server is a high-performance building block for cloud services. It's more than just a caching proxy server; it also has support for plugins to build large scale web applications.
  license: Apache-2.0
  license_file: LICENSE
  documentation: https://docs.trafficserver.apache.org
  repository: https://github.com/simplejson/simplejson

extra:
  recipe-maintainers:
    - pavelzw
