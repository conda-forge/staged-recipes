schema_version: 1

context:
  name: distrobuilder
  version: "3.2"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/lxc/distrobuilder/archive/refs/tags/distrobuilder-${{ version }}.tar.gz
  sha256: 899f2d608f8eaba089f9eb3d4cff4e47404d02c2e9fa4c32152f9de0ba2eb63a
  target_directory: src

build:
  number: 0
  script:
    - cd src
    - if: unix
      then: go build -v -o $PREFIX/bin/distrobuilder -ldflags="-s -w" ./distrobuilder
      else: go build -v -o %LIBRARY_BIN%\distrobuilder.exe -ldflags="-s" ./distrobuilder
    - >-
      go-licenses save ./distrobuilder --save_path ../library_licenses
      --ignore github.com/lxc/distrobuilder
      --ignore github.com/rootless-containers/proto/go-proto

requirements:
  build:
    - ${{ compiler('go-cgo') }}
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - go-licenses

tests:
  - package_contents:
      bin:
        - distrobuilder
      strict: true

about:
  homepage: https://linuxcontainers.org/
  summary: distrobuilder is an image building tool for LXC and Incus.
  description: |
    It is used to build all our official images available on our image server.
    The image definition is a YAML document which describes the source of the image,
    its package manager, what packages to install/remove for specific image variants,
    os releases and architectures,
    as well as additional files to generate and arbitrary actions to execute as part of the image build process.
    The output is either a plain root filesystem, an Incus image or a LXC image.
  license: Apache-2.0
  license_file:
    - src/COPYING
    - library_licenses/
  documentation: https://linuxcontainers.org/distrobuilder/docs/latest/
  repository: https://github.com/lxc/distrobuilder

extra:
  recipe-maintainers:
    - phreed
