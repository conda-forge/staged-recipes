schema_version: 1

context:
  name: distrobuilder
  version: "3.2"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/lxc/${{ name }}/releases/download/${{ name }}-${{ version }}/${{ name }}-${{ version }}.tar.gz
  sha256: 443346dbbe1d5f6b0f46a0785541b7e20a6bfdee1c56ea022501526c4684820d

build:
  skip: not linux
  script:
    - export GOBIN=$PREFIX/bin
    - go install -v ./...
    # - cp $PREFIX/bin/distrobuilder $PREFIX/bin/incus-build
  number: 0

requirements:
  build:
    - ${{ compiler('go-cgo') }}
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - go-licenses >=2.0.1

tests:
  - package_contents:
      bin:
        - distrobuilder
      strict: true

about:
  homepage: https://linuxcontainers.org/
  summary: distrobuilder is an image building tool for LXC and Incus.
  description: |
    It is used to build all our official images available on our image server.
    The image definition is a YAML document which describes the source of the image,
    its package manager, what packages to install/remove for specific image variants,
    os releases and architectures,
    as well as additional files to generate and arbitrary actions to execute as part of the image build process.
    The output is either a plain root filesystem, an Incus image or a LXC image.
  license: Apache-2.0
  license_file: COPYING
  documentation: https://linuxcontainers.org/distrobuilder/docs/latest/
  repository: https://github.com/lxc/distrobuilder

extra:
  recipe-maintainers:
    - phreed
