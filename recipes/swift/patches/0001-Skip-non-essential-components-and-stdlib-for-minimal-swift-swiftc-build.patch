From 06d17219e5b7f847dfd5e4e6d2873c2712b7bff2 Mon Sep 17 00:00:00 2001
From: Julien Jerphanion <git@jjerphan.xyz>
Date: Fri, 18 Jul 2025 17:21:01 +0200
Subject: [PATCH] Skip non-essential components and stdlib for minimal swift/swiftc build

Signed-off-by: Julien Jerphanion <git@jjerphan.xyz>
---
 utils/build-presets.ini | 35 +++++++++++++++++++++++++++++++++++
 1 file changed, 35 insertions(+)

diff --git a/utils/build-presets.ini b/utils/build-presets.ini
index 81fa54a65e6..0f38487b8fa 100644
--- a/utils/build-presets.ini
+++ b/utils/build-presets.ini
@@ -963,6 +963,41 @@ mixin-preset=
     buildbot_linux
     mixin_buildbot_linux,no_test

+# Skip building compiler-rt to reduce build time and dependencies.
+# This disables sanitizer support (AddressSanitizer, ThreadSanitizer, etc.)
+# but provides a functional toolchain for basic Swift compilation.
+skip-build-compiler-rt
+llvm-install-components=llvm-ar;llvm-ranlib;llvm-cov;llvm-profdata;IndexStore;clang;clang-resource-headers;clangd;lld;LTO;clang-features-file
+
+# Skip building early Swift driver to reduce build time.
+skip-early-swift-driver
+
+# Skip building SwiftSyntax to reduce build time.
+skip-early-swiftsyntax
+
+# Skip building the standard library to create a minimal toolchain
+skip-build-linux

 [preset: buildbot_linux,no_assertions,no_test]
 mixin-preset=
