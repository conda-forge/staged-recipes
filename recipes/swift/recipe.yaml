# Recipe for Swift - The Swift Programming Language
# Based on Fedora 41's Swift 6.0.3-RELEASE build
# See: https://koji.fedoraproject.org/koji/buildinfo?buildID=2602564

context:
  name: swift
  version: "6.0.3"

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  # Main Swift repository
  - url: https://github.com/apple/swift/archive/refs/tags/swift-${{ version }}-RELEASE.tar.gz
    sha256: eef9f312d00540cfabc35cb1da9221dd15d3aaca546497a14f29a641ee6484e3
    target_directory: swift

  # Core libraries
  - url: https://github.com/apple/swift-corelibs-foundation/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 62c276a18fa3b3b92e95f5349dc125d03f09cea3c477b3af1428ccdbab29e139
    target_directory: swift-corelibs-foundation
  - url: https://github.com/apple/swift-corelibs-libdispatch/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 444c0de5fe18e148548a3f3b60b3bac3d4d586285c21064346c7ca17ed1d4fac
    target_directory: swift-corelibs-libdispatch
  - url: https://github.com/apple/swift-corelibs-xctest/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: eb131d1cfde18548c5fc782ba56bc871b13057b5e7b6992ddae4d4349360571d
    target_directory: swift-corelibs-xctest

  # LLVM and CMark
  - url: https://github.com/apple/llvm-project/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: d93ca164615938e5026a2d1af76b2ef7514eae98b38a716f3278bc1a6dfc8f92
    target_directory: llvm-project
  - url: https://github.com/apple/swift-cmark/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: ab1064350ecedd5b3c0f2a6fbe3acefbc45d7accf1e4ca1591ce04d0c6787e40
    target_directory: cmark

  # Swift tools and components
  - url: https://github.com/apple/swift-package-manager/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 03c5b8dfd8628de42ca1c171faeeddea977ecdad8675d3826a2c165ad8f972ba
    target_directory: swiftpm
  - url: https://github.com/apple/swift-llbuild/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 68d71bf7e0882153c6ad91fbe0626ab761d8bc46d2d93ce32cbfa392d256a30e
    target_directory: llbuild
  - url: https://github.com/apple/swift-driver/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 9ee38eda1a0adc24dd995b345dff4a5a25d42ae8d063fcc04b170469f2f53d43
    target_directory: swift-driver
  - url: https://github.com/apple/swift-syntax/archive/swift-${{ version }}-RELEASE.zip
    sha256: e6ca21f82f7a27bd42c51520c7f79609c6f1e56e5017c35f8c27522bed63f1b2
    target_directory: swift-syntax
  - url: https://github.com/apple/swift-tools-support-core/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: fc83e9922d4c7df0f0d94b8840f292989eb148d5e451b182a9e390a9ea4dd94e
    target_directory: swift-tools-support-core
  - url: https://github.com/apple/sourcekit-lsp/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 928db64bc179a250afd305b5729217180e2de1cdcd3d353d0fa20b38c5def8ec
    target_directory: sourcekit-lsp
  - url: https://github.com/apple/indexstore-db/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: fdaceb80a819e5b86d1599e7357c79e518a3ff0bb96dcd82245fc50e3d6bbc0d
    target_directory: indexstore-db
  - url: https://github.com/apple/swift-xcode-playground-support/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: fe5ada3bc241afc8d2ea48528b9e093ecfb5c7f3094b91293eb760458b3b22ee
    target_directory: swift-xcode-playground-support
  - url: https://github.com/apple/swift-docc/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 00d8e95a7fdae71c7313389ced0fd4d63185782f8d2fa6d4683672f700478195
    target_directory: swift-docc
  - url: https://github.com/apple/swift-docc-render-artifact/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: d791c82bff3ed8e8a35a76c1fab9bc3a20ed7bd96aa91b40d50e822f11874863
    target_directory: swift-docc-render-artifact
  - url: https://github.com/apple/swift-docc-symbolkit/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 1bdcb65209d0487fa50d5ed41e108528c56259771f25b06a0bec911ccb224237
    target_directory: swift-docc-symbolkit
  - url: https://github.com/apple/swift-lmdb/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 1876f37050f42044ce9e614530f8001ce0fce6f44fff8a5ece7186591115f4b6
    target_directory: swift-lmdb
  - url: https://github.com/apple/swift-markdown/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 6c2cc30a8c0f8b6f1f4fa0f21af784722267bb9b6c38336718ae959cea5584e5
    target_directory: swift-markdown
  - url: https://github.com/apple/swift-stress-tester/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 3402a9fbde269f416e067f8a767c7ffd97c2f8416621063db26a8cbc0b1eb5cc
    target_directory: swift-stress-tester
  - url: https://github.com/apple/swift-experimental-string-processing/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 6c34cfdf934eb781169866a66505e11541861ba638b05fd4ed87f8c34a6fa55e
    target_directory: swift-experimental-string-processing
  - url: https://github.com/apple/swift-integration-tests/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: 34bffc74fea2bef2e6f0b007ee5a09e4bcf6dcb865beaff38cf794dfb467a3e0
    target_directory: swift-integration-tests
  - url: https://github.com/apple/swift-testing/archive/swift-${{ version }}-RELEASE.tar.gz
    sha256: c69bafdaaa849cae7265804bd1a8807ebadffbc51c005c343e4d1ce42a1e7b62
    target_directory: swift-testing

  # Versioned components
  - url: https://github.com/apple/swift-argument-parser/archive/1.2.3.tar.gz
    sha256: 4a10bbef290a2167c5cc340b39f1f7ff6a8cf4e1b5433b68548bf5f1e542e908
    target_directory: swift-argument-parser
  - url: https://github.com/apple/swift-crypto/archive/refs/tags/3.0.0.tar.gz
    sha256: 5c860c0306d0393ff06268f361aaf958656e1288353a0e23c3ad20de04319154
    target_directory: swift-crypto
  - url: https://github.com/ninja-build/ninja/archive/refs/tags/v1.11.1.tar.gz
    sha256: 31747ae633213f1eda3842686f83c2aa1412e0f5691d1c14dbbcc67fe7400cea
    target_directory: ninja
  - url: https://github.com/KitWare/CMake/archive/refs/tags/v3.24.2.tar.gz
    sha256: f4f0772b0a89f93be6d1153d5640b80cc8d64a3bda95cca1799673bc4d03f3b1
    target_directory: cmake
  - url: https://github.com/apple/swift-atomics/archive/1.2.0.tar.gz
    sha256: 33d9f4fbaeddee4bda3af2be126791ee8acf3d3c24a2244457641a20d39aec12
    target_directory: swift-atomics
  - url: https://github.com/apple/swift-collections/archive/1.1.2.tar.gz
    sha256: cd30d2f93c72424df48d182006417abdeebe74d250cb99d1cda78daf40aca569
    target_directory: swift-collections
  - url: https://github.com/apple/swift-numerics/archive/1.0.2.tar.gz
    sha256: 786291c6ff2a83567928d3d8f964c43ff59bdde215f9dedd0e9ed49eb5184e59
    target_directory: swift-numerics
  - url: https://github.com/apple/swift-system/archive/1.3.0.tar.gz
    sha256: 02e13a7f77887c387f5aa1de05f4d4b8b158c35145450e1d9557d6c42b06cd1f
    target_directory: swift-system
  - url: https://github.com/apple/swift-nio/archive/2.31.2.tar.gz
    sha256: 8818b8e991d36e886b207ae1023fa43c5eada7d6a1951a52ad70f7f71f57d9fe
    target_directory: swift-nio
  - url: https://github.com/apple/swift-nio-ssl/archive/2.15.0.tar.gz
    sha256: 9ab1f0e347fad651ed5ccadc13d54c4306e6f5cd21908a4ba7d1334278a4cd55
    target_directory: swift-nio-ssl
  - url: https://github.com/apple/swift-certificates/archive/1.0.1.tar.gz
    sha256: fcaca458aab45ee69b0f678b72c2194b15664cc5f6f5e48d0e3f62bc5d1202ca
    target_directory: swift-certificates
  - url: https://github.com/apple/swift-asn1/archive/1.0.0.tar.gz
    sha256: e0da995ae53e6fcf8251887f44d4030f6600e2f8f8451d9c92fcaf52b41b6c35
    target_directory: swift-asn1
  - url: https://github.com/jpsim/Yams/archive/5.0.6.tar.gz
    sha256: a81c6b93f5d26bae1b619b7f8babbfe7c8abacf95b85916961d488888df886fb
    target_directory: Yams

  # Additional components
  - url: https://github.com/unicode-org/icu/archive/refs/heads/maint/maint-69.zip
    sha256: 77939649ac5927a2900efae161ba7d038483e5890800766449a3d160bb7386f1
    target_directory: icu
  - url: https://github.com/swiftwasm/WasmKit/archive/refs/tags/0.0.3.tar.gz
    sha256: a959a868dbacbd28d5ffc1b27fc7f2d56f076bc727bbdec5b0c315c489e13b58
    target_directory: wasmkit
  - url: https://github.com/WebAssembly/wasi-libc/archive/refs/tags/wasi-sdk-20.tar.gz
    sha256: 0a1c09c8c1da62a1ba214254ff4c9db6b60979c00f648a5eae33831d6ee2840e
    target_directory: wasi-libc
  - url: https://github.com/apple/swift-format/archive/refs/heads/release/6.0.zip
    sha256: 44b275ca2bc53aa373358e7a9ed84a7a130ab00e1119fc481a06a5b894e8f35f
    target_directory: swift-format
  - url: https://github.com/apple/swift-llvm-bindings/archive/refs/heads/swift/release/6.0.zip
    sha256: b011be4c3e129b6cedf3ff59404ae6112b60020ec87c3892dd463609a8d7a94a
    target_directory: swift-llvm-bindings
  - url: https://github.com/apple/swift-foundation-icu/archive/refs/heads/release/6.0.zip
    sha256: f52225aeb342de62db0cd3fa4fb56e5c05af6a3b121c2b71ddd02856f3cd6da5
    target_directory: swift-foundation-icu
  - url: https://github.com/apple/swift-foundation/archive/refs/heads/release/6.0.zip
    sha256: 2094f4a826e146abc1142ad730c0e72762550b58ca567d39374e5756b58850c8
    target_directory: swift-foundation
  - url: https://github.com/madler/zlib/releases/download/v1.3/zlib13.zip
    sha256: c561d09347f674f0d72692e7c75d9898919326c532aab7f8c07bb43b07efeb38
    target_directory: zlib

build:
  skip:
    - not linux
  script: build.sh
  number: 0

requirements:
  build:
    - ${{ compiler('cxx') }}
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - clangxx
    - clang
    - cmake <4
    - ninja
    - git
    - patch
    - make
    - bash
    # Python removed the `pipes` module in 3.13 which is used, so we need to use 3.12.
    - python 3.12.*
  host:
    - glib
    - glib-tools
    - binutils
    - libgomp
    - libxml2
    - sqlite
    - ncurses
    - libedit
    - swig
    - rsync
    - curl

tests:
  - script:
    - swift --version
    - swift --help

about:
  homepage: https://swift.org
  summary: 'The Swift Programming Language'
  description: |
    Swift is a high-performance system programming language. It has a clean and modern syntax,
    offers seamless access to existing C and Objective-C code and frameworks, and is memory-safe by default.

    Swift is a complete and independent language that packages core features like flow control,
    data structures, and functions, with high-level constructs like objects, protocols, closures, and generics.
  license: Apache-2.0
  license_file: LICENSE.txt
  documentation: https://swift.org/documentation/
  repository: https://github.com/swiftlang/swift

extra:
  recipe-maintainers:
    - jjerphan
