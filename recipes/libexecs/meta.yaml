{% set name = "libexecs" %}
{% set version = "1.3" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/virtualsquare/s2argv-execs/archive/refs/tags/{{ version }}.tar.gz
  sha256: e091ed0b3cd015228bef1cbcac7624c87974355a1d0652ed451c1d9f08253f10

build:
  number: 0
  run_exports:
    # only releases x.x (so far) so this is allowing rebuilds of same library version to be used
    # without rebuilding downstream but that's it
    - {{ pin_subpackage('libexecs', max_pin='x.x') }}

requirements:
  build:
    - {{ compiler('c') }}
    - cmake

# XXX add tests for windows
test:                                           # [unix]
  requires:                                     # [unix]
    - {{ compiler('c') }}                       # [unix]
    - make                                      # [unix]
  source_files:                                 # [unix]
    - execstest.c                               # [unix]
  commands:                                     # [unix]
    - make execstest LDLIBS=-lexecs             # [unix]
    - rm -f TEST_CANARY                         # [unix]
    - echo "touch TEST_CANARY" | ./execstest    # [unix]
    - test -f TEST_CANARY                       # [unix]

about:
  home: https://github.com/virtualsquare/s2argv-execs
  license: LGPL-2.1-only
  license_family: GPL
  license_file: 
      - COPYING
  summary: 'execute a file taking its arguments from a string'
  description: |
    converts a command string into an argv array for execv, execvp, execvpe. execs is like execv
    taking a string instead of an argv. Similarly execsp and execspe are the counterpart of execvp
    and execvpe, respectively, using command strings.
  dev_url: https://github.com/virtualsquare/s2argv-execs

extra:
  recipe-maintainers:
    - timsnyder
