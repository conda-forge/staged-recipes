context:
  name: json-glib
  version: 1.10.8
  version_majmin: ${{ (version | split('.'))[:2] | join('.') }}

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: "https://download.gnome.org/sources/${{ name }}/${{ version_majmin }}/${{ name }}-${{ version }}.tar.xz"
  sha256: 55c5c141a564245b8f8fbe7698663c87a45a7333c2a2c56f06f811ab73b212dd

build:
  number: 0
  script:
    - if: win
      then: |
        meson setup %MESON_ARGS% ^
          --prefix=%LIBRARY_PREFIX% ^
          --default-library=shared ^
          --wrap-mode=nofallback ^
          --buildtype=release ^
          -Ddocumentation=disabled ^
          builddir
        ninja -v -C builddir -j %CPU_COUNT%
        ninja -C builddir install -j %CPU_COUNT%
    - if: osx
      then: |
        # Define _DARWIN_C_SOURCE to expose POSIX.1-2008 functions like strnlen
        export CFLAGS="${CFLAGS} -D_DARWIN_C_SOURCE"
    - if: unix
      then: |
        meson setup ${MESON_ARGS} \
            --prefix=$PREFIX \
            --default-library=shared \
            --wrap-mode=nofallback \
            -Ddocumentation=disabled \
            builddir
        ninja -v -C builddir -j ${CPU_COUNT}
        ninja -C builddir install -j ${CPU_COUNT}

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - meson
    - ninja
    - pkg-config
    - gobject-introspection
  host:
    - glib
    - gobject-introspection
    - zlib
  run_exports:
    - ${{ pin_subpackage('json-glib', upper_bound='x.x') }}
  ignore_run_exports:
    by_name:
      - libzlib

tests:
  - package_contents:
      files:
        - if: unix
          then:
            - lib/pkgconfig/json-glib-1.0.pc
        - if: win
          then:
            - Library/lib/pkgconfig/json-glib-1.0.pc
            - Library/lib/json-glib-1.0.lib
      lib:
        - if: unix
          then: json-glib-1.0

about:
  homepage: https://gitlab.gnome.org/GNOME/json-glib
  summary: JSON-GLib implements a full suite of JSON-related tools using GLib and GObject.
  description: |
    Use JSON-GLib it is possible to parse and generate valid JSON data
    structures using a DOM-like API. JSON-GLib also integrates with GObject to
    provide the ability to serialize and deserialize GObject instances to and from
    JSON data types.
  license: LGPL-2.1-or-later
  license_file: COPYING
  documentation: hhttps://gnome.pages.gitlab.gnome.org/json-glib/
  repository: https://gitlab.gnome.org/GNOME/json-glib

extra:
  recipe-maintainers:
    - haecker-felix
    - Hofer-Julian
