{% set version = "1.26.8" %}

package:
  name: gst-rtsp-server
  version: {{ version }}

source:
  - url: https://gstreamer.freedesktop.org/src/gst-rtsp-server/gst-rtsp-server-{{ version }}.tar.xz
    sha256: 5c0ab4822d8dc381f1449abefcfcde0ba6fdb4be58f84002522923965e3b1293
    folder: rtsp_server

build:
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ stdlib('c') }}
    - {{ compiler('cxx') }}
    - pkg-config
    - meson
    - ninja
    - gettext-tools
    - gobject-introspection
    - cross-python_{{ target_platform }} 3.10    # [build_platform != target_platform]
    - setuptools <81
  host:
    - python 3.10  # [build_platform != target_platform]
    - gstreamer {{ version }}
    - gst-plugins-base {{ version }}
    - glib
    - libintl-devel  # [not linux]
    - libiconv
    - zlib
  run:
    - python
    - gstreamer {{ version }}
    - gst-plugins-base {{ version }}
    - libsoup                            # [not ppc64le]
    - glib-networking                    # [not ppc64le]

test:
  commands:
    - test -f $PREFIX/include/gstreamer-1.0/gst/rtsp-server/rtsp-server.h  # [unix]
    - test -f $PREFIX/lib/libgstrtspserver-1.0${SHLIB_EXT}  # [unix]
    - test -f $PREFIX/lib/gstreamer-1.0/libgstrtspclientsink${SHLIB_EXT}  # [unix]
    - echo LIBRARY_PREFIX %LIBRARY_PREFIX%  # [win]
#    - if not exist %PREFIX%\\include\\gstreamer-1.0\\gst\\rtsp-server\\rtsp-server.h exit 1  # [win]
#    - if not exist %PREFIX%\\bin\\gstrtspserver-1.0.dll exit 1                    # [win]
    - echo test for gstrtspclientsink.dll, PREFIX = %PREFIX%  # [win]
    - if not exist %LIBRARY_PREFIX%\\lib\\gstreamer-1.0\\gstrtspclientsink.dll (
    echo "not found:" %LIBRARY_PREFIX%\\lib\\gstreamer-1.0\\gstrtspclientsink.dll
    exit 1)  # [win]
    - gst-inspect-1.0 --plugin rtspclientsink  # [win]
about:
  home: http://gstreamer.freedesktop.org/
  summary: 'GStreamer RTSP Server'
  description: |
    GStreamer RTSP Server is a library on top of GStreamer for building an RTSP server.
  doc_source_url: https://gitlab.freedesktop.org/gstreamer/gstreamer/-/tree/main/subprojects/gst-rtsp-server/docs
  license: LGPL-2.1-or-later
  license_family: LGPL
  license_file: COPYING
  doc_url: https://gstreamer.freedesktop.org/modules/gst-rtsp-server.html
  dev_url: https://gitlab.freedesktop.org/gstreamer/gstreamer/-/tree/main/subprojects/gst-rtsp-server
extra:
  recipe-maintainers:
    - tjwilli58
