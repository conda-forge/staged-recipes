{% set version = '1.0.0' %}
{% set posix = 'm2-' if win else '' %}

package:
  name: r-dfms
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/dfms_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/dfms/dfms_{{ version }}.tar.gz
  sha256: 8414bae89f514af939a848e03c10723f8a5b76a6aefa3d0aaab20d1ed32d7d98

build:
  number: 0
  rpaths:
    - lib/R/lib/
    - lib/
  missing_dso_whitelist:
    - '*/R.dll'        # [win]
    - '*/Rblas.dll'    # [win]
    - '*/Rlapack.dll'  # [win]

requirements:
  build:
    - {{ compiler('c') }}              # [not win]
    - {{ compiler('m2w64_c') }}        # [win]
    - {{ compiler('cxx') }}            # [not win]
    - {{ compiler('m2w64_cxx') }}      # [win]
    - {{ stdlib('c') }}                # [not win]
    - {{ posix }}filesystem        # [win]
    - {{ posix }}make
    - {{ posix }}sed               # [win]
    - {{ posix }}coreutils         # [win]
    - {{ posix }}zip               # [win]
    - cross-r-base {{ r_base }}    # [build_platform != target_platform]
  host:
    - r-base
    - r-rcpp >=1.0.1
    - r-rcpparmadillo
    - r-collapse >=2.0.0
  run:
    - r-base
    - r-rcpp >=1.0.1
    - r-rcpparmadillo
    - r-collapse >=2.0.0

test:
  commands:
    - $R -e "library('dfms')"           # [not win]
    - "\"%R%\" -e \"library('dfms')\""  # [win]

about:
  home: https://docs.ropensci.org/dfms/, https://github.com/ropensci/dfms
  license: GPL-3.0-only
  summary: 'Efficient estimation of Dynamic Factor Models using the Expectation Maximization
    (EM) algorithm or Two-Step (2S) estimation, supporting datasets with missing data
    and mixed-frequency nowcasting applications. Factors follow a stationary VAR process
    of order p. Estimation options include: running the Kalman Filter and Smoother once
    with PCA initial values (2S) as in Doz, Giannone and Reichlin (2011) <doi:10.1016/j.jeconom.2011.02.012>;
    iterated Kalman Filtering and Smoothing until EM convergence as in Doz, Giannone
    and Reichlin (2012) <doi:10.1162/REST_a_00225>; or the adapted EM algorithm of Banbura
    and Modugno (2014) <doi:10.1002/jae.2306>, allowing arbitrary missing-data patterns
    and monthly-quarterly mixed-frequency datasets. The implementation uses the ''Armadillo''
    ''C++'' library and the ''collapse'' package for fast estimation. A comprehensive
    set of methods supports interpretation and visualization, forecasting, and decomposition
    of the ''news'' content of macroeconomic data releases following Banbura and Modugno
    (2014). Information criteria to choose the number of factors are also provided,
    following Bai and Ng (2002) <doi:10.1111/1468-0262.00273>.'
  license_family: GPL3
  license_file:
    - {{ environ["PREFIX"] }}/lib/R/share/licenses/GPL-3

extra:
  recipe-maintainers:
    - conda-forge/r
    - SebKrantz
