From 04c6631102716182a5df671a57bd0a944dfc195e Mon Sep 17 00:00:00 2001
From: Daniel Ching <dching@nvidia.com>
Date: Tue, 10 Sep 2024 18:12:59 -0500
Subject: [PATCH 02/10] BLD: pybind11 dlpack only needed when building for
 python

Also allow system libraries for these deps
---
 CMakeLists.txt          |  3 +++
 external/CMakeLists.txt | 15 +++++++++++++--
 2 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7f9f1ae..7e19bdf 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -95,6 +95,9 @@ option(BUILD_LIBTIFF_EXT "Build libtiff extensions module" ON)
 option(BUILD_OPENCV_EXT "Build opencv extensions module" ON)
 option(BUILD_PYTHON "Build Python binding" ON)
 option(BUILD_WHEEL "Build python wheel package" ON)
+option(NVIMG_CODEC_USE_SYSTEM_DLPACK "Use system installed dlpack" OFF)
+option(NVIMG_CODEC_USE_SYSTEM_PYBIND "Use system installed pybind11" OFF)
+
 
 cmake_dependent_option(WITH_DYNAMIC_NVJPEG "Dynamically loads nvjpeg at runtime" ON
                       "BUILD_NVJPEG_EXT" OFF)
diff --git a/external/CMakeLists.txt b/external/CMakeLists.txt
index 50685ce..88ff95d 100644
--- a/external/CMakeLists.txt
+++ b/external/CMakeLists.txt
@@ -1,2 +1,13 @@
-add_subdirectory(pybind11 EXCLUDE_FROM_ALL)
-add_subdirectory(dlpack EXCLUDE_FROM_ALL)
\ No newline at end of file
+if(BUILD_PYTHON)
+    if(NVIMG_CODEC_USE_SYSTEM_PYBIND)
+        find_package(pybind11 REQUIRED)
+    else()
+        add_subdirectory(pybind11 EXCLUDE_FROM_ALL)
+    endif(NVIMG_CODEC_USE_SYSTEM_PYBIND)
+    if(NVIMG_CODEC_USE_SYSTEM_DLPACK)
+        find_package(dlpack REQUIRED)
+    else()
+        add_subdirectory(dlpack EXCLUDE_FROM_ALL)
+    endif(NVIMG_CODEC_USE_SYSTEM_DLPACK)
+endif(BUILD_PYTHON)
+
-- 
2.47.0

