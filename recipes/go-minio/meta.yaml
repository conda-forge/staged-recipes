{% set name = "go-minio" %}
{% set version = "RELEASE.2022-07-17T15-43-14Z" %}
{% set conda_version = version.split('.')[1] | replace('Z', '') | replace('T', '.') | replace('-', '.') %}
{% set gomodule = "github.com/minio/minio" %}
{% set rawgit = "https://raw.githubusercontent.com" %}
{% set ext = "extra_licenses/github.com" %}

package:
  name: {{ name }}
  version: {{ conda_version }}

source:
  - folder: src/{{ gomodule }}
    url: https://{{ gomodule }}/archive/refs/tags/{{ version }}.tar.gz
    sha256: d34b045de228792dbbbaab487193719e7791d9c9daa9d4d45881a8554d47d5c5

  # TODO: remove licenses as they become discoverable by go-licenses
  - fn: {{ conda_version }}-siphash-LICENSE
    folder: {{ ext }}/dchest/siphash
    url: {{ rawgit }}/dchest/siphash/master/LICENSE
    sha256: a2010f343487d3f7618affe54f789f5487602331c0a8d03f49e9a7c547cf0499

build:
  number: 0

requirements:
  build:
    # TODO: see https://github.com/conda-forge/go-feedstock/issues/141
    # - {{ compiler('cgo') }}  # [unix]
    - go >=1.15.2           # [unix]
    - go-nocgo >=1.15.2     # [unix]
    - {{ compiler('go') }}  # [win]
    - posix  # [win]
    - go-licenses
    - make  # [unix]
  host: []
  run_constrained:
    - __osx >={{ MACOSX_DEPLOYMENT_TARGET|default("10.9") }}  # [osx and x86_64]

test:
  commands:
    - minio --version
    - minio --help
    
about:
  home: https://ipfs.io
  license: Apache-2.0 or MIT
  license_file:
    # directly provided by upstream
    - src/{{ gomodule }}/LICENSE
    # ~10 upstreams fail.
    - library_licenses/
    - go-licenses.log
    # these have since added license files, or have upstream PRs to do so
    - extra_licenses/

  summary: IPFS implementation in Go

  description: |
    IPFS is a global, versioned, peer-to-peer filesystem. It combines good ideas
    from previous systems such as Git, BitTorrent, Kademlia, SFS, and the Web.
    It is like a single BitTorrent swarm, exchanging git objects. IPFS provides
    an interface as simple as the HTTP web, but with permanence built-in. You
    can also mount the world at /ipfs.
  doc_url: https://docs.ipfs.io
  dev_url: https://{{ gomodule }}

extra:
  recipe-maintainers:
    - mariusvniekerk
