{% set name = "openlineage-suite" %}
{% set version = "0.19.2" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://pypi.io/packages/source/{{ name[0] }}/openlineage-python/openlineage-python-{{ version }}.tar.gz
    sha256: 88e411d694a44c28f2db11152d780553a0ceafeea43ca5e5f74310850b02dec4  
  - url: https://pypi.io/packages/source/{{ name[0] }}/openlineage_sql/openlineage_sql-{{ version }}.tar.gz
    sha256: d484202b6b36c20bf9cfc9d327c21c389dc30ea7e90f9a9b514be8149ab0094f
  - url: https://pypi.io/packages/source/{{ name[0] }}/openlineage-integration-common/openlineage-integration-common-{{ version }}.tar.gz
    sha256: 52b9270b5000e0f0c6da963d2395ad02f1d80bf74747177d4fd7cef028c6c658  
  
build:
  number: 0
  noarch: python

outputs:
  - name: openlineage-python
    build:
      noarch: python
      script: python -m pip install . -vv

    requirements:
      host:
        - python >=3.7
        - pip
      run:
        - python >=3.7
        - attrs >=19.3.0
        - requests >=2.20.0
        - pyyaml >=5.1.0
        - python-dateutil
    test:
      imports:
        - openlineage.client
        - openlineage.client.transport
      commands:
        - pip check
      requires:
        - pip

  - name: openlineage-sql
    build:
      noarch: python
      script: python -m pip install . -vv

    requirements:
      build:
        - {{ compiler('rust') }}
      host:
        - python >=3.7
        - pip
        - maturin
      run:
        - python >=3.7

    test:
      imports:
        - openlineage_sql
      commands:
        - pip check
      requires:
        - pip

  - name: openlineage-integration-common
    build:
      noarch: python
      script: python -m pip install . -vv

    requirements:
      host:
        - python >=3.7
        - pip
      run:
        - python >=3.7
        - attrs >=19.3.0
        - {{ pin_subpackage("openlineage-python", exact=True) }}        

    test:
      imports:
        - openlineage.common
        - openlineage.common.provider
      commands:
        - pip check
      requires:
        - pip

about:
  home: https://github.com/OpenLineage/OpenLineage
  summary: OpenLineage is an Open standard for metadata and lineage collection.
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE

extra:
  recipe-maintainers:
    - rxm7706
