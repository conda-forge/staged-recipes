{% set version = "0.3.0" %}

package:
  name: interpret-suite
  version: {{ version }}

source:
  git_url: https://github.com/interpretml/interpret.git
  git_rev: "v{{ version }}"
  git_depth: 1

build:
  number: 0

outputs:
  - name: interpret-core

    build:
      number: 0
      directory: interpret-core
      skip: true  # [py>=39 or py2k or py<37]
      skip: true  # [win or osx]
      #script: Xcopy /E /I shared python\interpret-core\symbolic\shared  # [win]
      script: cp -r shared python/interpret-core/symbolic/shared  # [not win]
      script: "npm install --package-lock-only --ignore-scripts && npx npm-force-resolutions"
      script: "npm install --package-lock-only --ignore-scripts && npx force-resolutions"
      script: cd python/interpret-core && python setup.py build && python setup.py install
    requirements:
      build:
        - python                                 # [build_platform != target_platform]
        - cross-python_{{ target_platform }}     # [build_platform != target_platform]
        - numpy                                  # [build_platform != target_platform]
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - gxx  # [linux]
        - nodejs >=16.0,<17.0
      host:
        - python
        - pip
        - nodejs >=16.0,<17.0

      run:
        - python
        - nodejs >=16.0,<17.0

    # Equiv. to required.
        - scikit-learn >=0.18.1
        - numpy >=1.11.1
        - scipy >=0.18.1
        - pandas >=0.19.2
        - joblib >=0.11

        - {{ pin_compatible('numpy') }}

      run_constrained:
    # Equiv. to required.
        - python
        - nodejs >=16.0,<17.0

        - scikit-learn >=0.18.1
        - numpy >=1.11.1
        - scipy >=0.18.1
        - pandas >=0.19.2
        - joblib >=0.11
    # Equiv. to extras.
        - ipython >=7.4.0
        - ipykernel >=5.1.0
        - plotly >=3.8.1
        - psutil >=5.6.2
        - lime >=0.1.1.33
        - SALib >=1.3.3
        - shap >=0.28.5
        - skope-rules >=1.0.1    
        - treeinterpreter >=0.2.2
        - dill >=0.2.5
    # Equiv. to Dash.
        - dash >=1.0.0
        - dash-cytoscape >=0.1.1
#        - dash-table >=4.1.0
        - gevent >=1.3.6
        - requests >=2.19.0

        - {{ pin_compatible('numpy') }}

    test:
      requires:
        - pytest >=4.3.0,<=6.0.2
        - pytest-runner >=4.4
        - pytest-xdist >=1.29
        - nbconvert >=5.4.1
        - selenium >=3.141.0
        - pytest-cov >=2.6.1
        - flake8 >=3.7.7
        - jupyter >=1.0.0
        - ipywidgets >=7.4.2
      imports:
        - interpret.ext.blackbox


  - name: interpret
    build:
      number: 0
      directory: interpret
      skip: true  # [py>=39 or py2k or py<37]
      skip: true  # [win or osx]
 #     script: python -m pip install python/interpret -vv
#      script: Xcopy /E /I shared python\interpret\symbolic\shared  # [win]
#      script: cp -r shared python/interpret/symbolic/shared  # [not win]
#      script: "npm install --package-lock-only --ignore-scripts && npx npm-force-resolutions"
#      script: "npm install --package-lock-only --ignore-scripts && npx force-resolutions"
#      script: cd python/interpret && python setup.py build && python setup.py install
#      script: cd python/interpret && python -m pip install . -vv
#      script: python setup.py install python/interpret --single-version-externally-managed --record=record.txt --no-deps --ignore-installed --no-cache-dir -vvv
       script: cd python/interpret && python setup.py install --single-version-externally-managed --record=record.txt
    requirements:
#      build:
#        - python                                 # [build_platform != target_platform]
#        - cross-python_{{ target_platform }}     # [build_platform != target_platform]
#        - numpy                                  # [build_platform != target_platform]
#        - {{ compiler('c') }}
#        - {{ compiler('cxx') }}
#        - gxx  # [linux]
#        - nodejs >=16.0,<17.0
      host:
        - python >3.7,<3.10
        - pip
#        - nodejs >=16.0,<17.0
      run:
        - python >3.7,<3.10
#        - nodejs >=16.0,<17.0

    # Equiv. to required.
        - scikit-learn >=0.18.1
        - numpy >=1.11.1
        - scipy >=0.18.1
        - pandas >=0.19.2
        - joblib >=0.11

#        - {{ pin_compatible('numpy') }}

        - {{ pin_subpackage('interpret-core', max_pin="x.x.x") }}

    # Equiv. to extras.
        - ipython >=7.4.0
        - ipykernel >=5.1.0
        - plotly >=3.8.1
        - psutil >=5.6.2
        - lime >=0.1.1.33
        - SALib >=1.3.3
        - shap >=0.28.5
        - skope-rules >=1.0.1    
        - treeinterpreter >=0.2.2
        - dill >=0.2.5
    # Equiv. to Dash.
        - dash >=1.0.0
        - dash-cytoscape >=0.1.1
#        - dash-table >=4.1.0
        - gevent >=1.3.6
        - requests >=2.19.0

#      run_constrained:
#    # Equiv. to required.
#        - python >3.7,<3.10
#        - nodejs >=16.0,<17.0

#        - scikit-learn >=0.18.1
#        - numpy >=1.11.1
#        - scipy >=0.18.1
#        - pandas >=0.19.2
#        - joblib >=0.11
#    # Equiv. to extras.
#        - ipython >=7.4.0
#        - ipykernel >=5.1.0
#        - plotly >=3.8.1
#        - psutil >=5.6.2
#        - lime >=0.1.1.33
#        - SALib >=1.3.3
#        - shap >=0.28.5
#        - skope-rules >=1.0.1    
#        - treeinterpreter >=0.2.2
#        - dill >=0.2.5
#    # Equiv. to Dash.
#        - dash >=1.0.0
#        - dash-cytoscape >=0.1.1
#        - dash-table >=4.1.0
#        - gevent >=1.3.6
#        - requests >=2.19.0

#        - {{ pin_compatible('numpy') }}

    test:
      imports:
        - interpret.ext.blackbox

about:
  home: "https://github.com/interpretml/interpret"
  license: MIT
  license_family: MIT
  license_file:  LICENSE
  summary: "Fit interpretable models. Explain blackbox machine learning."

extra:
  recipe-maintainers:
    - rxm7706
