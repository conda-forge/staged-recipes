From f8c3bbf7dd82410d2195fa23ccd30db18cd49634 Mon Sep 17 00:00:00 2001
From: Ista Zahn <istazahn@gmail.com>
Date: Fri, 25 Mar 2022 15:52:55 -0400
Subject: [PATCH] standard directory layout

---
 CMakeGlobals.txt                     | 2 +-
 src/cpp/desktop/DesktopOptions.cpp   | 5 ++++-
 src/cpp/session/CMakeLists.txt       | 6 +++---
 src/cpp/session/session-options.json | 2 +-
 4 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/CMakeGlobals.txt b/CMakeGlobals.txt
index de77b8d1ee..068e950729 100644
--- a/CMakeGlobals.txt
+++ b/CMakeGlobals.txt
@@ -294,7 +294,7 @@ else()
    else()
      set(RSTUDIO_INSTALL_BIN bin)
    endif()
-   set(RSTUDIO_INSTALL_SUPPORTING .)
+   set(RSTUDIO_INSTALL_SUPPORTING share/rstudio)
 endif()
 
 # if the install prefix is /usr/local then tweak as appropriate
diff --git a/src/cpp/desktop/DesktopOptions.cpp b/src/cpp/desktop/DesktopOptions.cpp
index 26b7c579e8..a32248b48b 100644
--- a/src/cpp/desktop/DesktopOptions.cpp
+++ b/src/cpp/desktop/DesktopOptions.cpp
@@ -453,7 +453,7 @@ FilePath Options::supportingFilePath() const
             supportingFilePath_ = supportingFilePath_.completePath("Resources");
 #endif
    }
-   return supportingFilePath_;
+   return supportingFilePath_.completePath("share/rstudio");
 }
 
 FilePath Options::resourcesPath() const
@@ -468,6 +468,9 @@ FilePath Options::resourcesPath() const
       // developer configuration: the 'resources' folder is
       // a sibling of the RStudio executable
       resourcesPath_ = scriptsPath().completePath("resources");
+      // conda-forge configuration: the 'resources' folder is
+      // still part of the supporting files folder
+      resourcesPath_ = supportingFilePath().completePath("resources");
 #endif
    }
 
diff --git a/src/cpp/session/CMakeLists.txt b/src/cpp/session/CMakeLists.txt
index 1dfc9776ac..e331da51c8 100644
--- a/src/cpp/session/CMakeLists.txt
+++ b/src/cpp/session/CMakeLists.txt
@@ -689,9 +689,9 @@ if(NOT RSTUDIO_SESSION_WIN32 AND NOT RSESSION_ALTERNATE_BUILD)
                USE_SOURCE_PERMISSIONS)
       endif()
    else()
-      install(DIRECTORY "${RSTUDIO_DEPENDENCIES_PANDOC_DIR}/"
-              DESTINATION "${RSTUDIO_INSTALL_BIN}/pandoc"
-              USE_SOURCE_PERMISSIONS)
+      # install(DIRECTORY "${RSTUDIO_DEPENDENCIES_PANDOC_DIR}/"
+      #         DESTINATION "${RSTUDIO_INSTALL_BIN}/pandoc"
+      #         USE_SOURCE_PERMISSIONS)
    endif()
 
    # install embedded packages
diff --git a/src/cpp/session/session-options.json b/src/cpp/session/session-options.json
index c361250679..db0d51f4a5 100644
--- a/src/cpp/session/session-options.json
+++ b/src/cpp/session/session-options.json
@@ -560,7 +560,7 @@
             "name": "r-resources-path",
             "type": "core::FilePath",
             "memberName": "rResourcesPath_",
-            "defaultValue": "resources",
+            "defaultValue": "share/rstudio/resources",
             "description": "Specifies the directory containing external resources."
          },
          {
-- 
2.35.1

