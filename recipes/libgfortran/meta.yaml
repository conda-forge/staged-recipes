{% set gfortran_version = [7, 3, 0] %}
{% set libgfortran_version = [4, 0, 0] %}
{% set libquadmath_version = [0, 0, 0] %}
{% set libgcc_s_version = [1, 0, 0] %}

package:
  name: libgfortran
  version: {{ libgfortran_version|join('.') }}

build:
  number: 1
  skip: true                                                  # [not osx]
  always_include_files:
    - lib/libgfortran.dylib                                   # [osx]
    - lib/libgfortran.{{ libgfortran_version[0] }}.dylib      # [osx]
    - lib/libgomp.dylib  # [osx]
    - lib/libgomp.{{ libgcc_s_version[0] }}.dylib  # [osx]

    # Including libquadmath for the time
    # being. This will need to be broken
    # out in the long term.
    - lib/libquadmath.dylib                                   # [osx]
    - lib/libquadmath.{{ libquadmath_version[0] }}.dylib      # [osx]

    # Including libgcc_s for the time
    # being. This will need to be broken
    # out in the long term.
    - lib/libgcc_s.{{ libgcc_s_version[0] }}.dylib            # [osx]
    - lib/libgcc_s_ppc64.{{ libgcc_s_version[0] }}.dylib      # [osx]
    - lib/libgcc_s_x86_64.{{ libgcc_s_version[0] }}.dylib     # [osx]
  run_exports:
    - libgfortran >={{ libgfortran_version|join('.') }}

requirements:
  host:
    - gfortran-dev_{{ target_platform }} ={{ gfortran_version|join('.') }}

test:
  commands:
    - test -f "${PREFIX}/lib/libgfortran.dylib"                                   # [osx]
    - test -f "${PREFIX}/lib/libgfortran.{{ libgfortran_version[0] }}.dylib"      # [osx]

    - test -f "${PREFIX}/lib/libgomp.dylib"  # [osx]
    - test -f "${PREFIX}/lib/libgomp.{{ libgcc_s_version[0] }}.dylib"  # [osx]

    # Including libquadmath for the time
    # being. This will need to be broken
    # out in the long term.
    - test -f "${PREFIX}/lib/libquadmath.dylib"                                   # [osx]
    - test -f "${PREFIX}/lib/libquadmath.{{ libquadmath_version[0] }}.dylib"      # [osx]

    # Including libgcc_s for the time
    # being. This will need to be broken
    # out in the long term.
    - test -f "${PREFIX}/lib/libgcc_s.{{ libgcc_s_version[0] }}.dylib"            # [osx]
    - test -f "${PREFIX}/lib/libgcc_s_ppc64.{{ libgcc_s_version[0] }}.dylib"      # [osx]
    - test -f "${PREFIX}/lib/libgcc_s_x86_64.{{ libgcc_s_version[0] }}.dylib"     # [osx]

about:
  home: http://gcc.gnu.org/
  license: GPL 3 (with GCC Runtime Library Exception 3.1)
  license_family: GPL
  summary: Fortran libraries from the GNU Compiler Collection

extra:
  recipe-maintainers:
    - jakirkham
    - msarahan
    - pelson
    - beckermr
