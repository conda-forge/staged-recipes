# ref: https://github.com/conda-forge/scikit-learn-feedstock/blob/main/recipe/meta.yaml
{% if CI is not defined %}{% set CI=False %}{% endif %}
{% set name = "scikit-plots" %}  # Name of the package, e.g., "scikit-plots"
{% set suffix = ".post2" %}  # sometimes used to match PyPI releases
{% set version = "0.4.0" ~ suffix %}  # version of the package with suffix (e.g., "0.4.0.post1")
# {% set tag = "v" ~ version if version.startswith("v") else version ~ suffix %}  # ensure full tag starts with 'v' (e.g., 'v0.4.0.post1')

# (Optional) Update the numpy value here to the most recent released version
# when updating to a new scipy feature release; override default pins
# {% set numpy = "2.2.1" %}
# {% set numpy_minor = numpy.split(".")[1] | int %}

# ensure is_freethreading gets detected as a used variable
# [is_freethreading]

package:
  name: {{ name|lower }}  # e.g., "scikit-plots"
  version: {{ version }}  # e.g., "0.4.0.post1"

source:
  # https://github.com/scikit-plots/scikit-plots/archive/refs/tags/v0.4.0.post2.tar.gz  # original source URL
  # url: https://github.com/scikit-plots/scikit-plots/archive/v0.4.0.post2.tar.gz
  url: https://github.com/{{ name }}/{{ name }}/archive/v{{ version }}.tar.gz
  # git archive --format=tar.gz HEAD | sha256sum
  # git archive --format=tar.gz f64edaac561779cb44b0052f67b715047ba299ce | sha256sum
  # sha256: c9c0b59e945a141975af5044001257266a31d540a078543546af2154dab9ae88
  sha256: 9cc7eeac78b72b20c7d60bf2f51e409ca687ca92ed565b15010dea21f2660a83

build:
  number: 0
  skip: true  # [py<310]
  # skip: true  # [python_impl == "pypy"]

requirements:
  build:
    - python                                 # [build_platform != target_platform]
    - cross-python_{{ target_platform }}     # [build_platform != target_platform]
    - meson                                  # [build_platform != target_platform]
    - ninja                                  # [build_platform != target_platform]
    - meson-python                           # [build_platform != target_platform]
    - cython                                 # [build_platform != target_platform]
    - pybind11                               # [build_platform != target_platform]
    - pythran                                # [build_platform != target_platform]
    - numpy                                  # [build_platform != target_platform]
    - scipy                                  # [build_platform != target_platform]
    - pkg-config                             # [build_platform != target_platform]
    - cmake                                  # [build_platform != target_platform]
    - clang                                  # [win]
    - llvm-openmp                            # [osx]
    - libgomp                                # [linux]
    - {{ stdlib('c') }}
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('fortran') }}
    # - patchelf
  host:
    - git  # Git is required to clone the repository and checkout specific revisions
    - git-lfs  # Git LFS is required for large files stored in LFS
    - libblas
    - libcblas
    - liblapack
    - pkg-config
    - python
    - pip
    - python-build
    - meson
    - ninja
    - meson-python
    - cython
    - pybind11
    - pythran
    - numpy
    - scipy
    - joblib >=1.2.0
    - threadpoolctl >=3.1.0
    # - scipy >=1.6.0  # [not aarch64]
    # - scipy >=1.8  # [aarch64]
    # See https://github.com/conda-forge/openmp-feedstock/issues/126
    - llvm-openmp  # [osx]
    - libgomp  # [linux]  
  run:
    - python
    # numpy's run-export only requires <3 because not every package
    # is exposed as deeply to its ABI. scipy however only supports
    # the two next minor versions after the numpy we build against, see
    # https://scipy.github.io/devdocs/dev/core-dev/index.html#version-ranges-for-numpy-and-other-dependencies
    # - numpy <2.{{ numpy_minor + 3 }}
    # double-check lower bound from
    # https://github.com/scipy/scipy/blob/v{{ version }}/pyproject.toml#L55
    - numpy
    - scipy
    - pandas >=1.2.0
    - matplotlib-base >=3.4,!=3.6.1
    - joblib >=1.2.0
    - threadpoolctl >=3.1.0
    - importlib-metadata  # [py<310]
    - scikit-learn >=1.3.0rc1
    - pillow >=6.2.0
    - aggdraw >=1.3.11  # [sys_platform != "emscripten"]
    ## [not (platform_system == "Emscripten" and (platform_machine == "wasm32" or platform_machine == "wasm64"))]

test:
  imports:
    - scikitplot
  requires:
    - pip
    - pytest
    - hypothesis
  commands:
    # - pip check
    - python -c "import scikitplot; scikitplot.show_config()"

about:
  # The doc_url and dev_url are optional.
  home: https://scikit-plots.github.io/dev
  doc_url: https://scikit-plots.github.io/dev
  dev_url: https://github.com/scikit-plots/scikit-plots
  # https://github.com/scikit-plots/scikit-plots?tab=BSD-3-Clause-1-ov-file
  license_url: https://scikit-plots.github.io/dev/project/license.html
  license: BSD-3-Clause
  license_family: BSD
  license_file:
    - LICENSE.txt
  summary: |-
    scikit-plots: Machine Learning Visualization in Python
  description: |-
    An intuitive library that seamlessly adds plotting capabilities and functionality
    to any model objects or outputs, compatible with tools like scikit-learn, XGBoost,
    TensorFlow, and more.

extra:
  recipe-maintainers:
    # GitHub IDs for maintainers of the recipe.
    # Always check with the people listed below if they are OK becoming maintainers of the recipe. (There will be spam!)
    - celik-muhammed
  feedstock-name: scikit-plots
