From 1464998b474b9b878af21294fad3eb52aa66de37 Mon Sep 17 00:00:00 2001
From: Mark Harfouche <mark.harfouche@gmail.com>
Date: Sat, 22 Nov 2025 15:12:22 -0500
Subject: [PATCH] Lazy import decord to avoid a hard dependency on it

---
 sam3/train/data/sam3_image_dataset.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/sam3/train/data/sam3_image_dataset.py b/sam3/train/data/sam3_image_dataset.py
index 97efb1d1..b50b94e7 100644
--- a/sam3/train/data/sam3_image_dataset.py
+++ b/sam3/train/data/sam3_image_dataset.py
@@ -15,7 +15,6 @@
 import torch
 import torch.utils.data
 import torchvision
-from decord import cpu, VideoReader
 from iopath.common.file_io import g_pathmgr
 
 from PIL import Image as PILImage
@@ -181,6 +180,9 @@ def __init__(
     def _load_images(
         self, datapoint_id: int, img_ids_to_load: Optional[Set[int]] = None
     ) -> Tuple[List[Tuple[int, PILImage.Image]], List[Dict[str, Any]]]:
+        # Lazy load decord to avoid a hard dependency on it on the sam3
+        # package as a whole
+        from decord import cpu, VideoReader
         all_images = []
         all_img_metadata = []
         for current_meta in self.coco.loadImagesFromDatapoint(datapoint_id):
