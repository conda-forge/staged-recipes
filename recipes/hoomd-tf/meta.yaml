{% set version = "2.0.1" %}

  package:
    name: hoomd-tf
    version: {{ version }}
  
  source:
    url: https://github.com/ur-whitelab/hoomd-tf/archive/v2.0.1.tar.gz
    sha256: 922187b58779eeaf82a460bf7e702e802dbbb84d59bd0068ebe02a5661189e97
  
  build:
    skip: true  # [win or py<36]
    number: 0

  requirements:
    build:
      - {{ compiler('c') }}
      - {{ compiler('cxx') }}
      - cmake
      - make
      - python >=3.6
      - pip
      - hoomd >=2.6
      - tbb-devel >=2020.1  # [linux]
      - tbb-devel =2019.9   # [osx]
      - absl-py >=0.9.0
      - astunparse >=1.6.3
      - gast >=0.3.3
      - grpcio >=1.16
      - h5py >=2.10.0
      - keras-preprocessing >=1.1.0
      - numpy
      - opt_einsum >=2.3.2
      - protobuf >=3.8.0
      - setuptools
      - scipy
      - six >=1.12
      - termcolor >=1.1.0
      - wrapt >=1.11.2

    host:
      - python >=3.6
      - pip
      - setuptools

    run:
      - python >=3.6
      - hoomd >=2.6
      - tbb-devel >=2020.1  # [linux]
      - tbb-devel =2019.9   # [osx]

  test:
    imports:
      - hoomd
      - hoomd.htf
      - tensorflow
      - unittest
      - shutil
      - numpy

    requires:
      - pytest
      - pytest-cov
      - pytest-xdist
    
    source_files:
      - htf/test-py

    commands:
      # Run all tests in htf/test-py
      - python htf/test-py/test_sanity.py
      - python htf/test-py/test_tensorflow.py
      - python htf/test-py/test_mpi_tensorflow.py
      - python htf/test-py/test_utils.py
  
  about:
    home: https://hoomd-tf.readthedocs.io/
    license: MIT
    license_family: MIT
    license_file: LICENSE
    summary: 'A plugin that allows the use of Tensorflow in Hoomd-Blue for GPU-accelerated ML+MD'
    doc_url: https://hoomd-tf.readthedocs.io/

  extra:
    recipe-maintainers:
      - hgandhi2411
      - whitead
