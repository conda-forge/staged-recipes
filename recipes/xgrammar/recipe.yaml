context:
  name: xgrammar
  version: 0.1.8

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/mlc-ai/xgrammar/archive/v${{ version }}.tar.gz
  sha256: 0983b26dca7132dba46619e3ad2a0f13da060a9cf4576274fc587f099150ca95

build:
  script: ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  number: 0

requirements:
  build:
    - if: build_platform != target_platform
      then:
        - python
        - cross-python_${{ target_platform }}
        - setuptools
        - cmake >=3.18
        - ninja
        - pybind11
        - pytorch
        - ${{ compiler('cxx') }}
        - ${{ stdlib('c') }}
  host:
    - python
    - pip
    - setuptools
    - cmake >=3.18
    - ninja
    - pybind11
    - pytorch
  run:
    - python
    - pybind11
    - pydantic
    - pytest
    - sentencepiece
    - tiktoken
    - pytorch
    - transformers
    # Seems to be required, but not an official requirement
    - triton

tests:
  - python:
      imports:
        - xgrammar
      pip_check: true

about:
  homepage: https://github.com/mlc-ai/xgrammar
  repository: https://github.com/mlc-ai/xgrammar
  summary: Decompile python functions, from bytecode to source code!
  license: MIT
  license_file: LICENSE

extra:
  recipe-maintainers:
    - maresb
