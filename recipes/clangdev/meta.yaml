{% set clang_variant = os.environ.get('CLANG_VARIANT', 'flang') %}
{% set flang_commit = "8b5f9f87cfc15911c27e0e55cea526b2a4512088" %}
{% set version = "4.0.0" %}
{% set sha256 = "ca0e1680d0ff0d077a68cea4d8859361906736b2b873ba987b9880e70a876f42" %}
{% set build_number = "0" %}

package:
  name: flang
  version: {{ version }}.git.{{ flang_commit[:7] }}

source:
  url: https://github.com/isuruf/flang/archive/{{ flang_commit }}.tar.gz
  sha256: {{ sha256 }}

build:
  number: {{ build_number }}
  skip: true  # [py<36]
  skip: true  # [not win64]

  features:   # [win and py36]
    - vc14    # [win and py36]

requirements:
  build:
    - toolchain
    - cmake >=3.4.3
    - llvmdev =={{ version }}
    - libxml2 2.9.*
    - clangdev =={{ version }}
    - openmp =={{ version }}
  run:
    - llvmdev =={{ version }}
    - clangdev =={{ version }}
    - openmp =={{ version }}
    - libxml2 2.9.*
    - vs2015_runtime  # [win]

test:
  requires:
    - python {{ environ['PY_VER'] + '*' }}  # [win]
    - cmake >=3.4.3
  files:
    - mytest.c
  commands:
    - flang --version

about:
  home: http://github.com/flang-compiler/flang
  license: Apache 2.0
  license_file: LICENSE.TXT
  summary: Flang is a Fortran compiler targeting LLVM.

extra:
  recipe-maintainers:
    - isuruf
    - xoviat
