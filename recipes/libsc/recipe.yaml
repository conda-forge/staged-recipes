context:
  version: "2.8.7"

package:
  name: libsc
  version: ${{ version }}

source:
  url: https://github.com/cburstedde/libsc/releases/download/v${{ version }}/libsc-${{ version }}.tar.gz
  sha256: 96028B7E16917E90DD319E9F7BBB231280FF3E74ECFE2A5480B5FF94AE1428CD
  patches:
    - shared_library.patch
    - jansson_discovery.patch # because cf does not package a jansson cmake config file

build:
  number: 0
  script:
    - if: unix
      then:
        - cmake -B build -DCMAKE_INSTALL_PREFIX=$PREFIX -DSC_BUILD_SHARED_LIBS=ON -DSC_ENABLE_MPI=ON -DSC_HAVE_JSON=ON -DSC_USE_INTERNAL_JSON=OFF
        - cmake --build build --parallel
        - cmake --install build
    - if: win
      then:
        - cmake -B build -DCMAKE_INSTALL_PREFIX=%PREFIX% -DSC_BUILD_SHARED_LIBS=ON -DSC_ENABLE_MPI=OFF -DSC_HAVE_JSON=ON -DSC_USE_INTERNAL_JSON=OFF
        - cmake --build build --parallel
        - cmake --install build

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - cmake
    - make
    - pkg-config

  host:
    - if: unix
      then:
        - openmpi-mpicc
    - zlib
    - jansson

tests:
  - package_contents:
      lib:
        - libsc

about:
  homepage: https://www.p4est.org/
  summary: 'The "sc" auxiliary library'
  description: |
    The SC Library provides support for parallel scientific applications.
    It consists of basic helper functionality such as logging, array and hash data structures, parallel statistics, and more.
    libsc also integrates the third-party libraries zlib and lua.
  license: LGPL-2.1-only
  license_family: LGPL
  license_file: COPYING
  repository: https://github.com/cburstedde/libsc

extra:
  recipe-maintainers:
    - claudiushaag
