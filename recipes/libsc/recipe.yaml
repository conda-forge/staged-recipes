context:
  version: "2.8.7"

package:
  name: libsc
  version: ${{ version }}

source:
  url: https://github.com/cburstedde/libsc/releases/download/v${{ version }}/libsc-${{ version }}.tar.gz
  sha256: 96028B7E16917E90DD319E9F7BBB231280FF3E74ECFE2A5480B5FF94AE1428CD

build:
  number: 0
  skip:
    - win
  script:
    - if: unix
      then:
        - cmake -B build $CMAKE_ARGS -DBUILD_SHARED_LIBS=ON -DSC_ENABLE_MPI=ON -DSC_HAVE_JSON=OFF -DSC_USE_INTERNAL_JSON=OFF -DSC_BUILD_TESTING=ON
        - cmake --build build --parallel
        - cmake --install build
        - cd build; ctest --output-on-failure

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - cmake
    - make
    - pkg-config

  host:
    - openmpi-mpicc
    - zlib
    
  run_exports:
    - ${{ pin_subpackage('libsc', upper_bound='x.x.x') }}

tests:
  - package_contents:
      lib:
        - libsc

about:
  homepage: https://www.p4est.org/
  summary: 'The "sc" auxiliary library'
  description: |
    The SC Library provides support for parallel scientific applications.
    It consists of basic helper functionality such as logging, array and hash data structures, parallel statistics, and more.
    libsc also integrates the third-party libraries zlib and lua.
  license: LGPL-2.1-only
  license_family: LGPL
  license_file: COPYING
  repository: https://github.com/cburstedde/libsc

extra:
  recipe-maintainers:
    - claudiushaag
