schema_version: 1

context:
  version: "1.2.1"

package:
  name: speexdsp
  version: ${{ version }}

source:
  url: https://github.com/xiph/speexdsp/archive/refs/tags/SpeexDSP-${{ version }}.tar.gz
  sha256: d17ca363654556a4ff1d02cc13d9eb1fc5a8642c90b40bd54ce266c3807b91a7

build:
  number: 0
  script: build.nu

requirements:
  build:
    - ${{ compiler('c') }}
    - if: osx and arm64
      then: autotools_clang_conda
    - if: unix
      then:
        - make
        - automake
        - autoconf
        - libtool
        - pkg-config
    - if: win
      then:
        - m2-autotools
        - m2-libtool
        - posix
    - nushell
  host:
    - if: linux
      then: libgomp
  run:
    - if: linux
      then: libgomp

tests:
  - script:
      - if: unix
        then:
          - test -f $PREFIX/lib/libspeexdsp${SHLIB_EXT}
          - test -f $PREFIX/include/speex/speex_preprocess.h
          - test -f $PREFIX/lib/pkgconfig/speexdsp.pc
      - if: win
        then:
          - if not exist %LIBRARY_LIB%\\speexdsp.lib exit 1
          - if not exist %LIBRARY_INC%\\speex\\speex_preprocess.h exit 1

about:
  homepage: https://speex.org/
  summary: SpeexDSP is a patent-free, Open Source/Free Software DSP library derived from Speex
  description: |
    SpeexDSP is a patent-free, Open Source/Free Software DSP library derived from Speex.

    It is designed to be a simple, small-footprint audio processing library that is
    especially suitable for embedded applications. The library provides:

    - Echo cancellation
    - Noise reduction
    - Automatic gain control
    - Voice activity detection
    - Resampling

    SpeexDSP was split off from the main Speex project to allow more modular use
    of the DSP functionality without requiring the codec components.
  license: BSD-3-Clause
  license_file: COPYING
  documentation: https://speex.org/docs/
  repository: https://github.com/xiph/speexdsp

extra:
  recipe-maintainers:
    - phreed
  feedstock-name: speexdsp
