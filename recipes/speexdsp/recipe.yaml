schema_version: 1

context:
  version: "1.2.1"

package:
  name: speexdsp
  version: ${{ version }}

source:
  url: https://github.com/xiph/speexdsp/archive/refs/tags/SpeexDSP-${{ version }}.tar.gz
  sha256: d17ca363654556a4ff1d02cc13d9eb1fc5a8642c90b40bd54ce266c3807b91a7

build:
  number: 0
  script:
    - if: win
      then: |
        cp %RECIPE_DIR%\CMakeLists.txt .\CMakeLists.txt
        xcopy %RECIPE_DIR%\cmake .\cmake /S /E
        cmake -GNinja %CMAKE_ARGS% %SRC_DIR%
      else: |
        cp $RECIPE_DIR/CMakeLists.txt ./CMakeLists.txt
        cp -r $RECIPE_DIR/cmake ./cmake
        cmake -GNinja $CMAKE_ARGS $SRC_DIR
    - cmake --build . --config Release
    - cmake --install . --config Releasebuild.nu

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - cmake
    - ninja
    - if: win
      then:
        - vs2022_win-64
  host:
    - if: linux
      then:
        - libgomp >=4.0
  run:
    - if: linux
      then:
        - libgomp >=4.0

tests:
  - package_contents:
      lib:
        - speexdsp
      include:
        - speex/speex_preprocess.h
      files:
        exists:
          - ${{ "Library/" if win }}lib/pkgconfig/speexdsp.pc
          - ${{ "Library/" if win }}lib/cmake/SpeexDSP/SpeexDSPConfig.cmake
          - ${{ "Library/" if win }}lib/cmake/SpeexDSP/SpeexDSPConfigVersion.cmake
          - ${{ "Library/" if win }}lib/cmake/SpeexDSP/SpeexDSPTargets.cmake
          - ${{ "Library/" if win }}lib/pkgconfig/speexdsp.pc

about:
  homepage: https://speex.org/
  summary: SpeexDSP is a patent-free, Open Source/Free Software DSP library derived from Speex
  description: |
    SpeexDSP is a patent-free, Open Source/Free Software DSP library derived from Speex.

    It is designed to be a simple, small-footprint audio processing library that is
    especially suitable for embedded applications. The library provides:

    - Echo cancellation
    - Noise reduction
    - Automatic gain control
    - Voice activity detection
    - Resampling

    SpeexDSP was split off from the main Speex project to allow more modular use
    of the DSP functionality without requiring the codec components.

    This package uses modern build tools:
    - Unix/Linux: autotools (configure, make)
    - Windows: CMake with MSVC (Visual Studio Build Tools)
    - macOS: autotools with clang
  license: BSD-3-Clause
  license_file: COPYING
  documentation: https://speex.org/docs/
  repository: https://github.com/xiph/speexdsp

extra:
  recipe-maintainers:
    - phreed
  feedstock-name: speexdsp
