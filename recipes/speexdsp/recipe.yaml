schema_version: 1

context:
  version: "1.2.1"

package:
  name: speexdsp
  version: ${{ version }}

source:
  url: https://github.com/xiph/speexdsp/archive/refs/tags/SpeexDSP-${{ version }}.tar.gz
  sha256: d17ca363654556a4ff1d02cc13d9eb1fc5a8642c90b40bd54ce266c3807b91a7

build:
  number: 0
  script: build.nu

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - cmake >=3.15
    - ninja
    - nushell >=0.80
    - if: win
      then:
        - vs2022_win-64
  host:
    - if: linux
      then:
        - libgomp >=4.0
  run:
    - if: linux
      then:
        - libgomp >=4.0

tests:
  - if: linux
    then:
      package_contents:
        files:
          - lib/libspeexdsp.so*
          - include/speex/speex_preprocess.h
          - lib/pkgconfig/speexdsp.pc
  - if: osx
    then:
      package_contents:
        files:
          - lib/libspeexdsp.dylib
          - include/speex/speex_preprocess.h
          - lib/pkgconfig/speexdsp.pc
  - if: win
    then:
      package_contents:
        files:
          - Library/lib/speexdsp.lib
          - Library/include/speex/speex_preprocess.h

about:
  homepage: https://speex.org/
  summary: SpeexDSP is a patent-free, Open Source/Free Software DSP library derived from Speex
  description: |
    SpeexDSP is a patent-free, Open Source/Free Software DSP library derived from Speex.

    It is designed to be a simple, small-footprint audio processing library that is
    especially suitable for embedded applications. The library provides:

    - Echo cancellation
    - Noise reduction
    - Automatic gain control
    - Voice activity detection
    - Resampling

    SpeexDSP was split off from the main Speex project to allow more modular use
    of the DSP functionality without requiring the codec components.

    This package uses modern build tools:
    - Unix/Linux: autotools (configure, make)
    - Windows: CMake with MSVC (Visual Studio Build Tools)
    - macOS: autotools with clang
  license: BSD-3-Clause
  license_file: COPYING
  documentation: https://speex.org/docs/
  repository: https://github.com/xiph/speexdsp

extra:
  recipe-maintainers:
    - phreed
  feedstock-name: speexdsp
