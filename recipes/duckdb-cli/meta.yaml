{% set name = "duckdb-cli" %}
{% set version = "0.9.1" %}
{% set extensions = "httpfs;json;parquet" %}

package:
  name: {{ name | lower }}
  version: {{ version }}

source: 
  url: https://github.com/duckdb/duckdb/archive/v{{ version }}.tar.gz
  sha256: 37a43188d9354ce3ca101b2b118d867f5f76d04c3b83c09d86fd7508351a631b

build:
  number: 0
  skip: true  # [not linux]
  script:
    - |
      # echo "duckdb_extension_load(httpfs)" > extension/extension_config_local.cmake
      EXTENSION_STATIC_BUILD=1 make extension_configuration
      DUCKDB_EXTENSIONS='{{ extensions }}' VCPKG_TOOLCHAIN_PATH="$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake" make
      cp build/release/duckdb $PREFIX/bin
      cp -R build/release/extension $PREFIX/
  missing_dso_whitelist:
    - '*/libpthread.so.0'
    - '*/libdl.so.2'
    - '*/libm.so.6'
    - '*/libc.so.6'
    - '*/librt.so.1'
    - '*/ld-linux-x86-64.so.2'
    - '*/libgcc_s.so.1'
    - '*/libssl.so.3'
    - '*/libcrypto.so.3'
    - '*/libssl.3.dylib'
    - '*/libcrypto.3.dylib'
    - '*/libc++.1.dylib'
    - '*/libstdc++.so.6'

requirements:
  host:
    - cmake
    - make
    - vcpkg
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
  run:
    - cmake
    - make
    - vcpkg
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - openssl

test:
  commands:
    - which duckdb
    - duckdb -version

outputs:

  - name: {{ name | lower }}
    version: {{ version }}
    files:
      - bin/duckdb
    requirements:
      run:
        - openssl

    test:
      commands:
        - which duckdb
        - duckdb -version

  - name: duckdb-httpfs
    version: {{ version }}
    files:
      - extension/httpfs/httpfs.duckdb_extension
    test:
      commands:
        - test -f $PREFIX/extension/httpfs/httpfs.duckdb_extension

    about:
      summary: HTTPFS extension for DuckDB.  Extension is unsigned and must be loaded with `allow_unsigned_extensions`.

  - name: duckdb-json
    version: {{ version }}
    files:
      - extension/json/json.duckdb_extension
    test:
      commands:
        - test -f $PREFIX/extension/json/json.duckdb_extension
    about:
      summary: JSON extension for DuckDB.  Extension is unsigned and must be loaded with `allow_unsigned_extensions`.

  - name: duckdb-parquet
    version: {{ version }}
    files:
      - extension/parquet/parquet.duckdb_extension
    test:
      commands:
        - test -f $PREFIX/extension/parquet/parquet.duckdb_extension
    about:
      summary: Parquet extension for DuckDB.  Extension is unsigned and must be loaded with `allow_unsigned_extensions`.

about:
  home: https://github.com/duckdb/duckdb/
  summary: |
    DuckDB is a high-performance analytical database system. It is designed to be fast, reliable, portable, and easy to use. DuckDB provides a rich SQL dialect, with support far beyond basic SQL. DuckDB supports arbitrary and nested correlated subqueries, window functions, collations, complex types (arrays, structs), and more. For more information on using DuckDB, please refer to the DuckDB documentation.
  doc_url: https://duckdb.org/
  license: MIT
  license_file: LICENSE

extra:
  recipe-maintainers:
    - mediocretech
