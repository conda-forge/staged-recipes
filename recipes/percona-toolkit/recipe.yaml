context:
  name: percona-toolkit
  version: "3.7.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://downloads.percona.com/downloads/percona-toolkit/${{ version }}/source/tarball/percona-toolkit-${{ version }}.tar.gz
  sha256: cda1058177ad5de4e2c9e8848f3745a911675589599814547f43c4f58a42c464
  patches:
    - 0001-Add-missing-tomb.v2-dependency-for-mgo.v2-dbtest.patch

build:
  number: 0
  skip:
    - win
  script:
    - perl Makefile.PL INSTALL_BASE=$PREFIX
    - make
    - make test
    - make install

requirements:
  build:
    - perl
    - make
    - ${{ compiler('go') }}
  run:
    - perl
    - perl-dbi >=1.46

tests:
  - script:
      - set -x
      # Test help commands
      - pt-align --help
      - pt-archiver --help
      - pt-config-diff --help
      - pt-deadlock-logger --help
      - pt-diskstats --help
      - pt-duplicate-key-checker --help
      - pt-fifo-split --help
      - pt-find --help
      - pt-fingerprint --help
      - pt-fk-error-logger --help
      - pt-heartbeat --help
      - pt-index-usage --help
      - pt-ioprofile --help
      - pt-kill --help
      - pt-mext --help
      - pt-mysql-summary --help
      - pt-online-schema-change --help
      - pt-pmp --help
      - pt-query-digest --help
      - pt-replica-find --help
      - pt-replica-restart --help
      - pt-show-grants --help
      - pt-sift --help
      - pt-slave-delay --help
      - pt-slave-find --help
      - pt-slave-restart --help
      - pt-stalk --help
      - pt-table-checksum --help
      - pt-table-sync --help
      - pt-table-usage --help
      - pt-upgrade --help
      - pt-variable-advisor --help
      - pt-visual-explain --help
      # Test version commands for key tools
      - pt-heartbeat --version
      - pt-query-digest --version
      - pt-online-schema-change --version

about:
  homepage: https://www.percona.com/software/database-tools/percona-toolkit
  license: GPL-2.0-only
  license_file: COPYING
  summary: Advanced command-line tools for MySQL/MariaDB performance and administration
  description: |
    Percona Toolkit is a collection of advanced open-source command-line
    tools used by database administrators and developers to perform a variety
    of MySQL, MariaDB, MongoDB, and PostgreSQL server and system tasks that
    are too difficult or complex to perform manually.

    The toolkit includes over 30 tools for tasks such as:
    - Online schema changes (pt-online-schema-change)
    - Query analysis and optimization (pt-query-digest)
    - Replication monitoring and management
    - Table synchronization and checksumming
    - Performance monitoring and profiling
  documentation: https://docs.percona.com/percona-toolkit/
  repository: https://github.com/percona/percona-toolkit

extra:
  recipe-maintainers:
    - chrisburr
