{% set version = "1.8" %}

package:
  name: libxar
  version: {{ version }}

source:
  # need to check sources for actual version number
  # https://github.com/apple-oss-distributions/xar/blob/main/xar/configure.ac#L10-L11
  # cannot use newest 482 due to missing os/availability.h on older MacOS SDKs
  url: https://github.com/apple-oss-distributions/xar/archive/refs/tags/xar-452.tar.gz
  sha256: ed6f0df9c296f05f97f8c3eaaaa17c7a189f53ff480de9d2bbea82ca46aabae5

build:
  number: 0
  script:
    - cd xar
    - ./configure
    - make
    - make install
  skip: true  # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - make
  host:
    - openssl  # [linux]
  run:
    - openssl  # [linux]
test:
  commands:
    # shared
    - test -f $PREFIX/lib/libxar.so              # [linux]
    - test -f $PREFIX/lib/libxar.dylib           # [osx]

    # absence of static libraries
    - test ! -f $PREFIX/lib/libxar.a

    # header
    - test -f $PREFIX/include/xar.h              # [unix]

about:
  home: https://github.com/apple-oss-distributions/xar
  license: BSD-3-Clause
  license_file: LICENSE
  summary: eXtensible ARchiver
  # original project is https://code.google.com/archive/p/xar/, but patched by apple
  dev_url: https://github.com/apple-oss-distributions/xar

extra:
  recipe-maintainers:
    - h-vetinari
    - isuruf
