{% set name = "pygenn-cpu" %}
{% set version = "5.3.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/genn-team/genn/archive/refs/tags/5.3.0_RC1.tar.gz
  sha256: f1a6807d15f99d91732cd2484727100e54c39b055bcbe2126e7792d07c776fe3

build:
  number: 0
  skip: true  # [osx]
  script: |
    {% if win %}
    :: Disable CUDA
    set CUDA_PATH=
    "%PYTHON%" setup.py install --single-version-externally-managed --record=record.txt
    {% else %}
    unset CUDA_PATH
    $PYTHON setup.py install --single-version-externally-managed --record=record.txt
    {% endif %}
  missing_dso_whitelist:
    - $RPATH/genn_Release_DLL.dll   # Bundled with PyGeNN itself; shipped as package_data
    - $RPATH/libffi_Release_DLL.dll # same not from system/conda, but built + packaged internally

requirements:
  build:
    - {{ stdlib("c") }}  # [linux] 
    - {{ compiler('cxx') }}
    - make  # [not win]
    - python
    - setuptools
    - pybind11
    - psutil

  host:
    - python
    - numpy
    - setuptools 
    - psutil
    - pybind11
    - libffi 

  run:
    - python
    - numpy
    - make  # [not win]
    - cxx-compiler # Required at runtime: PyGeNN JIT-compiles models via `make` + `g++`, so users need a C++ compiler in their environment.
    - psutil
    - libffi 
    - importlib-metadata  # [py<38]

test:
  imports:
    - pygenn
  files:
    - tests/run_pygenn_cpu_smoketest.py
  commands:
    - python tests/run_pygenn_cpu_smoketest.py

about:
  home: https://github.com/genn-team/genn
  license: LGPL-2.1-or-later
  license_family: LGPL
  license_file: LICENSE
  summary: "CPU-only PyGeNN"
  description: |
    GeNN with single-threaded CPU backend only. No CUDA required.
  dev_url: https://github.com/genn-team/genn

extra:
  recipe-maintainers:
    - Agrim-P777
    - tnowotny
    - neworderofjamie
