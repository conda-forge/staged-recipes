{% set name = "grass" %}
{% set version = "8.4.1" %}
{% set sha256 = "611e82dd919cd0e5c1a511e7efbc5c769e22ac6c613c3c4a2633c5d4b07c7e31" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://github.com/OSGeo/grass/archive/refs/tags/{{ version }}.tar.gz
  sha256: {{ sha256 }}

build:
  number: 0
  skip: true  # [win or osx or py<310]
  # Ignore run_exports to prevent automatic over-constraining that creates dependency conflicts.
  # Without this, conda-build adds ultra-strict pins (e.g., gdal >=3.11.0,<3.12.0a0) from each
  # dependency's run_exports, making GRASS incompatible with other geospatial tools (QGIS, etc.)
  # that need different versions. These libraries ARE used by GRASS, but we manually specify
  # flexible constraints in run: section instead. Applies only to packages with stable ABIs,
  # build-time-only dependencies (python, numpy), or header-only packages (xorg-xextproto).
  # NOT ignored: geos, proj (more volatile ABIs, strict pins via conda_build_config.yaml)
  ignore_run_exports:
    - gdal
    - libtiff
    - expat
    - numpy
    - zlib
    - pixman
    - ncurses
    - python
    - sqlite
    - xorg-xextproto
    - libmagic
    - jsoncpp
    - pdal
    - libjpeg-turbo
    - freetype
    - libexpat
  # GRASS uses Autotools configure/make; build.sh handles the steps

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ stdlib("c") }}
    - make
    - pkg-config
    - bison
    - flex
    - gettext
    - llvm-openmp  # [osx]
  host:
    - python
    - pip
    - gdal
    - geos
    - proj
    - proj-data
    - sqlite
    - readline
    - ncurses
    - cairo
    - freetype
    - fontconfig
    - expat
    - pixman
    - xorg-libx11  # [linux]
    - xorg-xproto  # [linux]
    - xorg-kbproto  # [linux]
    - xorg-xextproto  # [linux]
    - xorg-renderproto  # [linux]
    - libpng
    - libjpeg-turbo
    - libtiff
    - zlib
    - zstd
    - bzip2
    - libpq
    - jsoncpp
    - libmagic
    - fftw
    - libblas
    - libcblas
    - liblapack
    - libnetcdf
    - pdal
    - libiconv
    - setuptools
    # - llvm-openmp  # [osx]
  run:
    - python
    - libiconv
    - gdal
    - libgdal-core
    - geos
    - proj
    - proj-data
    - sqlite
    - readline
    - ncurses
    - cairo
    - freetype
    - fontconfig
    - expat
    - libpng
    - libjpeg-turbo
    - libtiff
    - zlib
    - zstd
    - bzip2
    - libpq
    - jsoncpp
    - libmagic
    - fftw
    - libblas
    - libcblas
    - liblapack
    - libnetcdf
    - pdal
    - libpdal-core
    - _openmp_mutex  # [linux]
    - llvm-openmp  # [osx]
    - numpy
    - pillow
    - matplotlib-base
    - python-dateutil
    - ply
    - psycopg2
    - python-magic

test:
  commands:
    - grass --version
    - grass --tmp-project EPSG:4326 --exec g.version -rge

about:
  home: https://grass.osgeo.org/
  license: GPL-2.0-or-later
  license_file: COPYING
  summary: GRASS computational engine for raster, vector, and geospatial processing. 
  description: |
    GRASS is a geospatial engine that enables spatial data analysis,
    visualization, and modeling. It provides researchers and practitioners
    with science-backed tools to understand and manage landscapes,
    natural resources, and human environments.
  dev_url: https://github.com/OSGeo/grass
  doc_url: https://grass.osgeo.org/grass-stable/manuals/

extra:
  recipe-maintainers:
    - HuidaeCho
    - wenzeslaus
    - dudaka
