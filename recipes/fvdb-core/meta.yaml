{% set name = "fvdb-core" %}
{% set version = "0.3.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/fvdb_core-{{ version }}.tar.gz
  sha256: f6ec0d5e6a2b601632720ed0be8aa7c8ba6f2d9bd63fac477cef2cfd088b5f16

build:
  skip: true  # [py<310 or cuda_compiler_version == "11.8" or win or macos]
  script: ./build.sh install verbose --cuda-arch-list="7.5;8.0;9.0;10.0;12.0+PTX"
  number: 0

requirements:
  build:
    - python                                 # [build_platform != target_platform]
    - cross-python_{{ target_platform }}     # [build_platform != target_platform]
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('cuda') }}
    - cuda-version {{ cuda_compiler_version }}
    - cuda-command-line-tools
    - cmake >=3.25
    - ninja
    - make
    - pkg-config
    - git
    - procps-ng  # provides 'free'
    - coreutils  # provides 'nproc', 'awk', etc.
  host:
    - python
    - scikit-build-core
    - pip
    - pytorch-gpu {{ pytorch_gpu }}
    - numpy
    - tqdm
    - pybind11 2.13.6
    - psutil
    - gitpython
    - cuda-version {{ cuda_compiler_version }}
    - cuda-nvrtc-dev
    - cuda-nvtx-dev
    - libcublas-dev
    - libcusolver-dev
    - libcusparse-dev
    - cudnn >=9.10.0
    - libpng
    - zlib
  run:
    - python
    - pytorch-gpu {{ pytorch_gpu }}
    - {{ pin_compatible('numpy') }}
    - cuda-version {{ cuda_compiler_version }}
    # Runtime libraries corresponding to dev packages above
    - libcublas
    - libcusolver
    - libcusparse
    - libpng
    - zlib

test:
  imports:
    - fvdb
  commands:
    - pip check
  requires:
    - pip

about:
  license: Apache-2.0
  license_file: LICENSE
  summary: "A deep learning framework for sparse, large-scale, high-performance spatial intelligence"

extra:
  recipe-maintainers:
    - swahtz
