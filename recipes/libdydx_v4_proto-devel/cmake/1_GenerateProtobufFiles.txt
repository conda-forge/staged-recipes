set(GENERATED_PROTO_DIR "${CMAKE_CURRENT_BINARY_DIR}/_generated")
file(MAKE_DIRECTORY ${GENERATED_PROTO_DIR})

# set(PLUGIN_OUT_DIR "${GENERATED_PROTO_DIR}")
# file(MAKE_DIRECTORY ${PLUGIN_OUT_DIR})
# set(PROTOC_OPTIONS "--add_export_out=${PLUGIN_OUT_DIR}")

protobuf_generate(
    PROTOC_OUT_DIR ${GENERATED_PROTO_DIR}
    OUT_VAR PROTO_GENERATED_FILES
    EXPORT_MACRO DYDX_V4_PROTO_API
    LANGUAGE cpp
    # PLUGIN "protoc-gen-add_export=${PROTOC_GEN_ADD_EXPORT_PATH}"
    # PROTOC_OPTIONS ${PROTOC_OPTIONS}
    PROTOS ${proto_files})

add_custom_target(generate_proto_files DEPENDS ${PROTO_GENERATED_FILES})
# add_dependencies(generate_proto_files protoc-gen-add_export)

list(GET PROTO_GENERATED_FILES 0 2 FIRST_THREE)
string(JOIN ", " FIRST_THREE_STR ${FIRST_THREE})
message(STATUS "Generated protobuf files: ${FIRST_THREE_STR}")
