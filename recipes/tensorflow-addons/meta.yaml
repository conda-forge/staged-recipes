{% set version = "0.14.0" %}
{% set tf_version_maj_min = "2.6" %}

package:
  name: tensorflow-addons
  version: {{ version }}

source:
  url: https://github.com/tensorflow/addons/archive/refs/tags/v{{ version }}.tar.gz
  sha256: da9eaf683192054db73941e0de34d83754be4054dc92c409bc4693c3f3091586

build:
  number: 0
  # missing dependency: https://github.com/conda-forge/tensorflow-feedstock/issues/124
  skip: true  # [win]

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('cuda') }}  # [cuda_compiler_version != "None"]
    - bazel
    - bazel-toolchain
    - rsync
    - sed
  host:
    # GPU requirements for CUDA
    - cudnn           # [cuda_compiler_version != "None"]
    - python
    - pip
    - libprotobuf
    # check tensorflow-range per addons-version, see
    # https://github.com/tensorflow/addons#python-op-compatibility-matrix
    - tensorflow {{ tf_version_maj_min }}.*
    # needed for headers in tensorflow/core/framework
    - libtensorflow_cc {{ tf_version_maj_min }}.*
    - tensorflow-cpu  # [cuda_compiler_version == "None"]
    - tensorflow-gpu  # [cuda_compiler_version != "None"]
    - typeguard >=2.7
  run:
    - python
    # due to lack of ABI, we need the same version at runtime, see
    # https://github.com/tensorflow/addons#c-custom-op-compatibility-matrix
    - tensorflow {{ tf_version_maj_min }}.*
    - libtensorflow_cc {{ tf_version_maj_min }}.*
    - tensorflow-cpu  # [cuda_compiler_version == "None"]
    - tensorflow-gpu  # [cuda_compiler_version != "None"]
    - typeguard >=2.7
test:
  requires:
    - pytest
  source_files:
    - tensorflow_addons/activations/tests/
    - tensorflow_addons/callbacks/tests/
    - tensorflow_addons/image/tests/
    - tensorflow_addons/layers/tests/
    - tensorflow_addons/losses/tests/
    - tensorflow_addons/metrics/tests/
    - tensorflow_addons/optimizers/tests/
    - tensorflow_addons/rnn/tests/
    - tensorflow_addons/seq2seq/tests/
    - tensorflow_addons/text/tests/
    - tensorflow_addons/utils/tests/
    - tensorflow_addons/tests/
    - tensorflow_addons/conftest.py
  imports:
    - tensorflow_addons
  commands:
    - pytest -v tensorflow_addons/activations

about:
  home: https://github.com/tensorflow/addons
  license: Apache-2.0
  license_file: LICENSE
  summary: Useful extra functionality for TensorFlow 2.x maintained by SIG-addons
  dev_url: https://github.com/tensorflow/addons

extra:
  recipe-maintainers:
    - conda-forge/tensorflow
