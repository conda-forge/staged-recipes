From 8ee0dcf68868b737a3788bcdc25707eac1e3ac36 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Fri, 12 Nov 2021 13:44:53 +1100
Subject: [PATCH 1/3] import sklearn before tensorflow due to libgomp TLS issue

---
 tensorflow_addons/conftest.py                                   | 2 ++
 .../metrics/tests/matthews_correlation_coefficient_test.py      | 2 +-
 tensorflow_addons/metrics/tests/r_square_test.py                | 2 +-
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/tensorflow_addons/conftest.py b/tensorflow_addons/conftest.py
index 3290baf..02530b1 100644
--- a/tensorflow_addons/conftest.py
+++ b/tensorflow_addons/conftest.py
@@ -1,5 +1,7 @@
 import numpy as np
 import pytest
+# import sklearn before tensorflow!
+import sklearn
 import tensorflow as tf
 
 import tensorflow_addons as tfa
diff --git a/tensorflow_addons/metrics/tests/matthews_correlation_coefficient_test.py b/tensorflow_addons/metrics/tests/matthews_correlation_coefficient_test.py
index 5002a4a..1060594 100644
--- a/tensorflow_addons/metrics/tests/matthews_correlation_coefficient_test.py
+++ b/tensorflow_addons/metrics/tests/matthews_correlation_coefficient_test.py
@@ -14,11 +14,11 @@
 # ==============================================================================
 """Matthews Correlation Coefficient Test."""
 
+from sklearn.metrics import matthews_corrcoef as sklearn_matthew
 import tensorflow as tf
 
 import numpy as np
 from tensorflow_addons.metrics import MatthewsCorrelationCoefficient
-from sklearn.metrics import matthews_corrcoef as sklearn_matthew
 
 
 def test_config():
diff --git a/tensorflow_addons/metrics/tests/r_square_test.py b/tensorflow_addons/metrics/tests/r_square_test.py
index e925cb5..0a4ef52 100644
--- a/tensorflow_addons/metrics/tests/r_square_test.py
+++ b/tensorflow_addons/metrics/tests/r_square_test.py
@@ -16,8 +16,8 @@
 
 import numpy as np
 import pytest
-import tensorflow as tf
 from sklearn.metrics import r2_score as sklearn_r2_score
+import tensorflow as tf
 
 from tensorflow_addons.metrics import RSquare
 from tensorflow_addons.metrics.r_square import _VALID_MULTIOUTPUT
-- 
2.32.0.windows.2

