# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: "0.4.0"
  python_check_max: "3.14"
  # TODO: check for working versions of `chalice-feedstock`, `quart-feedstock`
  pytest_k: not (chalice or quart)

recipe:
  name: cross-web-split
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/c/cross-web/cross_web-${{ version }}.tar.gz
  sha256: 4ae65619ddfcd06d6803432c0366342d7e8aeba10194b4e144d73a662e75370c

build:
  number: 0
  noarch: python

outputs:
  - package:
      name: cross-web
    build:
      script:
      - ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation --disable-pip-version-check
    requirements:
      host:
        - python ${{ python_min }}.*
        - hatchling
        - pip
      run:
        - python >=${{ python_min }}
        - typing_extensions >=4.14.0
      run_constraints:
        # [integrations]
        - aiohttp >=3.9
        - django >=4.2
        - chalice >=1.29
        - fastapi >=0.115.12
        - flask >=2.3
        - httpx >=0.28.1
        - litestar >=2.0
        - python-multipart >=0.0.20
        - quart >=0.19
        - sanic >=23.0
        - sanic-testing >=23.0
        - starlette >=0.46.1
        - werkzeug >=2.3
        - yarl >=1.9
    tests:
      - python:
          imports: cross_web
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*

  - package:
      name: cross-web-with-integrations
    build:
      noarch: generic
    requirements:
      run:
        - ${{ pin_subpackage("cross-web", exact=True) }}
        - aiohttp
        # - chalice
        - django
        - fastapi
        - flask
        - httpx
        - litestar
        - python-multipart
        - quart
        - sanic
        - sanic-testing
        - starlette
        - werkzeug
        - yarl
    tests:
      - python:
          imports: cross_web
          pip_check: true
          python_version:
            - ${{ python_min }}.*
            - ${{ python_check_max }}.*
      - files:
          source:
            - pyproject.toml
            - tests/
        requirements:
          run:
            - pytest >=7.4.4
            - pytest-asyncio >=0.23.8
            - pytest-cov >=6.0.0
            - python ${{ python_min }}.*
        script:
          - echo "#" > .coveragerc
          - coverage run --source=cross_web --branch -m pytest -vv --tb=long --color=yes -k "${{ pytest_k }}"
          - coverage report --show-missing --skip-covered --fail-under=89
    about:
      summary: A library for working with web frameworks (with [integrations])

about:
  summary: A library for working with web frameworks
  license: MIT
  license_file: LICENSE
  homepage: https://pypi.org/project/cross-web
  repository: https://github.com/usecross/cross-web

extra:
  feedstock-name: cross-web
  recipe-maintainers:
    - bollwyvl
