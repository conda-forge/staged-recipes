schema_version: 1

context:
  version: "0.2"

package:
  name: rnnoise
  version: ${{ version }}

source:
  - url: https://gitlab.xiph.org/xiph/rnnoise/-/archive/v${{ version }}/rnnoise-v${{ version }}.tar.gz
    sha256: fafc947fdd24109a6e72b5f25e4224b54bc74660a2620af5548def85be8c733a

build:
  number: 0
  script: build.nu

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - nushell
    - cmake
    - if: unix
      then:
        - autoconf
        - automake
        - libtool
        - pkg-config
        - make
        - tar
    - if: win
      then:
        - ninja

tests:
  - script:
      - if: unix
        then:
          - test -f $PREFIX/lib/librnnoise${SHLIB_EXT}
          - test -f $PREFIX/include/rnnoise.h
      - if: win
        then:
          - if not exist "%LIBRARY_LIB%\rnnoise.lib" exit 1
          - if not exist "%LIBRARY_INC%\rnnoise.h" exit 1
  - if: unix
    then:
      script:
        - pkg-config --exists --print-errors rnnoise
        - pkg-config --modversion rnnoise
      requirements:
        build:
          - pkg-config

about:
  homepage: https://gitlab.xiph.org/xiph/rnnoise
  summary: "Recurrent neural network for audio noise reduction"
  description: |
    RNNoise is a noise suppression library based on a recurrent neural network.

    Features:
    - Real-time noise suppression using deep learning
    - Optimized for speech enhancement
    - Low computational overhead
    - Works on 48 kHz mono audio
    - Designed by Xiph.Org Foundation

    RNNoise is particularly effective at:
    - Removing background noise from speech
    - Enhancing voice quality in VoIP applications
    - Improving audio quality in streaming applications
    - Processing audio in real-time scenarios

    The library uses a GRU-based recurrent neural network trained on a large
    dataset of speech and noise samples. It's designed to run efficiently
    on both desktop and mobile devices.

  license: BSD-3-Clause
  license_file: COPYING
  repository: https://gitlab.xiph.org/xiph/rnnoise
  documentation: https://gitlab.xiph.org/xiph/rnnoise/-/blob/main/README.md

extra:
  recipe-maintainers:
    - phreed
