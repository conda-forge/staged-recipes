{% set name = "opam" %}
{% set version = "2.0.8" %}


package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/ocaml/opam/releases/download/{{ version }}/opam-full-{{ version }}.tar.gz
  sha256: 7b9d29233d9633ef50ba766df2e39112b15cd05c1c6fedf80bcb548debcdd9bd

build:
  number: 0
  skip: true  # [win]

# to BUILD:
# $ conda install -c conda-forge cxx-compiler ocaml make patch
# then, in 2.0.8-full directory:
# $ ./configure && make lib-ext && make
# Then to see all runtime dependencies:
# $ ./opam init --disable-sandboxing
# (--disable-sandboxing because I don't know if bwrap is available on all targets?) This will print:
#   Checking for available remotes: none.
#     - you won't be able to use rsync and local repositories unless you install the rsync command on your system.
#     - you won't be able to use git repositories unless you install the git command on your system.
#     - you won't be able to use mercurial repositories unless you install the hg command on your system.
#     - you won't be able to use darcs repositories unless you install the darcs command on your system.
#   
#   [WARNING] Recommended dependencies -- most packages rely on these:
#     - m4
#   [ERROR] Missing dependencies -- the following commands are required for opam to operate:
#     - diff
#     - unzip
requirements:
  build:
    - {{ compiler('cxx') }} # C++ definitely needed: https://github.com/ocaml/opam/issues/4452
    - ocaml >=4.11
    - make >=4.3
    - patch >=2.7.6 # needed by `make ext-lib`
  host:
  run:
    - rsync >=3.2
    - git >=2.30
    - mercurial >=5.6
    - m4 >=1.4.18
    - diffutils >=3.7
    - unzip >=6

test:
  commands:
    - opam

about:
  home: https://github.com/ocaml/opam
  summary:  opam is a source-based package manager. It supports multiple simultaneous compiler installations, flexible package constraints, and a Git-friendly development workflow.
  license: LGPL-2.1-only
  license_file: LICENSE

extra:
  recipe-maintainers:
    - fasiha

