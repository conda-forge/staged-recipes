{% set version = "1.7.6" %}

package:
  name: libadwaita
  version: {{ version }}

source:
  url: https://download.gnome.org/sources/libadwaita/{{ version.split('.')[0] }}.{{ version.split('.')[1] }}/libadwaita-{{ version }}.tar.xz
  sha256: 5eacc5550f0bdbba6a1568aebf25a3d88f5ee07d6b558becc6fd9487579c9a29
  patches:
    - 0001-remove-appstream-dependency.patch  # [win]

build:
  number: 0
  run_exports:
    - {{ pin_subpackage("libadwaita", max_pin="x.x") }}

requirements:
  build:
    - gobject-introspection
    - meson >=0.59.0
    - ninja
    - pkg-config
    - {{ compiler('c') }}
    - {{ stdlib('c') }}
    - glib            # [build_platform != target_platform]
    - gtk4            # [build_platform != target_platform]
    - fribidi         # [build_platform != target_platform]
  host:
    - glib >=2.76.0
    - gtk4 >=4.15.0
    - fribidi
  run:
    - glib >=2.76.0
    - gtk4 >=4.15.0
    - fribidi

test:
  requires:
    - pygobject
  commands:
    # Libraries/headers
    - test -f $PREFIX/lib/libadwaita-1${SHLIB_EXT}  # [unix]
    - if not exist %PREFIX%\Library\bin\adwaita-1-1.dll exit 1  # [win]
    - if not exist %PREFIX%\Library\lib\adwaita-1.lib exit 1  # [win]
    - test -f $PREFIX/include/libadwaita-1/adwaita.h  # [unix]
    - if not exist %PREFIX%\Library\include\libadwaita-1\adwaita.h exit 1  # [win]
    # pkg-config
    - pkg-config --exists --print-errors libadwaita-1  # [unix]
    # GObject Introspection
    - test -f $PREFIX/lib/girepository-1.0/Adw-1.typelib  # [unix]
    - if not exist %PREFIX%\Library\lib\girepository-1.0\Adw-1.typelib exit 1  # [win]
  source_files:  # [unix]
    - run_test.py  # [unix]

about:
  home: https://gitlab.gnome.org/GNOME/libadwaita
  summary: Building blocks for modern GNOME applications
  description: |
    Libadwaita is a collection of GTK4 widgets for adaptive user interfaces.
    It provides widgets and utilities to help create modern, responsive GNOME applications
    that work well across different form factors and input methods.
  license: LGPL-2.1-or-later
  license_family: LGPL
  license_file: COPYING
  doc_url: https://gnome.pages.gitlab.gnome.org/libadwaita/doc/main/
  dev_url: https://gitlab.gnome.org/GNOME/libadwaita

extra:
  recipe-maintainers:
    # GitHub IDs for maintainers of the recipe.
    # Always check with the people listed below if they are OK becoming maintainers of the recipe. (There will be spam!)
    - danyeaw
