context:
  name: libadwaita
  version: 1.8.4
  version_majmin: ${{ (version | split('.'))[:2] | join('.') }}

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: "https://download.gnome.org/sources/${{ name }}/${{ version_majmin }}/${{ name }}-${{ version }}.tar.xz"
  sha256: d02bb77b6f0ff1055002d299898c487cb2d83dbf940d9edf59f6fdf2572a921c
  patches:
    - 0001-remove-appstream-dependency.patch

build:
  number: 0
  script:
    - if: win
      then: |
        meson setup %MESON_ARGS% ^
          --prefix=%LIBRARY_PREFIX% ^
          --default-library=shared ^
          --wrap-mode=nofallback ^
          --buildtype=release ^
          -Ddocumentation=false ^
          -Dexamples=false ^
          -Dtests=false ^
          builddir
        ninja -v -C builddir -j %CPU_COUNT%
        ninja -C builddir install -j %CPU_COUNT%
    - if: osx
      then: |
        # Define _DARWIN_C_SOURCE to expose POSIX.1-2008 functions like strnlen
        export CFLAGS="${CFLAGS} -D_DARWIN_C_SOURCE"
    - if: unix
      then: |
        meson setup ${MESON_ARGS} \
            --prefix=$PREFIX \
            --default-library=shared \
            --wrap-mode=nofallback \
            -Ddocumentation=false \
            -Dexamples=false \
            -Dtests=false \
            builddir
        ninja -v -C builddir -j ${CPU_COUNT}
        ninja -C builddir install -j ${CPU_COUNT}

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - meson
    - ninja
    - pkg-config
    - lazka-sassc
    - gettext
  host:
    - expat
    - glib
    - gtk4
    - zlib
  run_exports:
    - ${{ pin_subpackage('libadwaita', upper_bound='x.x') }}
  ignore_run_exports:
    by_name:
      - libexpat
      - adwaita-icon-theme
      - libzlib

tests:
  - package_contents:
      files:
        - if: unix
          then:
            - lib/pkgconfig/libadwaita-1.pc
        - if: win
          then:
            - Library/lib/pkgconfig/libadwaita-1.pc
            - Library/lib/libadwaita-1.lib
      lib:
        - if: unix
          then: libadwaita-1

about:
  homepage: https://gitlab.gnome.org/GNOME/libadwaita
  summary: Building blocks for modern GNOME applications.
  description: |
    Use JSON-GLib it is possible to parse and generate valid JSON data
    structures using a DOM-like API. JSON-GLib also integrates with GObject to
    provide the ability to serialize and deserialize GObject instances to and from
    JSON data types.
  license: LGPL-2.1-or-later
  license_file: COPYING
  documentation: https://gnome.pages.gitlab.gnome.org/libadwaita/doc/
  repository: https://gitlab.gnome.org/GNOME/libadwaita

extra:
  recipe-maintainers:
    - haecker-felix
    - Hofer-Julian
