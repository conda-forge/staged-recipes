{% set name = "tensorflow-quantum" %}
{% set version = "0.6.1" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/tensorflow/quantum/archive/v0.6.1.tar.gz
  sha256: 0841a1ec58a59aaa714e1e52326fdec3ca2aa52b7f90350551d943b731471cf9

build:
  number: 0
  skip: true  # [win]
  script:
    - export TF_NEED_CUDA=0
    - ./configure.sh
    - source gen-bazel-toolchain
    - bazel build --crosstool_top=//bazel_toolchain:toolchain --cpu ${TARGET_CPU} --verbose_failures release:build_pip_package
    - bazel-bin/release/build_pip_package
    - {{ PYTHON }} -m pip install . -vv
    - ./scripts/test_all.sh

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - bazel
    - bazel-toolchain
    - future >=0.17.1
    - keras-applications
    - keras-preprocessing
    - mock
    - setuptools
    - six
    - wheel
  host:
    - pip
    - python
    - tensorflow ==2.7.0
    - numpy
  run:
    - cirq-core >=0.13.1
    - cirq-google >=0.13.1
    - google-api-core ==1.21.0
    - google-auth ==1.18.0
    - googleapis-common-protos ==1.52.0
    - {{ pin_compatible('numpy') }}
    - protobuf <=3.17.3
    - python
    - sympy ==1.8
    - tensorflow ==2.7.0

test:
  imports:
    - tensorflow_quantum
  commands:
    - pip check
  requires:
    - pip

about:
  home: https://www.tensorflow.org/quantum/overview
  summary: Hybrid Quantum-Classical Machine Learning in TensorFlow
  dev_url: https://github.com/tensorflow/quantum
  doc_url: https://www.tensorflow.org/quantum/api_docs/python/tfq
  license: Apache-2.0
  license_file: LICENSE

extra:
  recipe-maintainers:
    - BastianZim
