{% set name = "iio-emu" %}
{% set version = "0.1.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/analogdevicesinc/{{ name }}/archive/refs/tags/v{{ version }}.tar.gz
  sha256: 829286862f1f00c16996ff52700948018e8aee5706888daa1474834bc9c8c34a
  patches:
  - 0001-Add-algorithm-headers-for-min-max-on-Windows.patch  # [win]

build:
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - cmake
    - make  # [not win]
    - ninja  # [win]
    - libtinyiiod
    - libxml2
  host:
    - libtinyiiod
    - libxml2
    - libiio


test:
  commands:
    # verify cli
    - iio-emu --help
    - xml_gen

    # verify that the tools get installed
    - test -f $PREFIX/bin/iio-emu  # [not win]
    - test -f $PREFIX/bin/xml_gen  # [not win]
    - if not exist %PREFIX%\\Library\\bin\\iio-emu.exe exit 1  # [win]
    - if not exist %PREFIX%\\Library\\bin\\xml_gen.exe exit 1  # [win]

about:
  home: https://github.com/analogdevicesinc/iio-emu
  license: LicenseRef-BSD-Analog-Devices
  license_family: BSD
  license_file: LICENSE_ADIBSD
  summary: 'IIO Emulation Server and Tools'
  description: |
    Tools to emulate IIO contexts for testing and verification without hardware
  doc_url: https://github.com/analogdevicesinc/iio-emu
  dev_url: https://github.com/analogdevicesinc/iio-emu

extra:
  recipe-maintainers:
    - tfcollins
