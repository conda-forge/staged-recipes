if [[ $(id -u) == 0 ]] && [[ $(uname -s) == Linux ]]; then
    ## we assume that configuration management has already created the user for
    ## us, but will assert here that is true
    useradd --shell /sbin/nologin --user-group redis || true

    mkdir -p $PREFIX/var/log/redis
    mkdir -p /var/log/
    ln -s $PREFIX/var/log/redis /var/log/redis

    mkdir -pm 755 $PREFIX/var/db/redis
    chown redis:redis $PREFIX/var/db/redis
    mkdir -p /var/db
    ln -s $PREFIX/var/db/redis /var/db/redis

    mkdir -pm 755 $PREFIX/var/run/redis
    chown redis:redis $PREFIX/var/run/redis
    mkdir -p /var/run
    ln -s $PREFIX/var/run/redis /var/run/redis

    exec runuser redis -c '$PREFIX/bin/redis-server $PREFIX/etc/redis/redis.conf'
else
    exec $PREFIX/bin/redis-server $PREFIX/etc/redis/redis.conf
fi

