package:
    name: parallel-preprocessor
    version: '0.3'
source:
    # calc check sum by command sha256sum
    sha256: 0f472735203b16e092686003e50e25d2e6dbdeef43da8f14177d6bcb4db86634
    url: https://github.com/ukaea/parallel-preprocessor/releases/download/v0.3/parallel-preprocessor.zip

build:
    # number should be generated, or manually update, YYMM pattern here, must be 0 for the first PR
    number: '0'
    string: oct_2020
    skip: true  # [py < 38 or osx]

# libGL needs Core Dependency Tree (CDT) packages
# https://conda-forge.org/docs/maintainer/knowledge_base.html#special-dependencies
requirements:
    run_constrained:
        - __osx >={{ MACOSX_DEPLOYMENT_TARGET|default("10.9") }}  # [osx]
    build:
        - cmake
        - git
        - make  # [unix]
        - {{ compiler("cxx") }}
        - jinja
        - tbb-devel
        - pybind11
        - {{ cdt('mesa-libgl-devel') }}  # [linux]
        - {{ cdt('mesa-dri-drivers') }}  # [linux]
        - {{ cdt('libselinux') }}  # [linux]
        - {{ cdt('libxdamage') }}  # [linux]
        - {{ cdt('libxxf86vm') }}  # [linux]
        - {{ cdt('libxext') }}     # [linux]
    host:
        - python
        - boost-cpp
        - ca-certificates
        - openssl
        - occt >=7.4
        - tbb
        - freetype
        - xorg-libxt  # [linux]
        - xorg-libxpm   # [linux]
        - xorg-libxaw   # [linux]
        - xorg-libxfixes  # [linux]
        - vtk
    run:
        - python
        - {{ pin_compatible('occt') }}
        - tbb
        - xorg-libxt  # [linux]
        - freetype

test:
    commands:
        - if not exist %LIBRARY_BIN%\pppApp%SHLIB_EXT% exit 1  # [win]
        - test -f $PREFIX/lib/libpppApp$SHLIB_EXT  # [unix]
        - echo "started test in the folder $(pwd)"  # [unix]
        #- if [ -d conda-build ]; then cd conda-build; fi  # [unix]
        # unit tests can only be done in the build folder, as test data are there
        #- if [ -f run_all_tests.sh ]; then sh run_all_tests.sh; fi  # [unix]
 
about:
    home: https://github.com/ukaea/parallel-preprocessor
    license: LGPL-2.1-only
    license_family: LGPL
    license_file: LICENSE
    summary: 'parallel CAD preprocessor for large assembly simulation'

extra:
    recipe-maintainers:
        - qingfengxia
