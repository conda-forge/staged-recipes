context:
  name: r-polars
  version: "1.5.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url:
      - https://github.com/pola-rs/r-polars/archive/refs/tags/v${{ version }}.tar.gz
    sha256: a2e874dfb733ea49a43c0ee8adfdb2ee06b404ece73e266759002b5a39d2530e

build:
  number: 0
  script:
    env:
      LIBR_POLARS_FEATURES: nightly
    content:
      - mkdir inst
      - cd src/rust
      # 0.6.1 can't be build on conda-forge ci
      - cargo update -p tikv-jemalloc-sys -p tikv-jemallocator --precise 0.6.0
      - cargo-bundle-licenses --format yaml --output ../../inst/THIRDPARTY.yml
      - cd ../..
      - R CMD INSTALL --build .
  skip:
    - win

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ compiler('rust') }}
    - ${{ stdlib('c') }}
    - make
    - cargo-bundle-licenses
  host:
    - r-base
    - r-base >=4.3
    - r-rlang >=1.1.0
  run:
    - r-base
    - r-rlang >=1.1.0
  # -  r-arrow  # suggested
  # -  r-bit64  # suggested
  # -  r-blob  # suggested
  # -  r-carrier >=0.2.0  # suggested
  # -  r-cli  # suggested
  # -  r-clock  # suggested
  # -  r-curl  # suggested
  # -  r-data.table  # suggested
  # -  r-ggplot2  # suggested
  # -  r-hms  # suggested
  # -  r-jsonlite  # suggested
  # -  r-knitr  # suggested
  # -  r-mirai >=2.3.0  # suggested
  # -  r-nanoarrow >=0.6.0  # suggested
  # -  r-nycflights13  # suggested
  # -  r-patrick >=0.3.0  # suggested
  # -  r-pillar  # suggested
  # -  r-pkgload  # suggested
  # -  r-purrr >=1.1.0  # suggested
  # -  r-reticulate >=1.43.0  # suggested
  # -  r-rmarkdown  # suggested
  # -  r-testthat >=3.0.0  # suggested
  # -  r-tibble >=3.3.0  # suggested
  # -  r-vctrs  # suggested
  # -  r-withr  # suggested

tests:
  - script:
      - Rscript -e 'library("polars")'

about:
  homepage: https://pola-rs.github.io/r-polars/
  summary: R Bindings for the 'polars' Rust Library
  description: |-
    Lightning-fast 'DataFrame' library written in 'Rust'.
    Convert R data to 'Polars' data and vice versa. Perform fast,
    lazy, larger-than-memory and optimized data queries. 'Polars'
    is interoperable with the package 'arrow', as both are based on
    the 'Apache Arrow' Columnar Format.
  license: MIT
  license_file:
    - LICENSE
    - inst/THIRDPARTY.yml
  repository: https://github.com/pola-rs/r-polars

extra:
  recipe-maintainers:
    - eitsupi
