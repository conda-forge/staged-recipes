--- a/setup.py
+++ b/setup.py
@@ -14,8 +14,13 @@

 import os
+import sys
 import platform
-import shutil
+
+# Set compiler environment before any imports
+if sys.platform == "win32":
+    os.environ.setdefault('CC', 'gcc')
+
+import shutil
@@ -26,2 +38,3 @@
 from setuptools.command.build_ext import build_ext
+from build_mgclient_with_conda_lib_ext import build_mgclient_with_conda_lib_ext

@@ -316,3 +329,3 @@
     ext_modules=[
-        Extension(EXTENSION_NAME, sources=sources, depends=headers, extra_link_args=extra_link_args)
+        build_mgclient_with_conda_lib_ext()
     ],
@@ -322,3 +335,3 @@
     },
-    cmdclass={"build_ext": BuildMgclientExt},
+    cmdclass={"build_ext": GccBuildExt},
     install_requires=[
