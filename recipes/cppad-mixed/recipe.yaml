# conda-verify warnings:
#
# [C2115] Found duplicate build requirements: ...
# This warning lists two copies of 'vs2017_win-64' but meta.yaml does not
# specify this requriement (it is comming automatially).
#
# [C2122] Found invalid license family "AGPL-3.0-or-later"
# This is a valid SPDX license identifier; see
# https://spdx.org/licenses/AGPL-3.0-or-later.html
#
schema_version: 1

context:
  name: cppad-mixed
  version: 2025.0.2

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  #
  url: https://github.com/bradbell/cppad_mixed/archive/${{ version }}.tar.gz
  sha256: a5b8ddd1dc029b4e2f2a168599308c4c4f88b04b39f735709d8f6a986e13ec2e

build:
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib("c") }}
    - ${{ compiler('cxx') }}
    - cmake
    - if: not win
      then: make
  host:
    - pkg-config
    - eigen
    - cppad
    - gsl
    - libcholmod
    - ipopt
    - if: linux
      then: libopenblas
  run_exports:
    - ${{ pin_subpackage(name, upper_bound='x.x') }}

tests:
  - files:
      source:
        - example/user/no_random.cpp
    requirements:
      run:
        - ${{ compiler('cxx') }}
        - cmake
        - if: not win
          then: make
        - pkg-config
        - eigen
        - libcholmod
    script:
      - if: win
        then: if not exist %PREFIX%\\Library\\include\\cppad\\mixed\\cppad_mixed.hpp exit 1
      - if: not win
        then: test -f ${PREFIX}/include/cppad/mixed/cppad_mixed.hpp
      - if: win
        then: if not exist %PREFIX%\\Library\\lib\\pkgconfig\\cppad_mixed.pc exit 1
      - if: not_win
        then: test -f ${PREFIX}/lib/pkgconfig/cppad_mixed.pc
      - if: win
        then: if not exist %PREFIX%\\Library\\lib\\cppad_mixed.lib exit 1
      - if: linux
        then: test -f ${PREFIX}/lib/libcppad_mixed.so
      - if: osx
        then: test -f ${PREFIX}/lib/libcppad_mixed.dylib

about:
  license: AGPL-3.0-or-later
  license_file: agpl-3.0.txt
  summary: C++ Laplace Approximation of Mixed Effects Models
  homepage: https://cppad-mixed.readthedocs.io/stable-2025
  repository: https://github.com/bradbell/cppad_mixed
  documentation: https://cppad-mixed.readthedocs.io/stable-2025/

extra:
  recipe-maintainers:
    - bradbell
