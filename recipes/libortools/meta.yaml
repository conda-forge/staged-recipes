{% set name = "or-tools" %}
{% set version = "5.1" %}
{% set sha256 = "25aedf676ccc5ae246be44543572fba9be5f42f2fb0c1f7edcc6f138db207d32" %}

package:
  name: libortools
  version: {{ version }}

source:
  fn: {{ name }}-{{ version }}.tar.gz
  url: https://github.com/google/{{ name }}/archive/v{{ version }}.tar.gz
  sha256: {{ sha256 }}
  patches:
    - use_conda_version_packages.patch

build:
  number: 0
  skip: True  # [win or osx or not py3k]
  script:
    # Create Makefile.local, third_party comes from conda-packages.
    - make third_party
    - make -j${CPU_COUNT} ortoolslibs
    # Copy Headers and Protobuf files to ${PREFIX}/include/ortools
    - pushd src && find -type f -name '*.h' -or -name '*.proto' > ../headers && popd
    - tar -C src -cf headers.tar -T headers
    - mkdir ${PREFIX}/include/ortools
    - tar -xf headers.tar -C ${PREFIX}/include/ortools && rm -f include.tar headers

requirements:
  build:
    - autoconf 2.69
    - automake 1.15
    - bison 3.0.*
    - cmake
    - coincbc 2.9.*
    - curl
    - flex 2.6.*
    - gcc
    - gflags 2.1.*
    - git
    - help2man 1.47.*
    - libtool 2.4.*
    - pcre 8.*
    - python
    - protobuf 3.0.*
    - setuptools
    - sparsehash 2.0.*
    - swig 3.0.*
    - texinfo
    - texlive-core
    - toolchain
    - unzip

  run:
    - coincbc 2.9.*
    - gflags 2.1.*
    - pcre 8.*
    - protobuf 3.0.*
    - sparsehash 2.0.*

test:
  files:
    - use_ortools_in_prefix.patch
  source_files:
    - Makefile
    - examples
    - makefiles
    - tools
  requires:
    - gcc
  commands:
    - conda inspect linkages -p $PREFIX $PKG_NAME  # [linux]
    - patch -p1 -i use_ortools_in_prefix.patch
    - make third_party
    - make -j${CPU_COUNT} test_cc

about:
  home: https://developers.google.com/optimization/
  license: Apache 2.0
  license_family: Apache
  license_file: LICENSE-2.0.txt
  summary: 'Google Optimization Tools is a fast and portable software suite for solving combinatorial optimization problems'

  description: |
  doc_url: https://developers.google.com/optimization/introduction/using
  dev_url: https://github.com/google/or-tools

extra:
  recipe-maintainers:
    - sodre
