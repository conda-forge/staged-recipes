{% set name = "rust-src" %}
{% set version = "1.66.1" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://static.rust-lang.org/dist/rust-src-{{ version }}.tar.gz
  sha256: 8d23314b1f195fe9027ad91e300d7215c291c96a4c8edefdb62adedbee31189b

build:
  noarch: generic
  script:
    - ./install.sh --prefix="${PREFIX}"
    - rm "${PREFIX}"/lib/rustlib/components
    - rm "${PREFIX}"/lib/rustlib/install.log
    - rm "${PREFIX}"/lib/rustlib/rust-installer-version
    - rm "${PREFIX}"/lib/rustlib/uninstall.sh
  number: 0

requirements:
  run_constrained:
    # Having different versions of rust-src and rust is confusing.
    # `rust-src` is specific to the toolchain in `rustup`,
    # and we would like to keep that behavior.
    - rust ={{ version }}

test:
  commands:
    - test -f "${PREFIX}"/lib/rustlib/src/rust/Cargo.lock
    # Make sure that the outputs do not clobber with other rust components
    - test "$(ls "${PREFIX}"/lib/rustlib/)" -eq "manifest-rust-src\nsrc\n"

about:
  home: https://www.rust-lang.org/
  summary: The source for Rust's standard library
  description: ''
  license: (MIT or Apache-2.0)
  license_file:
    - COPYRIGHT
    - LICENSE-APACHE
    - LICENSE-MIT
  doc_url: https://www.rust-lang.org/learn
  dev_url: https://github.com/rust-lang/rust

extra:
  recipe-maintainers:
    - sshockwave
