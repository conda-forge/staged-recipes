context:
  name: gtk-sharp
  version: "2.12.45"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/mono/gtk-sharp/archive/refs/tags/${{ version }}.tar.gz
  sha256: a4bb3593235ef26e1a38c26760f118126ede2801abc41c674aa4d1eee068d9e0
  patches:
    - patches/fix-TestRange.cs.patch
    - patches/fix-windowmanager.c.patch
    - patches/update-configure-setup.patch

build:
  number: 0

requirements:
  build:
    - cairo
    - expat
    - fontconfig
    - liblzma-devel
    - make
    - pango
    - pkg-config
    - zlib
    - if: unix
      then:
        - ${{ compiler('c') }}
        - ${{ stdlib('c') }}
        - autoconf =2.69
        - automake
        - libtool
        - mono  # [build_platform != target_platform]
        - sed
      else:
        - ${{ compiler('m2w64_c') }}
        - ${{ stdlib('m2w64_c') }}
        - dotnet-sdk
        - m2-autoconf
        - m2-automake-wrapper
        - m2-bash
        - m2-grep
        - m2-libtool
        - m2-sed
        - m2-which
  host:
    - atk
    - glib
    - gtk2
    - netifaces
    - psutil
    - pyyaml
    - requests
    - robotframework
    - xorg-xorgproto
    - if: unix
      then:
        - mono
  run:
    - netifaces
    - psutil
    - pyyaml
    - requests
    - robotframework

tests:
  - package_contents:
      bin:
        - gapi2-codegen
        - gapi2-fixup
        - gapi2-parser
      lib:
        - libatksharpglue-2
        - libgdksharpglue-2
        - libglibsharpglue-2
        - libgtksharpglue-2
        - libpangosharpglue-2
      files:
        - ${{ "Library/" if win }}share/gapi-2.0/atk-api.xml
        - ${{ "Library/" if win }}share/gapi-2.0/gdk-api.xml
        - ${{ "Library/" if win }}share/gapi-2.0/glib-api.xml
        - ${{ "Library/" if win }}share/gapi-2.0/gtk-api.xml
        - ${{ "Library/" if win }}share/gapi-2.0/pango-api.xml

        - ${{ "Library/" if win }}lib/pkgconfig/gapi-2.0.pc
        - ${{ "Library/" if win }}lib/pkgconfig/glib-sharp-2.0.pc
        - ${{ "Library/" if win }}lib/pkgconfig/gtk-dotnet-2.0.pc
        - ${{ "Library/" if win }}lib/pkgconfig/gtk-sharp-2.0.pc

        # - ${{ "Library/" if win }}lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
        - ${{ "Library/" if win }}lib/gtk-sharp-2.0/gapi-fixup.exe
        - ${{ "Library/" if win }}lib/gtk-sharp-2.0/gapi-parser.exe
        - ${{ "Library/" if win }}lib/gtk-sharp-2.0/gapi2xml.pl
        - ${{ "Library/" if win }}lib/gtk-sharp-2.0/gapi_codegen.exe
        - ${{ "Library/" if win }}lib/gtk-sharp-2.0/gapi_pp.pl
  - script:
      interpreter: python
      content: |
        import os
        from pathlib import Path
        root = Path(os.environ["PREFIX"]) / ("Library" if os.name == "nt" else "") / "lib" / "mono" / "gtk-sharp-2.0"
        vs = ["2.10", "2.4", "2.6", "2.8"]
        ds = ["atk-sharp.dll", "gdk-sharp.dll", "glib-sharp.dll", "gtk-dotnet.dll", "gtk-sharp.dll", "pango-sharp.dll"]
        missing_dlls = [f"policy.{v}.{d}" for v in vs for d in ds if not (root / f"policy.{v}.{d}").exists()]
        if missing_dlls:
            print("\n".join(missing_dlls))
            exit(1)

about:
  homepage: https://github.com/mono/gtk-sharp
  summary: "Gtk# is a Mono/.NET binding to the cross platform Gtk+ GUI toolkit"
  description: |
    Gtk# is a Graphical User Interface Toolkit for mono and .Net. The project binds
    the gtk+ toolkit and assorted GNOME libraries, enabling fully native graphical
    Gnome application development using the Mono and .Net development frameworks.
  license: GPL-2.0-only
  license_file: COPYING
  documentation: http://www.mono-project.com/GtkSharp
  repository: https://github.com/mono/gtk-sharp

extra:
  recipe-maintainers:
    - MementoRC
