context:
  version: "0.0.437"

package:
  name: nsc
  version: ${{ version }}

source:
  - url: https://github.com/namespacelabs/foundation/archive/refs/tags/v${{ version }}.tar.gz
    sha256: a229b1c973539323347f04e0028af5fade498e8ec4821b853225896cbd490338

build:
  number: 0
  script:
    - go build -ldflags="-s -w -X namespacelabs.dev/foundation/internal/cli/version.Tag=v${{ version }}" -o ${{ PREFIX }}/bin/nsc${{ ".exe" if win }} ./cmd/nsc

    # Generate shell completions (only on Unix)
    - if: unix
      then:
        - mkdir -p $PREFIX/share/bash-completion/completions
        - mkdir -p $PREFIX/share/zsh/site-functions
        - mkdir -p $PREFIX/share/fish/vendor_completions.d
        - $PREFIX/bin/nsc completion bash > $PREFIX/share/bash-completion/completions/nsc
        - $PREFIX/bin/nsc completion zsh > $PREFIX/share/zsh/site-functions/_nsc
        - $PREFIX/bin/nsc completion fish > $PREFIX/share/fish/vendor_completions.d/nsc.fish

    # Collect license information
    - go-licenses save --save_path ${{ "$SRC_DIR" if unix else "%SRC_DIR%" }}/license-files ./cmd/nsc || true

requirements:
  build:
    - ${{ compiler('go-nocgo') }}
    - go-licenses

tests:
  - script: nsc version
  - script: nsc --help

about:
  homepage: https://namespace.so
  license: Apache-2.0
  license_file:
    - LICENSE
    - LICENSE-go-localereader.txt
    - license-files/
  summary: Namespace CLI - CLI to work with `namespace.so` cloud
  description: |
    Namespace is a purpose-built ephemeral compute platform that is optimized for 
    developer use-cases: high performance workloads, with high I/O requirements, 
    where caches and incrementally are first class. 
  repository: https://github.com/namespacelabs/foundation
  documentation: https://namespace.so/docs

extra:
  recipe-maintainers:
    - wolfv
