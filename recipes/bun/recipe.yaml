context:
  name: bun
  version: "1.3.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://github.com/oven-sh/bun/archive/refs/tags/bun-v${{ version }}.tar.gz
    sha256: 2bd01644a3f175c622bbcf709d5a6f71dc979dc06ca89246830a15d33f932409
  - url: https://raw.githubusercontent.com/apple-opensource/JavaScriptCore/refs/heads/master/COPYING.LIB
    sha256: 5094ecb9c9dcd0eadc34f3c11511d9b5535063032bc150164ecd1a5d5a445547
    file_name: COPYING.LIB-JavaScriptCore
  - url: https://raw.githubusercontent.com/google/brotli/refs/heads/master/LICENSE
    sha256: 3d180008e36922a4e8daec11c34c7af264fed5962d07924aea928c38e8663c94
    file_name: LICENSE-brotli
  - url: https://raw.githubusercontent.com/libarchive/libarchive/refs/heads/master/COPYING
    sha256: 30e556b3959e3985d66efefec5eaac51d4995053caa1d3cffe6eb916f146f229
    file_name: COPYING-libarchive
  - url: https://raw.githubusercontent.com/cloudflare/lol-html/refs/heads/main/LICENSE
    file_name: LICENSE-lol-html
  - url: https://raw.githubusercontent.com/microsoft/mimalloc/refs/heads/main/LICENSE
    file_name: LICENSE-mimalloc
  - url: https://raw.githubusercontent.com/h2o/picohttpparser/refs/heads/master/picohttpparser.c
    file_name: LICENSE-picohttpparser
  - url: https://raw.githubusercontent.com/facebook/zstd/refs/heads/dev/LICENSE
    file_name: LICENSE-zstd
  - url: https://raw.githubusercontent.com/simdutf/simdutf/refs/heads/master/LICENSE-APACHE
    file_name: LICENSE-APACHE-simdutf
  - url: https://raw.githubusercontent.com/simdutf/simdutf/refs/heads/master/LICENSE-MIT
    file_name: LICENSE-MIT-simdutf
  - url: https://raw.githubusercontent.com/TinyCC/tinycc/refs/heads/mob/COPYING
    file_name: COPYING-tinycc
  - url: https://raw.githubusercontent.com/uNetworking/uSockets/refs/heads/master/LICENSE
    file_name: LICENSE-uSockets
  - url: https://raw.githubusercontent.com/cloudflare/zlib/refs/heads/gcc.amd64/LICENSE
    file_name: LICENSE-zlib-cloudflare
  - url: https://raw.githubusercontent.com/c-ares/c-ares/refs/heads/main/LICENSE.md
    file_name: LICENSE-c-ares
  - url: https://raw.githubusercontent.com/unicode-org/icu/refs/heads/main/icu4c/LICENSE
    file_name: LICENSE-libicu
  - url: https://raw.githubusercontent.com/aklomp/base64/refs/heads/master/LICENSE
    file_name: LICENSE-libbase64
  - url: https://raw.githubusercontent.com/libuv/libuv/refs/heads/v1.x/LICENSE
    file_name: LICENSE-libuv
  - url: https://raw.githubusercontent.com/ebiggers/libdeflate/refs/heads/master/COPYING
    file_name: COPYING-libdeflate
  - url: https://raw.githubusercontent.com/uNetworking/uWebSockets/refs/heads/master/LICENSE
    file_name: LICENSE-uWebSockets
  - url: https://raw.githubusercontent.com/tigerbeetle/tigerbeetle/refs/heads/main/LICENSE
    file_name: LICENSE-tigerbeetle
  - url: https://raw.githubusercontent.com/evanw/esbuild/refs/heads/main/LICENSE.md
    file_name: LICENSE-esbuild
  - if: build_platform == "osx-arm64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-aarch64.zip
        sha256: 8803774e4c6c55c8a517464c508f02821e6db57f94ca1bb5cc2a39f4d2326a51
  - if: build_platform == "linux-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-linux-x64.zip
        sha256: 33c6996049e8d37e8b815959b14b05e5b6f496121352bf11bae7d047193c28bf
  - if: build_platform == "osx-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-x64.zip
        sha256: 3390f9e6a82a9c718e187513b1c56405d0de9ed3f6b092222b15b4d4ba6e304d
  - if: build_platform == "win-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-windows-x64.zip
        sha256: 2a9c0a9e6ad77d0c31fd8fb1f596b61afa7f2f2f580baad597f17e7a0dbad960

build:
  script:
    - if: unix
      then:
        - export CI=ON
        - ./bun build:release
        - mkdir -p $PREFIX/bin
        - cp build/release/bun $PREFIX/bin/bun
      else:
        - set CI=ON
        - .\bun.exe build:release
        - mkdir %LIBRARY_BIN%
        - copy build/release/bun.exe %LIBRARY_BIN%\bun.exe
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - cmake
    - ninja
    # bun uses itself to compile bun
    # - bun
    # bun uses its own zig fork from https://github.com/oven-sh/zig which is downloaded in the build script
  host: []

tests:
  - script:
      - bun --version
  - package_contents:
      bin:
        - bun
      strict: true

about:
  homepage: https://bun.com
  summary: 'Incredibly fast JavaScript runtime, bundler, test runner, and package manager â€“ all in one'
  description: |
    Bun is an all-in-one toolkit for JavaScript and TypeScript apps. It ships as a single executable called bun.
  license: MIT AND LGPL-2.0-or-later
  license_file:
    - LICENSE.md
    - COPYING.LIB-JavaScriptCore
    - LICENSE-brotli
    - COPYING-libarchive
    - LICENSE-lol-html
    - LICENSE-mimalloc
    - LICENSE-picohttpparser
    - LICENSE-zstd
    - LICENSE-APACHE-simdutf
    - LICENSE-MIT-simdutf
    - COPYING-tinycc
    - LICENSE-uSockets
    - LICENSE-zlib-cloudflare
    - LICENSE-c-ares
    - LICENSE-libicu
    - LICENSE-libbase64
    - LICENSE-libuv
    - COPYING-libdeflate
    - LICENSE-uWebSockets
    - LICENSE-tigerbeetle
    - LICENSE-esbuild
    - LICENSE-boringssl
  documentation: https://bun.com/docs
  repository: https://github.com/oven-sh/bun

extra:
  recipe-maintainers:
    - pavelzw
