context:
  name: bun
  version: "1.3.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://github.com/oven-sh/bun/archive/refs/tags/bun-v${{ version }}.tar.gz
    sha256: 2bd01644a3f175c622bbcf709d5a6f71dc979dc06ca89246830a15d33f932409
  - url: https://raw.githubusercontent.com/apple-opensource/JavaScriptCore/refs/heads/master/COPYING.LIB
    sha256: 5094ecb9c9dcd0eadc34f3c11511d9b5535063032bc150164ecd1a5d5a445547
    file_name: COPYING.LIB-JavaScriptCore
  - url: https://raw.githubusercontent.com/google/brotli/refs/heads/master/LICENSE
    sha256: 3d180008e36922a4e8daec11c34c7af264fed5962d07924aea928c38e8663c94
    file_name: LICENSE-brotli
  - url: https://raw.githubusercontent.com/libarchive/libarchive/refs/heads/master/COPYING
    sha256: 30e556b3959e3985d66efefec5eaac51d4995053caa1d3cffe6eb916f146f229
    file_name: COPYING-libarchive
  - url: https://raw.githubusercontent.com/cloudflare/lol-html/refs/heads/main/LICENSE
    file_name: LICENSE-lol-html
    sha256: e4ddaa9d7391bb9536fcb8c59b570a8b85a0bf6da54df5b3b26f098f6f99c9cc
  - url: https://raw.githubusercontent.com/microsoft/mimalloc/refs/heads/main/LICENSE
    file_name: LICENSE-mimalloc
    sha256: 82ade5d7d9b029044b5fbbc326207fc47c2d44ee4dd71e8a559c36d728217de9
  - url: https://raw.githubusercontent.com/h2o/picohttpparser/refs/heads/master/picohttpparser.c
    file_name: LICENSE-picohttpparser
    sha256: ddada2e27e9010f678a68a93a08fc13dee32178cc497b602322d80900eb94044
  - url: https://raw.githubusercontent.com/facebook/zstd/refs/heads/dev/LICENSE
    file_name: LICENSE-zstd
    sha256: 7055266497633c9025b777c78eb7235af13922117480ed5c674677adc381c9d8
  - url: https://raw.githubusercontent.com/simdutf/simdutf/refs/heads/master/LICENSE-APACHE
    file_name: LICENSE-APACHE-simdutf
    sha256: 3d34610fc6b5e1b0bfe4e2f36171c2d62c28ef05cb8d704f5a0073be41a43b3d
  - url: https://raw.githubusercontent.com/simdutf/simdutf/refs/heads/master/LICENSE-MIT
    file_name: LICENSE-MIT-simdutf
    sha256: fc8dbc04e03ad4efc08a647ffe7f995b811a95bc04c0e85a56d5277c6593fa5f
  - url: https://raw.githubusercontent.com/TinyCC/tinycc/refs/heads/mob/COPYING
    file_name: COPYING-tinycc
    sha256: 512d2d21b6b3384ba64781abb0208a1b87740bc31e2df48e2b206ddb7e4d5779
  - url: https://raw.githubusercontent.com/uNetworking/uSockets/refs/heads/master/LICENSE
    file_name: LICENSE-uSockets
    sha256: c71d239df91726fc519c6eb72d318ec65820627232b2f796219e87dcf35d0ab4
  - url: https://raw.githubusercontent.com/cloudflare/zlib/refs/heads/gcc.amd64/LICENSE
    file_name: LICENSE-zlib-cloudflare
    sha256: 845efc77857d485d91fb3e0b884aaa929368c717ae8186b66fe1ed2495753243
  - url: https://raw.githubusercontent.com/c-ares/c-ares/refs/heads/main/LICENSE.md
    file_name: LICENSE-c-ares
    sha256: 460f5e768fda3752ca2169a95df062578a10fb126bfd65f3b9b1a1bed2f84807
  - url: https://raw.githubusercontent.com/unicode-org/icu/refs/heads/main/icu4c/LICENSE
    file_name: LICENSE-libicu
    sha256: 1e881ecf2862d01e6e5bc2b861e46886d2a6fb01499c0c508a209a7271b13cf2
  - url: https://raw.githubusercontent.com/aklomp/base64/refs/heads/master/LICENSE
    file_name: LICENSE-libbase64
    sha256: 42871ad9f4e5e9255a4ec80b6c5ec9989bab6964693cf5fee6bb33f3afe39220
  - url: https://raw.githubusercontent.com/libuv/libuv/refs/heads/v1.x/LICENSE
    file_name: LICENSE-libuv
    sha256: 16de0c32b265cb7d46a6d3bd614f259dd4d693a5e26b3407b04aae8d73041f0c
  - url: https://raw.githubusercontent.com/ebiggers/libdeflate/refs/heads/master/COPYING
    file_name: COPYING-libdeflate
    sha256: 4ad69099cb4374836fd27583d9991e2838cd86b6e4666ab26b2d32582c91e73a
  - url: https://raw.githubusercontent.com/uNetworking/uWebSockets/refs/heads/master/LICENSE
    file_name: LICENSE-uWebSockets
    sha256: c71d239df91726fc519c6eb72d318ec65820627232b2f796219e87dcf35d0ab4
  - url: https://raw.githubusercontent.com/tigerbeetle/tigerbeetle/refs/heads/main/LICENSE
    file_name: LICENSE-tigerbeetle
    sha256: 0d542e0c8804e39aa7f37eb00da5a762149dc682d7829451287e11b938e94594
  - url: https://raw.githubusercontent.com/evanw/esbuild/refs/heads/main/LICENSE.md
    file_name: LICENSE-esbuild
    sha256: b40ec5baec7bb34fa5b1c09521fa3cd52d5fad7adafed74932a2010d3612a681
  - if: build_platform == "osx-arm64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-aarch64.zip
        sha256: 8803774e4c6c55c8a517464c508f02821e6db57f94ca1bb5cc2a39f4d2326a51
  - if: build_platform == "linux-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-linux-x64.zip
        sha256: 33c6996049e8d37e8b815959b14b05e5b6f496121352bf11bae7d047193c28bf
  - if: build_platform == "osx-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-x64.zip
        sha256: 3390f9e6a82a9c718e187513b1c56405d0de9ed3f6b092222b15b4d4ba6e304d
  - if: build_platform == "win-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-windows-x64.zip
        sha256: 2a9c0a9e6ad77d0c31fd8fb1f596b61afa7f2f2f580baad597f17e7a0dbad960

build:
  script:
    - if: unix
      then:
        - export CI=ON
        - ./bun build:release
        - mkdir -p $PREFIX/bin
        - cp build/release/bun $PREFIX/bin/bun
      else:
        - set CI=ON
        - .\bun.exe build:release
        - mkdir %LIBRARY_BIN%
        - copy build/release/bun.exe %LIBRARY_BIN%\bun.exe
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ compiler('rust') }}
    - ${{ stdlib('c') }}
    - cmake
    - ninja
    # bun uses itself to compile bun
    # - bun
    # bun uses its own zig fork from https://github.com/oven-sh/zig which is downloaded in the build script
  host: []

tests:
  - script:
      - bun --version
  - package_contents:
      bin:
        - bun
      strict: true

about:
  homepage: https://bun.com
  summary: 'Incredibly fast JavaScript runtime, bundler, test runner, and package manager â€“ all in one'
  description: |
    Bun is an all-in-one toolkit for JavaScript and TypeScript apps. It ships as a single executable called bun.
  license: MIT AND LGPL-2.0-or-later
  license_file:
    - LICENSE.md
    - COPYING.LIB-JavaScriptCore
    - LICENSE-brotli
    - COPYING-libarchive
    - LICENSE-lol-html
    - LICENSE-mimalloc
    - LICENSE-picohttpparser
    - LICENSE-zstd
    - LICENSE-APACHE-simdutf
    - LICENSE-MIT-simdutf
    - COPYING-tinycc
    - LICENSE-uSockets
    - LICENSE-zlib-cloudflare
    - LICENSE-c-ares
    - LICENSE-libicu
    - LICENSE-libbase64
    - LICENSE-libuv
    - COPYING-libdeflate
    - LICENSE-uWebSockets
    - LICENSE-tigerbeetle
    - LICENSE-esbuild
    - LICENSE-boringssl
  documentation: https://bun.com/docs
  repository: https://github.com/oven-sh/bun

extra:
  recipe-maintainers:
    - pavelzw
