context:
  version: 1.3.7

package:
  name: bun
  version: ${{ version }}

source:
  # - url: https://github.com/oven-sh/bun/archive/refs/tags/bun-v${{ version }}.tar.gz
  #   sha256: c250a307c6f55a39223764561fec7b7397225245fcaf0b5bd9e23b5ba285fd03
  - url: https://github.com/xhochy/bun-1.3.7/archive/refs/heads/main.tar.gz
    sha256: c9a87a48f7b61772f97ce244c74f745165f06ab38b5abced3114336e821c7aa1
  - if: build_platform == "osx-64"
    then:
      url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-x64.zip
      sha256: cdfe9c71cacbdd9a73f098c3b050671957a7414e1321dfedd9a410d7794dae51
      target_directory: bun.native
  - if: build_platform == "osx-arm64"
    then:
      url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-aarch64.zip
      sha256: 16701e494998e4764d49af2fbe62d25ec59cf3c79ee696eba1def2cfe9049d64
      target_directory: bun.native
  - if: build_platform == "linux-aarch64"
    then:
      url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-linux-aarch64.zip
      sha256: b6a25537bc2d11ebe44a478dd62a8e01dbc9f4e1c4b7d2d730b4a7e9d3580cc9
      target_directory: bun.native
  - if: build_platform == "linux-64"
    then:
      url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-linux-x64-baseline.zip
      sha256: cc14546006bf49419f3a20d2f591c8e167d112e1aa2ef1d8c77e1aec5ead372d
      target_directory: bun.native
  - if: build_platform == "win-64"
    then:
      url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-windows-x64.zip
      sha256: 659af6415800976c40338d5e1b9c0a4d61c503b880656cb00b43865a3a99e3bf
      target_directory: bun.native
  # these libraries are statically linked because they are internal forks
  - url: https://raw.githubusercontent.com/google/boringssl/refs/heads/main/LICENSE
    sha256: cc14546006bf49419f3a20d2f591c8e167d112e1aa2ef1d8c77e1aec5ead372d
    file_name: boringssl-LICENSE
  - url: https://raw.githubusercontent.com/microsoft/mimalloc/refs/heads/main/LICENSE
    sha256: cc14546006bf49419f3a20d2f591c8e167d112e1aa2ef1d8c77e1aec5ead372d
    file_name: mimalloc-LICENSE
  - url: https://raw.githubusercontent.com/TinyCC/tinycc/refs/heads/mob/COPYING
    sha256: cc14546006bf49419f3a20d2f591c8e167d112e1aa2ef1d8c77e1aec5ead372d
    file_name: tinycc-LICENSE

build:
  skip: win
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - cmake
    - sed
    - ninja
    - pkg-config
    - binutils
    - lld
  host:
    - brotli
    - c-ares
    - libhwy
    - libdeflate
    - ls-hpack
    - zlib
    - libarchive
    - hdrhistogram-c
    - zstd
    - lol-html

tests:
  - script:
    - bun --version

about:
  homepage: https://bun.sh
  repository: https://github.com/oven-sh/bun
  license: MIT
  license_file:
    - LICENSE.md
    - tinycc-LICENSE
    - boringssl-LICENSE
    - mimalloc-LICENSE
    # TODO: check whether all licenses are included
  summary: Bun is a fast all-in-one JavaScript runtime

extra:
  recipe-maintainers:
    - xhochy
    - pavelzw
    - I-Al-Istannen
