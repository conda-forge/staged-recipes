context:
  name: bun
  version: "1.3.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://github.com/oven-sh/bun/archive/refs/tags/bun-v${{ version }}.tar.gz
    sha256: 2bd01644a3f175c622bbcf709d5a6f71dc979dc06ca89246830a15d33f932409
  - if: build_platform == "osx-arm64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-aarch64.zip
        sha256: 8803774e4c6c55c8a517464c508f02821e6db57f94ca1bb5cc2a39f4d2326a51
  - if: build_platform == "linux-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-linux-x64.zip
        sha256: 33c6996049e8d37e8b815959b14b05e5b6f496121352bf11bae7d047193c28bf
  - if: build_platform == "osx-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-darwin-x64.zip
        sha256: 3390f9e6a82a9c718e187513b1c56405d0de9ed3f6b092222b15b4d4ba6e304d
  - if: build_platform == "win-64"
    then:
      - url: https://github.com/oven-sh/bun/releases/download/bun-v${{ version }}/bun-windows-x64.zip
        sha256: 2a9c0a9e6ad77d0c31fd8fb1f596b61afa7f2f2f580baad597f17e7a0dbad960

build:
  script:
    - if: unix
      then:
        - ./bun build:release
        - mkdir -p $PREFIX/bin
        - cp build/release/bun $PREFIX/bin/bun
      else:
        - .\bun.exe build:release
        - mkdir %LIBRARY_BIN%
        - copy build/release/bun.exe %LIBRARY_BIN%\bun.exe
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - cmake
    - ninja
    # bun uses itself to compile bun
    # - bun
  host: []

tests:
  - script:
      - bun --version
  - package_contents:
      bin:
        - bun
      strict: true

about:
  homepage: https://bun.com
  summary: 'Incredibly fast JavaScript runtime, bundler, test runner, and package manager â€“ all in one'
  description: |
    Bun is an all-in-one toolkit for JavaScript and TypeScript apps. It ships as a single executable called bun.
  license: MIT AND LGPL-2.0-or-later
  license_file:
    # todo: get license text of JavaScriptCore and webkit
    - LICENSE.md
  documentation: https://bun.com/docs
  repository: https://github.com/oven-sh/bun

extra:
  recipe-maintainers:
    - pavelzw
