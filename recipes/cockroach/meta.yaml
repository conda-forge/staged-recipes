{% set provider = "cockroach" %}
{% set goname = "github.com/cockroachdb/"+provider.lower() %}
{% set version = "19.1.5" %}

{% set name = goname.split('/')[-1] %}
{% set pkg_src = ('src/'+goname).replace("/",os.sep) %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
#  - folder: {{ pkg_src }}
    url: https://binaries.cockroachdb.com/{{ provider }}-v{{ version }}.src.tgz
    sha256: 1e3329a56e5a1729ed3ac4ff0a97943163325dd4825e8c7c8c1d9fd57bfddfde
    patches:
      - jemalloc_internal_cryptopp_asn.patch

#  - git_url: https://github.com/cockroachdb/{{ name }}.git
#    git_rev: v{{ version }}

#https://github.com/cockroachdb/{{ provider }}/archive/v{{ version }}.tar.gz
#c5ea99b4a011ac69260f3da1c1d21b4b1644ca8677192bc636f949c10740d7bd

build:
  number: 0
  script:
#    - pushd {{ pkg_src }}/pkg/cmd/cockroach
##    - go build -v -o $GOBIN/{{ name }} .       # [unix]
##    - go get -v -d ./...
#    - env GOOS=linux GOARCH=arm CGO_enabled=1 go build -v -o $GOBIN/{{ name }} .

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('cgo') }}
    - _go_select ==1.1.0
    - autoconf >=2.68
    - cmake >=3.1
    - make >=3.81
    - bash >=4
    - git >=1.9
    - nodejs ==6.11.0
    - yarn >=1.7
    - bison
    - jemalloc
  run:
    - jemalloc

test:
  commands:
    - cockroach --version

about:
  home: https://www.cockroachlabs.com/
  license: OTHER
  license_file: LICENSE
  summary: CockroachDB - the open source, cloud-native SQL database.
  doc_url: https://www.cockroachlabs.com/docs/stable/
  dev_url: https://github.com/cockroach/{{ name }}

extra:
  recipe-maintainers:
    - mwilson8
    - rluria14
    - sodre
