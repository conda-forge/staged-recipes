{% set org = "hpc4cmb" %}
{% set name = "libmadam" %}
{% set version = "1.0.2" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/{{ org }}/{{ name }}/releases/download/v{{ version }}/{{ name }}-{{ version }}.tar.bz2
  sha256: f1434f95d5f59d9de3783b0dad1cb815e6abc8d38994c345c46b2e8529f0c03b

build:
  number: 0
  skip: True  # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('fortran') }}
    - {{ mpi }}
    - autoconf
    - automake
    - make
    - libtool
  host:
    - python
    - pip
    - cfitsio
    - fftw
    - libblas
    - liblapack
    - numpy
    # for ./conftest: error while loading shared libraries: libquadmath.so.0: cannot open shared object file: No such file or directory
    # check if these should be in build or host
    - libgcc-ng  # [linux]
    - libgfortran-ng  # [linux]
  run:
    - python
    - {{ pin_compatible('mpi') }}
    - mpi4py
    - {{ pin_compatible('cfitsio') }}
    - {{ pin_compatible('fftw') }}
    - {{ pin_compatible('libblas') }}
    - {{ pin_compatible('liblapack') }}
    - numpy

test:
  source_files:
   - python/**/*.py
  imports:
    - libmadam_wrapper

about:
  home: https://github.com/hpc4cmb/libmadam
  license: GPL-3.0-only
  license_file: LICENSE.md
  summary: 'Making CMB temperature and polarization maps with Madam'
  description: |
    Library version of the Madam mapmaking code

    The Madam mapmaking algorithm is discussed in the following research papers:

    E. Keihänen, H. Kurki-Suonio and T. Poutanen:
    Madam - A Map-making method for CMB experiments,
    MNRAS 360 (2005) 390, astro-ph/0412517

    E. Keihänen, R. Keskitalo, H. Kurki-Suonio, T. Poutanen, A.-S. Sirviö:
    Making CMB temperature and polarization maps with Madam,
    A&A 510 (2010) A57, arXiv:0907.0367

extra:
  recipe-maintainers:
    - ickc
