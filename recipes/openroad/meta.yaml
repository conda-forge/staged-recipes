{% set name = "openroad" %}
{% set version = "2023.12.14" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://github.com/Precision-Innovations/OpenROAD/archive/refs/tags/{{ version | replace(".", "-") }}.tar.gz
    sha256: f364a5267a6cae1b801382f7abb4ad4b76dbd02e01a3131f51ead9a71d0795af

  # TODO(proppy): honor conda forge `tarballs-no-repos` policy:
  # https://conda-forge.org/docs/maintainer/adding_pkgs.html#tarballs-no-repos
  # once berkeley-abc/abc#267 is fixed.
  - git_url: https://github.com/The-OpenROAD-Project/abc.git
    # same rev as git submodule
    git_rev: 95b3543e928640dfa25f9e882e72a090a8883a9c
    folder: third-party/abc/
    
  # TODO(proppy): honor conda forge `tarballs-no-repos` policy:
  # https://conda-forge.org/docs/maintainer/adding_pkgs.html#tarballs-no-repos
  # once The-OpenROAD-Project/OpenSTA#208 is fixed.
  - git_url: https://github.com/The-OpenROAD-Project/OpenSTA.git
    # same rev as git submodule
    git_rev: 5b374dd36ad345c9fcd5224e9fc20484393568ab
    folder: src/sta/

build:
  number: 0  

requirements:
  build:
    - make
    - cmake >=3.19
    - swig 4.0.2
    - bison
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ cdt('libx11-devel') }}         # [linux]
    - {{ cdt('libxau-devel') }}         # [linux]
    - {{ cdt('libxext-devel') }}        # [linux]
    - {{ cdt('libxdamage-devel') }}     # [linux]
    - {{ cdt('libxfixes-devel') }}     # [linux]    
    - {{ cdt('libxxf86vm-devel') }}     # [linux]
    - {{ cdt('xorg-x11-proto-devel') }} # [linux]
    - {{ cdt('mesa-libgl-devel') }}     # [linux]
    - {{ cdt('mesa-dri-drivers') }}     # [linux]
    - {{ cdt('libselinux-devel') }}     # [linux]
  host:
    - python
    - boost-cpp
    - eigen
    - spdlog
    - tk
    - zlib
    - fmt
    - libgomp
    - lemon
    - libortools
    - qt

test:
  commands:
    - openroad -version
    - sta -version

about:
  home: https://theopenroadproject.org/
  summary: 'OpenROAD is an unified application implementing an RTL-to-GDS Flow.'
  description: |
    The OpenROAD (“Foundations and Realization of Open, Accessible
    Design”) project was launched in June 2018 within the DARPA IDEA
    program. OpenROAD aims to bring down the barriers of cost,
    expertise and unpredictability that currently block designers’
    access to hardware implementation in advanced technologies. The
    project team (Qualcomm, Arm and multiple universities and
    partners, led by UC San Diego) is developing a fully autonomous,
    open-source tool chain for digital SoC layout generation, focusing
    on the RTL-to-GDSII phase of system-on-chip design. Thus, OpenROAD
    holistically attacks the multiple facets of today’s design cost
    crisis: engineering resources, design tool licenses, project
    schedule, and risk.
  license: BSD-3-Clause
  license_family: BSD
  license_file: LICENSE
  doc_url: https://openroad.readthedocs.io/en/latest/
  dev_url: https://github.com/The-OpenROAD-Project/OpenROAD

extra:
  recipe-maintainers:
    - proppy
