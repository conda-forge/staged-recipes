context:
  version: "2.48.4"

package:
  name: webkit2gtk4.1
  version: ${{ version }}

source:
  url: https://webkitgtk.org/releases/webkitgtk-${{ version }}.tar.xz
  sha256: f62c1077d3a0f63d50259a802d1143be5d4d0c7c4c05e581819af1ce935afab3

build:
  number: 0
  skip: not linux
  script:
    - |
      args=(
        -DPORT=GTK
        -DENABLE_DOCUMENTATION=OFF
        -DENABLE_GAMEPAD=OFF
        -DUSE_GTK4=OFF
        -DUSE_LIBBACKTRACE=OFF 
        # libmesa package is built without screen rendering capabilities so we can't enable GBM
        # https://github.com/conda-forge/mesalib-feedstock/blob/f0c17a763eda1e0ef13cd1aa81d597d50fde0d80/recipe/meta.yaml#L54
        -DUSE_GBM=OFF
        -DUSE_SYSTEM_SYSPROF_CAPTURE=NO 
      )
    - cmake ${CMAKE_ARGS} -S . -B build -GNinja "${args[@]}"
    - cmake --build build
    - cmake --install build

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - pkg-config
    - cmake
    - ninja
  host:
    - bubblewrap
    - enchant
    - epoxy
    - expat
    - flite-dev
    - fontconfig
    - glib
    - gobject-introspection
    - gperf
    - gst-plugins-bad
    - gst-plugins-base
    - gst-plugins-good
    - gstreamer
    - gtk3
    - hyphen
    - lcms2
    - libavif
    - libdrm
    - libegl-devel
    - libgcrypt
    - libjxl
    - liblzma-devel
    - libpng
    - libseccomp
    - libsecret
    - libsoup
    - libsystemd
    - libtasn1
    - libxslt
    - perl
    - ruby
    - unifdef
    - wayland-protocols
    - woff2
    - xdg-dbus-proxy
    - xorg-xorgproto
    - zlib

tests:
  - package_contents:
      include:
        - webkitgtk-4.1/JavaScriptCore/JavaScript.h
        - webkitgtk-4.1/jsc/jsc.h
        - webkitgtk-4.1/webkit/WebKitVersion.h
        - webkitgtk-4.1/webkit2/webkit2.h
        - webkitgtk-4.1/webkitdom/webkitdom.h
      lib: 
        - libjavascriptcoregtk-4.1
        - libwebkit2gtk-4.1
      files:
        - bin/WebKitWebDriver

about:
  homepage: https://webkitgtk.org
  summary: WebKitGTK for GTK 3 and libsoup 3
  description: |
    WebKitGTK is a full-featured port of the WebKit rendering engine, 
    suitable for projects requiring any kind of web integration, from 
    hybrid HTML/CSS applications to full-fledged web browsers.
  license: LGPL-2.1-only AND BSD-2-Clause AND BSD-3-Clause AND ISC AND bzip2-1.0.6 AND NCSA AND MIT AND GPL-2.0-only AND MPL-1.1 AND SunPro AND Unicode-TOU AND Apache-2.0 AND GPL-3.0-or-later WITH Bison-exception-2.2 AND GPL-3.0-only WITH Autoconf-exception-3.0 AND MPL-2.0 AND OFL-1.1 AND (AFL-2.0 OR GPL-2.0-or-later) AND BSD-Source-Code AND BSD-2-Clause-Views AND LGPL-2.1-or-later AND (NCSA OR MIT) AND Apache-2.0 WITH LLVM-exception AND ICU AND BSL-1.0
  license_file:
    - Source/JavaScriptCore/COPYING.LIB
    - Source/ThirdParty/ANGLE/LICENSE
    - Source/ThirdParty/ANGLE/src/third_party/libXNVCtrl/LICENSE
    - Source/WebCore/LICENSE-APPLE
    - Source/WebCore/LICENSE-LGPL-2
    - Source/WebCore/LICENSE-LGPL-2.1
    - Source/WebInspectorUI/UserInterface/External/CodeMirror/LICENSE
    - Source/WebInspectorUI/UserInterface/External/Esprima/LICENSE
    - Source/WebInspectorUI/UserInterface/External/three.js/LICENSE
    - Source/WTF/icu/LICENSE
    - Source/WTF/wtf/dtoa/COPYING
    - Source/WTF/wtf/dtoa/LICENSE

extra:
  recipe-maintainers:
    - haecker-felix
    - Hofer-Julian
