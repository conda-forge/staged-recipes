From 621a77fbc55289ab0d32550ec9f1fc8a6a1d62f3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jan=20Jan=C3=9Fen?= <janssen@mpie.de>
Date: Fri, 13 Oct 2023 16:03:05 +0200
Subject: [PATCH] patch logic

---
 V3.0/source/FE2ATmap_V3.0.f90 | 26 ++++++++++----------
 1 file changed, 13 insertions(+), 13 deletions(-)

diff --git a/V3.0/source/FE2ATmap_V3.0.f90 b/V3.0/source/FE2ATmap_V3.0.f90
index d299f10..5705a93 100644
--- a/V3.0/source/FE2ATmap_V3.0.f90
+++ b/V3.0/source/FE2ATmap_V3.0.f90
@@ -439,7 +439,7 @@ RECURSIVE SUBROUTINE SearchPoint (tree,tar,ElementCenters,el)
     real ElementCenters(:,:)
     integer el,nElCell
 
-    if (found .EQ. .TRUE.) then
+    if (found .eqv. .TRUE.) then
 !      write(*,*)'already found, returning...'
       return
     else
@@ -448,41 +448,41 @@ RECURSIVE SUBROUTINE SearchPoint (tree,tar,ElementCenters,el)
       if (tar(1)>=tree%cell(1,1) .and. tar(1)<tree%cell(2,1) .and. &
           tar(2)>=tree%cell(1,2) .and. tar(2)<tree%cell(2,2) .and. &
           tar(3)>=tree%cell(1,3) .and. tar(3)<tree%cell(2,3)) then
-        if (associated(tree%child1) .and. found /= .TRUE.) then
+        if (associated(tree%child1) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child1,tar,ElementCenters,el)
         end if
-        if (associated(tree%child2) .and. found /= .TRUE.) then
+        if (associated(tree%child2) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child2,tar,ElementCenters,el)
         end if
-        if (associated(tree%child3) .and. found /= .TRUE.) then
+        if (associated(tree%child3) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child3,tar,ElementCenters,el)
         end if
-        if (associated(tree%child4) .and. found /= .TRUE.) then
+        if (associated(tree%child4) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child4,tar,ElementCenters,el)
         end if
-        if (associated(tree%child5) .and. found /= .TRUE.) then
+        if (associated(tree%child5) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child5,tar,ElementCenters,el)
         end if
-        if (associated(tree%child6) .and. found /= .TRUE.) then
+        if (associated(tree%child6) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child6,tar,ElementCenters,el)
         end if
-        if (associated(tree%child7) .and. found /= .TRUE.) then
+        if (associated(tree%child7) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child7,tar,ElementCenters,el)
         end if
-        if (associated(tree%child8) .and. found /= .TRUE.) then
+        if (associated(tree%child8) .and. found .neqv. .TRUE.) then
           nElCell = nElCell + 1
           call SearchPoint(tree%child8,tar,ElementCenters,el)
         end if
 !        write(*,'(a,6(F5.2,1X),a)')'Ultimately found in cell (',tree%cell ,')' 
 !        write(*,'(a,I3,a,3(F5.2,1X),a)')'Maybe the point is in element Nr. ',tree%first,' (',ElementCenters(tree%first,:),')' 
-        if (found == .FALSE.) then
+        if (found .eqv. .FALSE.) then
 !          write(*,*)'found  target (',tar,') in cell id ',tree%id,tree%leaf,nElCell
           el = tree%id
           found = .TRUE.
@@ -1169,7 +1169,7 @@ PROGRAM FE2ATmap
 
   ! still some stuff to do, i think...
 
-  elseif (nColsInFile == 5 .and. twod == .TRUE.) then
+  elseif (nColsInFile == 5 .and. twod .eqv. .TRUE.) then
     ! 2D cube elements !
 !    write(*,*)'First 2D cube element:',dataArray(1,1:5)
 !    print*,'Detected 2D cube elements...'
@@ -1408,7 +1408,7 @@ PROGRAM FE2ATmap
     lastid = id
     minid = .FALSE.
     maxid = .FALSE. 
-151 if (inside == .FALSE.) then
+151 if (inside .eqv. .FALSE.) then
       do i=1,nElements
 !        write(*,*)'i = ',i-1,'nid = ',nid,'id = ',id
 !        if (id > nElements) then
@@ -1440,7 +1440,7 @@ PROGRAM FE2ATmap
                      ( c(1) + c(2) + c(3) + c(4) <= 1.0+eps )
         end if 
 
-        if (inside == .TRUE.) goto 151
+        if (inside .eqv. .TRUE.) goto 151
 
         ! this is a simple forward algorithm:
 !        id = id+1
