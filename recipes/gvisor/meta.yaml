{% set provider = "gvisor" %}
{% set goname = "github.com/google/"+provider.lower() %}
{% set version = "20190806.1" %}

{% set name = goname.split('/')[-1] %}
{% set pkg_src = ('src/'+goname).replace("/",os.sep) %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - folder: {{ pkg_src }}
    url: https://github.com/google/{{ provider }}/archive/release-{{ version }}.tar.gz
    sha256: 5fe16870b75a8822663260531868bd3962fe18a35cbf6e2137246a7813fee1be

build:
  number: 0
  skip: True  # [osx and win]
  script:
    - export GOPATH=$PWD/gopath
    - pushd {{ pkg_src }}
    - bazel clean --expunge
    - bazel build runsc
#    - bazel build runsc
#    - cp ./bazel-bin/runsc/linux_amd64_pure_stripped/runsc $PREFIX/bin
#    - cd {{ pkg_src }}
#    - make runsc
#    - cp ./bazel-bin/runsc/linux_amd64_pure_stripped/runsc /usr/local/bin

#    - export GOPATH=$PWD/gopath
#    - pushd {{ pkg_src }}/runsc
#    - export CGO_ENABLED=0
#    - go build
#    - go build -v -o $GOBIN/{{ name }} .       # [unix]
#    - go build -v -o %GOBIN%\{{ name }}.exe .  # [win]

requirements:
  build:
    - {{ compiler('go') }}
    - {{ compiler('cxx') }}
    - bazel
  host:
    - python
    - pip
  run:
    - python
    - git

test:
  commands:
#    - bazel test //...
    - make unit-tests
    - make tests

about:
  home: https://gvisor.dev
  license: Apache-2.0
  license_file: LICENSE
  summary: Container Runtime Sandbox
  doc_url: https://gvisor.dev/docs
  dev_url: https://github.com/google/gvisor

extra:
  recipe-maintainers:
    - mwilson8
    - rluria14
    - sodre
