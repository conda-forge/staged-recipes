From 08bbb6f23222889036f527eef079534973f99ee5 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Sat, 5 Aug 2023 00:24:31 +1100
Subject: [PATCH 2/2] use our own trec_eval

---
 integrations/lucenesearcher_anserini_checker.py | 2 +-
 scripts/classifier_prf/cross_validate.py        | 3 ++-
 scripts/classifier_prf/rank_trec_covid.py       | 2 +-
 scripts/trec-covid-ranker.py                    | 2 +-
 4 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/integrations/lucenesearcher_anserini_checker.py b/integrations/lucenesearcher_anserini_checker.py
index fa75abd..3bc9ff1 100644
--- a/integrations/lucenesearcher_anserini_checker.py
+++ b/integrations/lucenesearcher_anserini_checker.py
@@ -31,7 +31,7 @@ class LuceneSearcherAnseriniMatchChecker:
                                               'target/appassembler/bin/SearchCollection -topicreader Trec')
         self.pyserini_base_cmd = 'python -m pyserini.search.lucene'
 
-        self.eval_base_cmd = os.path.join(eval_root, 'tools/eval/trec_eval.9.0.4/trec_eval -m map -m P.30')
+        self.eval_base_cmd = 'trec_eval -m map -m P.30'
 
     @staticmethod
     def _cleanup(files: List[str]):
diff --git a/scripts/classifier_prf/cross_validate.py b/scripts/classifier_prf/cross_validate.py
index b9fc96c..9c7ff99 100644
--- a/scripts/classifier_prf/cross_validate.py
+++ b/scripts/classifier_prf/cross_validate.py
@@ -35,7 +35,8 @@ def get_res_file_path(run_file, collection, classifier, alpha: str, rm3: bool):
 
 
 def get_trec_eval_cmd(anserini_root: str):
-    return os.path.join(anserini_root, 'tools/eval/trec_eval.9.0.4/trec_eval')
+    # already on path
+    return 'trec_eval'
 
 
 def get_qrels_path(anserini_root: str, collection: str):
diff --git a/scripts/classifier_prf/rank_trec_covid.py b/scripts/classifier_prf/rank_trec_covid.py
index 73b5ae9..74b5afd 100644
--- a/scripts/classifier_prf/rank_trec_covid.py
+++ b/scripts/classifier_prf/rank_trec_covid.py
@@ -198,7 +198,7 @@ def evaluate(qrels_path: str, run_path: str, options: str = ''):
        anserini_root = '../../../anserini'
     else:
        anserini_root = '../anserini'
-    prefix = f"{anserini_root}/tools/eval/trec_eval.9.0.4/trec_eval -c -M1000 -m all_trec {qrels_path}"
+    prefix = f"trec_eval -c -M1000 -m all_trec {qrels_path}"
     cmd1 = f"{prefix} {run_path} {options} | grep 'ndcg_cut_20 '"
     cmd2 = f"{prefix} {run_path} {options} | grep 'map                   	'"
     ndcg_score = str(subprocess.check_output(cmd1, shell=True)).split('\\t')[-1].split('\\n')[0]
diff --git a/scripts/trec-covid-ranker.py b/scripts/trec-covid-ranker.py
index 42a12aa..295ccce 100644
--- a/scripts/trec-covid-ranker.py
+++ b/scripts/trec-covid-ranker.py
@@ -198,7 +198,7 @@ def evaluate(qrels_path: str, run_path: str, options: str = ''):
        anserini_root = '../../../anserini'
     else:
        anserini_root = '../anserini'
-    prefix = f"{anserini_root}/tools/eval/trec_eval.9.0.4/trec_eval -c -M1000 -m all_trec {qrels_path}"
+    prefix = f"trec_eval -c -M1000 -m all_trec {qrels_path}"
     cmd1 = f"{prefix} {run_path} {options} | grep 'ndcg_cut_20 '"
     cmd2 = f"{prefix} {run_path} {options} | grep 'map                   	'"
     ndcg_score = str(subprocess.check_output(cmd1, shell=True)).split('\\t')[-1]
