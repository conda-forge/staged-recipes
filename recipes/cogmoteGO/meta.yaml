{% set name = "cogmoteGO" %}
{% set version = "0.1.14" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://github.com/Ccccraz/cogmoteGO/releases/download/v{{ version }}/cogmoteGO-linux-amd64-v{{ version }}.tar.gz  # [linux and x86_64]
    sha256: 7242daa44addaa01e2e82a8586e1d00a6854c16d934fab2c0e37292621b73406  # [linux and x86_64]
  - url: https://github.com/Ccccraz/cogmoteGO/releases/download/v{{ version }}/cogmoteGO-linux-arm64-v{{ version }}.tar.gz  # [linux and aarch64]
    sha256: b72d90f57cff40870b2797cab505d75f865141e0a5b838a5f6e0d30095a1a3af  # [linux and aarch64]
  - url: https://github.com/Ccccraz/cogmoteGO/releases/download/v{{ version }}/cogmoteGO-windows-amd64-v{{ version }}.zip  # [win and x86_64]
    sha256: 726b482ad365e9c566ed2d5b23de233e03eaf8d8b73580bff31014b712f4d0f3  # [win and x86_64]
  - url: https://github.com/Ccccraz/cogmoteGO/releases/download/v{{ version }}/cogmoteGO-darwin-arm64-v{{ version }}.tar.gz  # [osx and arm64]
    sha256: e1409ee3149c6ad4f4580ff78c68b8470272ba17497d284d1672d368a493360b  # [osx and arm64]
  - url: https://github.com/Ccccraz/cogmoteGO/releases/download/v{{ version }}/cogmoteGO-darwin-amd64-v{{ version }}.tar.gz  # [osx and x86_64]
    sha256: 3dffbff18ab7c0236cb5f3edc21ad95b3bbe464b852b75ec5efeca3e0f4d9a12  # [osx and x86_64]

build:
  number: 0
  missing_dso_whitelist:
    - /lib64/libc.so.6  # [linux]
    - /opt/homebrew/opt/zeromq/lib/libzmq.5.dylib  # [osx and arm64]
    - /usr/local/opt/zeromq/lib/libzmq.5.dylib  # [osx and x86_64]
  script:
    - mkdir -p $PREFIX/bin  # [linux or osx]
    - cp cogmoteGO* $PREFIX/bin/  # [linux or osx]
    - chmod +x $PREFIX/bin/cogmoteGO  # [linux or osx]
    - install_name_tool -change /usr/local/opt/zeromq/lib/libzmq.5.dylib @rpath/libzmq.5.dylib $PREFIX/bin/cogmoteGO  # [osx and x86_64]

    # Windows specific
    - mkdir %PREFIX%\\bin  # [win]
    - copy cogmoteGO* %PREFIX%\\bin\\  # [win]
    - copy libzmq-mt-4_3_5.dll %PREFIX%\\bin\\  # [win]

requirements:
  host:
    - zeromq  # [linux or osx]
    - vc  # [win]
  run:
    - zeromq  # [linux or osx]
    - vc  # [win]

test:
  commands:
    - cogmoteGO --version

about:
  home: https://github.com/Ccccraz/cogmoteGO
  summary: '"air traffic control" for remote neuroexperiments'
  description: |
    cogmoteGO is the "air traffic control" for remote neuroexperiments: 
    a lightweight Go system coordinating distributed data streams, commands, 
    and full experiment lifecycle management - from deployment to data collection.
  license: LGPL-3.0-or-later
  license_family: LGPL
  license_file: LICENSE
  doc_url: https://cogmotego.apifox.cn/
  dev_url: https://github.com/Ccccraz/cogmoteGO

extra:
  recipe-maintainers:
    - Ccccraz
