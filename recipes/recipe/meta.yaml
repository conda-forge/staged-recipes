{% set name = "openmolcas" %}
{% set version = "21.10" %}

# Define build matrix for MPI vs. non-mpi
# ensure mpi is defined (needed for conda-smithy recipe-lint)
{% set mpi = mpi or 'nompi' %}
{% set build = 0 %}
{% if mpi == 'nompi' %}
# prioritize 'nompi' variant via build number
{% set build = build + 1000 %}
{% endif %}

{% set build_string = "py{}_{}_{}".format(environ.get('CONDA_PY', ''), mpi, build) %}


package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://gitlab.com/Molcas/OpenMolcas/-/archive/v{{ version }}/OpenMolcas-v{{ version }}.tar.gz 
  sha256: 46f30c47a9f30e030cf1a4ac8b73964da81657ea9093654da057a21c7fac63f3

build:
  number: {{ build }}
  skip: true  # [win]
  string: {{ build_string }}

requirements:
  build:
    - git
    - {{ compiler('c') }}
    - {{ compiler('fortran') }}
    - cmake >=2.8.12
    - make
  host:
    - python
    - {{ mpi }}  # [mpi != 'nompi']
    - libblas  # [osx]
    - openblas-ilp64 * *openmp*  # [linux]
    - hdf5
  run:
    - python
    - {{ mpi }}  # [mpi != 'nompi']
    - libblas  # [osx]
    - openblas-ilp64 * *openmp*  # [linux]
    - hdf5

test:
  commands:
    - pyopenmolcas --help

about:
  home: https://molcas.gitlab.io/OpenMolcas/sphinx
  license: LGPL-2.1-only
  license_family: GPL
  license_file: LICENSE
  summary: 'A quantum chemistry software package developed by scientists
and intended to be used by scientists'
  description: |
      OpenMolcas is a quantum chemistry software package developed by scientists and intended to be used by scientists. It includes programs to apply many different electronic structure methods to chemical systems, but its key feature is the multiconfigurational approach, with methods like CASSCF and CASPT2.
      OpenMolcas is not a fork or reimplementation of Molcas, it is a large part of the Molcas codebase that has been released as free and open-source software (FOSS) under the Lesser General Public License (LGPL). 
      Some parts of Molcas remain under a different license by decision of their authors (or impossibility to reach them), and are therefore not included in OpenMolcas.
  doc_url: https://molcas.gitlab.io/OpenMolcas/sphinx
  dev_url: https://gitlab.com/Molcas/OpenMolcas

extra:
  recipe-maintainers:
    - ltalirz
