{% set version = "2.6.3" %}

package:
  name: icub-main-split
  version: {{ version }}

source:
  - url: https://github.com/robotology/icub-main/archive/refs/tags/v{{ version }}.tar.gz
    sha256: 346d3301da028dfe9e9d31bda259b39c8f6189a69d8bc713389ff0a0e42c02bb
    patches:
      - 985.patch

build:
  number: 0

outputs:
  - name: libicub-main
    script: build_cxx.sh  # [unix]
    script: bld_cxx.bat  # [win]
    build:
      run_exports:
        - {{ pin_subpackage("libicub-main", max_pin='x.x.x') }}
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib("c") }}
        - {{ compiler('cxx') }}
        - cmake
        - pkg-config
        - ninja
      host:
        - ycm-cmake-modules
        - ace
        - libopencv
        - gsl
        - ipopt
        - qt-main
        - sdl
        - libdc1394
        - freeglut
        - libglu
        - libyarp
        - libicub-firmware-shared
        - libgl-devel  # [linux]
        - xorg-libxfixes  # [linux]
        - xorg-libxdamage  # [linux]
        - xorg-libxxf86vm  # [linux]
        - xorg-libxext  # [linux]
        - xorg-libxau  # [linux]
        - libxcb  # [linux]
        - xorg-libxrandr  # [linux]
        - xorg-libxfixes  # [linux]
    test:
      commands:
        - test -f ${PREFIX}/lib/libiKin.so  # [unix]
        - if not exist %LIBRARY_LIB%\\iKin.lib exit 1  # [win]
        - if not exist %LIBRARY_BIN%\\iKin.dll exit 1  # [win]
        - cmake-package-check ICUB --targets iKin ctrlLib
      requires:
        - cmake-package-check
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - cmake

  - name: icub-main-python
    script: build_py.sh  # [unix]
    script: bld_py.bat  # [win]
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib("c") }}
        - {{ compiler('cxx') }}
        - swig
      host:
        - {{ pin_subpackage('libicub-main', exact=True) }}
        - python
        - libyarp
      run:
        - {{ pin_subpackage('libicub-main', exact=True) }}
        - yarp-python
    test:
      imports:
        - icub

  - name: icub-main
    build:
      run_exports:
        - {{ pin_subpackage("libicub-main", max_pin='x.x.x') }}
    requirements:
      run:
        - {{ pin_subpackage("libicub-main", exact=True) }}
        - {{ pin_subpackage("icub-main-python", max_pin='x.x.x') }}
    test:
      commands:
        - test -f ${PREFIX}/lib/libiKin.so  # [unix]
        - if not exist %LIBRARY_LIB%\\iKin.lib exit 1  # [win]
        - if not exist %LIBRARY_BIN%\\iKin.dll exit 1  # [win]
        - cmake-package-check ICUB --targets iKin ctrlLib
      requires:
        - cmake-package-check
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - cmake
      imports:
        - icub


about:
  home: https://github.com/robotology/icub-main
  license: BSD-3-Clause AND GPL-2.0-or-later
  license_file: LICENSE
  summary: 'The iCub Main Software Repository'

extra:
  feedstock-name: icub-main
  recipe-maintainers:
    - traversaro
