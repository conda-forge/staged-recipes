{% set name = "jbig2enc" %}
{% set version = "0.3.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/agl/jbig2enc/archive/refs/tags/0.30.zip
  sha256: c30416a750fbe4677827fe5e5952e5d33934ea2706edbee0fc20ee33cac6603c

build:
  number: 0
  script: |
    grep -rl 'leptonica/allheaders.h' . | xargs sed -i "s|#include <leptonica/allheaders.h>|#include \"${PREFIX}/include/leptonica/allheaders.h\"|"
    ./autogen.sh
    ./configure
    make
    make install PREFIX=${PREFIX}

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ stdlib('c') }}
    - automake
    - make
    - pkg-config
  host:
    - {{ stdlib('c') }}
    - leptonica
    - zlib
  run:
    - zlib
    - leptonica


test:
  commands:
    - jbig2 --version

about:
  home: https://github.com/agl/jbig2enc
#  repository: https://github.com/agl/jbig2enc
  summary: 'This is an encoder for JBIG2.'
  description: |
    JBIG2 encodes bi-level (1 bpp) images using a number of clever tricks to
    get better compression than G4.
    This encoder can:
      - Generate JBIG2 files, or fragments for embedding in PDFs
      - Generic region encoding
      - Perform symbol extraction, classification and text region coding
      - Perform refinement coding
      - Compress multipage documents
    It uses the (Apache-ish licensed) Leptonica library: http://leptonica.com/
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE.txt

extra:
  recipe-maintainers:
    - alf0ns3
