{% set version = "0.13.5" %}

package:
  name: anserini
  version: {{ version }}

source:
  - url: https://github.com/castorini/anserini/archive/refs/tags/anserini-{{ version }}.tar.gz
    sha256: ad57dd199f654678952bbab12cef12eee402b075f72957d175690b552d209554
  # include submodule (not in github tarball due to dear-github/dear-github#214);
  # trec_evals is built separately;
  # TODO: check if eval/rbp_eval-0.2.tar.gz artefact
  #       (from https://github.com/jsc/rbp_eval?) is used
  - git_url: https://github.com/castorini/anserini-tools.git
    git_rev: 22492bec66c55033dedfdab5b04457ee93c8ff43
    folder: tools
    patches:
      - patches/0001-don-t-hardcode-compiler.patch

build:
  noarch: python
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - maven
    - make
  host:
    - openjdk >=11
  run:
    - trec_eval

test:
  source_files:
    - src/main/python
    - src/main/resources/regression
  requires:
    - python
    - pyyaml
  commands:
    # TODO: test expected CLI interface
    # - anserini SearchCollection --help
    - python src/main/python/run_regression.py

about:
  home: anserini.io
  license: Apache-2.0
  license_file: LICENSE.txt
  summary: Anserini is a Lucene toolkit for reproducible information retrieval research
  dev_url: https://github.com/castorini/anserini

extra:
  recipe-maintainers:
    - lintool
    - MXueguang
    - h-vetinari
