context:
  name: "shs-libfabric"
  version: "2.3.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://github.com/HewlettPackard/shs-libfabric/archive/refs/tags/v${{ version }}.tar.gz
    sha256: ddbf61538d46ee7b5940a9206321a4361b60fcb774b9d2def6f844607c3117a5
    patches:
      - fix_reallocarray.patch
      - define-map-huge-shift.patch

build:
  number: 0
  script: build.sh
  skip:
    - win
    - osx

requirements:
  run_exports:
    - ${{ pin_subpackage('shs-libfabric', upper_bound='x.y') }}
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - autoconf
    - automake
    - libtool
    - make
    - pkg-config
  host:
    - json-c
    - libcurl
    - libnl
    - shs-cassini-headers
    - shs-cxi-drivers
    - shs-libcxi

tests:
  - script:
      - test -f $PREFIX/lib/libfabric.so
      - $PREFIX/bin/fi_info

about:
  homepage: https://github.com/HewlettPackard/shs-libfabric
  license: BSD-2-Clause OR GPL-2.0-only
  license_file: COPYING
  summary: 'Open Fabric Interfaces for Slingshot Host Systems'
  description: |
    Provides a CXI-enabled version of the libfabric library for high-performance networking (fork of OFIWG libfabric).

extra:
  recipe-maintainers:
    - j34ni
