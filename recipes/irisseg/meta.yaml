{% set name = "iris-label" %}
{% set version = "0.6.dev234" %}
{% set sha256 = "e8ba3a516aa75d0a75fdd2726ec1c4aec22fa5c3ac9a327821079e5928a8797e" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  # url: https://github.com/loriab/iris/archive/packaging.tar.gz
  # url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  url: https://test-files.pythonhosted.org/packages/df/26/42216925162d313dd6a3584c7d7d994b00b6c04d06a1de1559f13cd20246/iris_label-0.6.dev234.tar.gz
  sha256: {{ sha256 }}

build:
  number: 0
  noarch: python
  script:
    - {{ PYTHON }} -m pip install . --no-deps -vv
    - mv demo $SP_DIR/iris                      # [unix]
    - xcopy /f /i /s /y "demo" "%SP_DIR%\iris"  # [win]

requirements:
  host:
    - python {{ python_min }}
    - pip
    - setuptools
    - setuptools-scm
  run:
    - python >={{ python_min }}
    - flask
    - flask-compress >=1.13
    - flask-sqlalchemy >=2.5.1,<4.0
    - numpy
    - pyyaml
    - lightgbm
    - rasterio
    - requests
    - scipy
    - scikit-image
    - scikit-learn
    - sqlalchemy
    - matplotlib-base
    - gevent
    - typer
    # - libnetcdf

test:
  requires:
    - pytest
    - python {{ python_min }}
  imports:
    - iris
  commands:
    - test -f $SP_DIR/iris/__init__.py
    - test -f $SP_DIR/iris/demo/cloud-segmentation.json
    - test -f $SP_DIR/iris/static/dist/segmentationApp.js
    - iris --help
    - python -m pytest -v $SP_DIR/iris
    - python -c "import iris;assert iris.__version__ == '{{ version }}', f'{iris.__version__=} differs from recipe=\'{{ version }}\''"

about:
  home: https://github.com/gt-sse-center/iris
  # further upstream https://github.com/ESA-PhiLab/iris
  dev_url: https://github.com/gt-sse-center/iris
  doc_url: https://github.com/gt-sse-center/iris/tree/master/docs
  license: GPL-3.0-only
  license_url: https://opensource.org/license/gpl-3-0/
  license_file:
    - LICENSE
  license_family: GPL
  summary: IRIS is a semi-automatic tool for manual segmentation of multi-spectral and geo-spatial imagery.
  description: |
    IRIS is a tool for manual image segmentation of satellite imagery (or images
    in general). It was designed to accelerate the creation of machine learning
    training datasets for Earth Observation. This application is a flask app
    which can be run locally. Special highlights:
    * Support by AI (gradient boosted decision tree) when doing image segmentation
    * Multiple and configurable views for multispectral imagery
    * Simple setup with pip and one configuration file
    * Platform independent app (runs on Linux, Windows and Mac OS)
    * Multi-user support: work in a team on your dataset and merge the results

extra:
  feedstock-name: iris-label
  recipe-maintainers:
    - loriab
    # - rfievet
    # - aliFrancis
    # - DrJacqo
