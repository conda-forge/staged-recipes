{% set name = "esa-iris" %}
{% set version = "0.6" %}
{% set sha256 = "62cc4e54f2188ba6cd7a114f0439b8a8a3a6c3aab3969c44ad21728135a5c41b" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  # url: https://github.com/loriab/iris/archive/packaging.tar.gz
  # url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  # url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  url: https://test-files.pythonhosted.org/packages/02/b1/6a840c1657e3e2d8265c6de09b6282a4f408331ab5a2f961336bb3d33f72/esa_iris-0.6.dev131.tar.gz
  sha256: {{ sha256 }}

build:
  number: 0
  noarch: python
  ##script: {{ PYTHON }} -m pip install . --no-deps -vv
  ##script: {{ PYTHON }} -m pip install --no-deps -vv --ignore-installed ./esa_iris-0.1.dev1-py3-none-any.whl
  script:
    - {{ PYTHON }} -m pip install . --no-deps -vv
    - mv demo $SP_DIR/iris            # [unix]
    - copy /y "demo" "%SP_DIR%\iris"  # [win]

requirements:
  host:
    - python {{ python_min }}
    - pip
    - setuptools
    - setuptools-scm
  run:
    - python >={{ python_min }}
    - flask
    - flask-compress >=1.13
    - flask-sqlalchemy >=2.5.1,<4.0
    - numpy
    - pyyaml
    - lightgbm
    - rasterio
    - requests
    - scipy
    - scikit-image
    - scikit-learn
    - sqlalchemy
    - matplotlib
    - gevent
    - typer
    # - libnetcdf
test:
  requires:
    - pytest
  imports:
    - iris
  commands:
    - ls -l $SP_DIR/iris
    - test -f $SP_DIR/iris/__init__.py
    - test -f $SP_DIR/iris/demo/cloud-segmentation.json
    - test -f $SP_DIR/iris/static/dist/segmentationApp.js
    - iris --help
    - python -m pytest -v $SP_DIR/iris
    - python -c "import iris;print(iris.__version__)"
    - python -c "import iris;from importlib.metadata import version;print(version('esa-iris'))"
    - python -c "import iris;from importlib.metadata import distribution;print(distribution('esa-iris').version)"
    #- python -c "import iris;assert iris.__version__ == '{{ version }}', f'{iris.__version__=} differs from recipe=\'{{ version }}\''"

about:
  license: GPL-3.0-only
  #license_file:
  #  - LICENSE
  license_url: https://opensource.org/license/gpl-3-0/
  license_family: GPL
  summary: IRIS is a semi-automatic tool for manual segmentation of multi-spectral and geo-spatial imagery.
  description: |
    IRIS is a tool for manual image segmentation of satellite imagery (or images
    in general). It was designed to accelerate the creation of machine learning
    training datasets for Earth Observation. This application is a flask app
    which can be run locally. Special highlights:
    * Support by AI (gradient boosted decision tree) when doing image segmentation
    * Multiple and configurable views for multispectral imagery
    * Simple setup with pip and one configuration file
    * Platform independent app (runs on Linux, Windows and Mac OS)
    * Multi-user support: work in a team on your dataset and merge the results
  homepage: https://github.com/gt-sse-center/iris
  # further upstream https://github.com/ESA-PhiLab/iris
  repository: https://github.com/gt-sse-center/iris
  documentation: https://github.com/gt-sse-center/iris/tree/master/docs

extra:
  feedstock-name: esa-iris
  recipe-maintainers:
    - loriab
    - rfievet
    - aliFrancis
    - DrJacqo
