{% set name = "tensorflow-serving-api" %}
{% set version = "2.17.0" %}

# We need this to fetch the wheel file, which _helpfully_ uses the black2b hash, not the sha256 hash
{% set blake2b256_hash = "6bc03a73e1b6952a1f8e45f90773410a7930a2140a0441ef3dac634438682495" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  # The wheel is being used because this is generated from the tensorflow serving bazel build, and no sdist is published even though it's vanilla python.
  # The tensorflow serving build is extrememly convoluted.
  url: https://files.pythonhosted.org/packages/{{ blake2b256_hash[0:2] }}/{{ blake2b256_hash[2:4] }}/{{ blake2b256_hash[4:] }}/{{ name | replace('-', '_') }}-{{ version }}-py2.py3-none-any.whl
  sha256: 6fbbca42607a962085b0347216ca646f147de213c10fabbb41716f34df0c7775

build:
  skip: true  # [win]
  noarch: python
  script: {{ PYTHON }} -m pip install *.whl -vv --no-deps --no-build-isolation
  number: 0

requirements:
  host:
    - python >=3.9
    - pip
    - setuptools
  run:
    - python >=3.9
    - grpcio <2.0,>=1.24.3
    - protobuf !=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.20.3
    - tensorflow >=2.17.0,<3

test:
  imports:
    - tensorflow_serving.apis
  commands:
    - pip check

about:
  home: https://github.com/tensorflow/serving
  license: Apache-2.0
  license_file: LICENSE
  license_family: APACHE
  summary: |
    TensorFlow Serving is a flexible, high-performance serving system for machine learning models, designed for production environments.TensorFlow Serving makes it easy to deploy new algorithms and experiments, while keeping the same server architecture and APIs. TensorFlow Serving provides out-of-the-box integration with TensorFlow models, but can be easily extended to serve other types of models and data.

    This package contains the TensorFlow Serving Python APIs.

extra:
  recipe-maintainers:
    - snapbug
    - iamthebot
