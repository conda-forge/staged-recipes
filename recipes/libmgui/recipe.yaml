context:
  name: libmgui
  version: "1.0.0"
  author: "mhekkel"

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/${{ author }}/${{ name }}/archive/refs/tags/v${{ version }}.tar.gz
  sha256: 2095cf10dc4afda8982e4be68729cfd0136e333e7271f0ac1c72fd01acad351c

build:
  number: 0
  skip: not linux
  script:
    - if: linux
      then: |
        set -exo pipefail

        export CXXFLAGS="${CXXFLAGS} -D_LIBCPP_DISABLE_AVAILABILITY"

        if [[ ${build_platform} != ${target_platform} ]]; then
          extra_cmake_args="-DTEST_STD_CHRONO_FROM_STREAM_R=ON"
        fi

        # Skip tests for cross compilation for macos
        if [[ ${build_platform} != ${target_platform} && ${target_platform} == "osx-arm64" ]]; then
          cmake -S . -B build ${CMAKE_ARGS} -DBUILD_SHARED_LIBS=ON -DBUILD_TESTING=OFF
        else
          cmake -S . -B build ${CMAKE_ARGS} -DBUILD_SHARED_LIBS=ON -DBUILD_TESTING=ON ${extra_cmake_args}
        fi

        cmake --build build --parallel ${CPU_COUNT}
        ctest -V --test-dir build
        cmake --install build

requirements:
  build:
    - ${{ compiler("cxx") }}
    - ${{ stdlib("c") }}
    - cmake
    - pkg-config
    - if: linux
      then: make
  host:
    - libgxrio
    - maartens_resource_compiler
    - mxml
    - if: linux
      then:
        - gtk4
        - libcanberra
  run_exports: ${{ pin_subpackage(name, upper_bound="x") }}

tests:
  - script:
      - if: linux
        then: |
          test -d ${PREFIX}/include/mgui/
          test -f ${PREFIX}/lib/libmgui.so

about:
  homepage: https://github.com/mhekkel/libmgui
  repository: https://github.com/mhekkel/libmgui
  license: BSD-2-Clause
  license_file: LICENSE
  summary: "Class library for creating gui applications"
  description: |
    This library provides a cross platform application framework.

    The library uses a strict division between client code that is OS agnostic and implementation code using bridge patterns.

extra:
  recipe-maintainers:
    - eunos-1128
