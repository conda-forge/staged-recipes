{% set goname = "github.com/lima-vm/lima" %}
{% set version = "0.17.2" %}

{% set name = goname.split('/')[-1] %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - folder: src
    url: https://{{ goname }}/archive/v{{ version }}.tar.gz
    sha256: fcc3ea1de6fe5910fb1a436729e2aecf6c9b261e5c2e55a1c6754d9a5b75eb49

build:
  number: 0
  script:
    - cd src/cmd/limactl
    - go-licenses save . --save_path ../../../library_licenses
    - go build -v -o $PREFIX/bin/limactl  # [not win]
    - go build -v -o %LIBRARY_BIN%\limactl.exe  # [win]
    # Clear out cache to avoid file not removable warnings
    - chmod -R u+w $(go env GOPATH) && rm -r $(go env GOPATH)  # [unix]
    - cp ../lima $PREFIX/bin/lima # [unix]
    - cp ..\lima.bat %LIBRARY_BIN%\lima.bat # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('go-cgo') }}
    - go-licenses

test:
  commands:
    - lima --version

about:
  home: https://github.com/lima-vm/lima
  license: Apache-2.0
  license_file:
    - src/LICENSE
    - library_licenses/
  summary: Linux virtual machines
  dev_url: https://github.com/lima-vm/lima

extra:
  recipe-maintainers:
    - pavelzw
    - '0xbe7a'
    - xhochy
