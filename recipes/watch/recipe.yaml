context:
  name: watch
  version: "4.0.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://gitlab.com/procps-ng/procps/-/archive/v${{ version }}/procps-v${{ version }}.tar.gz
  sha256: 3214fab0f817d169f2c117842ba635bafb1cd6090273e311a8b5c6fc393ddb9d

build:
  skip: win
  script:
    content: |
      ./autogen.sh
      ./configure \
          --disable-nls \
          --enable-watch8bit \
          --prefix="$PREFIX"
      make src/watch
      mkdir -p $PREFIX/bin $PREFIX/man/man1
      mv src/watch $PREFIX/bin
      mv man/watch.1 $PREFIX/man/man1
  number: 0

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - pkg-config
    - autoconf
    - automake
    - gettext
    - libtool
    - make
  host:
    - ncurses
  run_constraints:
    # procps-ng already provides watch (only on linux, though)
    - procps-ng <0.0.0a0

tests:
  - script: watch --errexit --chgexit --interval 1 date

about:
  homepage: https://gitlab.com/procps-ng/procps
  summary: Executes a program periodically, showing output fullscreen
  license: GPL-2.0-or-later AND LGPL-2.1-or-later
  license_file:
    - COPYING
    - COPYING.LIB
  repository: https://gitlab.com/procps-ng/procps

extra:
  recipe-maintainers:
    - pavelzw
