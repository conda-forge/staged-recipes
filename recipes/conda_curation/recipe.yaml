context:
  version: 0.8.3

package:
  name: conda_curation
  version: ${{ version }}

source:
  url: https://github.com/AaronOpfer/conda_curation/archive/refs/tags/${{ version }}.tar.gz
  sha256: 6211de81e795bfa967aeb862caaf6f4329c77fbc8c807c66b9ebc98975fdff6c

build:
  number: 0
  skip:
    - win
  script:
    env:
      OPENSSL_DIR: ${{ prefix }}
    content:
      - grep -F '${{ version }}' Cargo.toml  # I keep forgetting to update Cargo.toml...
      - cargo-bundle-licenses --format yaml --output ${SRC_DIR}/THIRDPARTY.yml
      - $BUILD_PREFIX/bin/cargo install --locked --bins --root ${PREFIX} --path .

requirements:
  build:
    - ${{ compiler('rust') }}
    - ${{ compiler('c') }}  # jemalloc needs a C compiler
    - ${{ stdlib('c') }}
    - make  # needed for jemalloc
    - pkg-config
    - cargo-bundle-licenses
  host:
    - if: linux
      then: openssl

tests:
  - script:
      - conda_curation --help

about:
  license: MIT
  homepage: https://github.com/AaronOpfer/conda_curation
  license_file:
    - LICENSE
    - THIRDPARTY.yml
  summary: "Reduce conda repodata to enforce policy and speed up solves."
  description: "Reduce conda repodata to enforce policy and speed up solves."

extra:
  recipe-maintainers:
    - AaronOpfer
    - shoemakerdr
