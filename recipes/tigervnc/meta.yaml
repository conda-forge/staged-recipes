{% set name = "tigervnc" %}
{% set version = "1.12.0" %}
{% set xorg_x11_server_version = "1.20.14" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://github.com/TigerVNC/tigervnc/archive/v{{ version }}.tar.gz
    sha256: 9ff3f3948f2a4e8cc06ee598ee4b1096beb62094c13e0b1462bff78587bed789
    patches:
      # Disables vncsession (requires PAM and runs as root)
      # Disable PAM password check (always return failure)
      - ignore-pam.patch
  # https://github.com/TigerVNC/tigervnc/blob/v1.12.0/BUILDING.txt#L100-L146
  - url: https://github.com/freedesktop/xorg-xserver/archive/xorg-server-{{ xorg_x11_server_version }}.tar.gz
    sha256: 68105526da70d04f7111339044cdd5b2a762717178cd345aba6cb2d1b399c71b
    folder: build/unix/xserver/

build:
  number: 0
  skip: True  # [not linux]

requirements:
  build:
    - cmake
    - {{ compiler('cxx') }}
    - make
    # For building Xvnc
    - autoconf
    - automake
    - patch
    - libtool
    - pkgconfig
    - xorg-font-util
    - xorg-util-macros
    # For building Xvnc (needs to be here and in host)
    - xorg-bigreqsproto
    - xorg-compositeproto
    - xorg-damageproto
    - xorg-fontsproto
    - xorg-glproto
    - xorg-presentproto
    - xorg-randrproto
    - xorg-recordproto
    - xorg-resourceproto
    - xorg-scrnsaverproto
    - xorg-videoproto
    - xorg-xcmiscproto
    - xorg-xtrans
  host:
    - zlib
    - pixman
    - fltk
    - gnutls
    - gettext
    - libjpeg-turbo
    - ffmpeg
    - xorg-libx11
    - xorg-libxi
    # For building Xvnc
    - xorg-bigreqsproto
    - xorg-compositeproto
    - xorg-damageproto
    - xorg-fontsproto
    - xorg-glproto
    - xorg-presentproto
    - xorg-randrproto
    - xorg-recordproto
    - xorg-resourceproto
    - xorg-scrnsaverproto
    - xorg-videoproto
    - xorg-xcmiscproto
    - xorg-xtrans
  run:
    - zlib
    - pixman
    - fltk
    - gnutls
    - libjpeg-turbo
    - xorg-libx11
    - xorg-libxi
    - xorg-libxext
    - xorg-libxfixes
    - xorg-libxrender

test:
  commands:
    - vncconfig --help
    - vncpasswd --help
    - vncserver --help
    - vncviewer --help
    - x0vncserver --help
    - Xvnc --help

about:
  home: https://tigervnc.org
  license: GPL-2.0-only
  license_family: GPL
  license_file: LICENCE.TXT
  summary: 'High performance, multi-platform VNC client and server'
  description: TigerVNC is a high-performance, platform-neutral implementation of VNC (Virtual Network Computing), a client/server application that allows users to launch and interact with graphical applications on remote machines. TigerVNC provides the levels of performance necessary to run 3D and video applications, and it attempts to maintain a common look and feel and re-use components, where possible, across the various platforms that it supports. TigerVNC also provides extensions for advanced authentication methods and TLS encryption. 
  doc_url: https://github.com/TigerVNC/tigervnc/wiki
  dev_url: https://github.com/TigerVNC/tigervnc

extra:
  recipe-maintainers:
    - jan-janssen
    - manics
    - weiji14
    - yuvipanda
