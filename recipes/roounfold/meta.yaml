{% set name = "roounfold" %}
{% set version = "3.0.5" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://gitlab.cern.ch/RooUnfold/RooUnfold/-/archive/{{ version }}/RooUnfold-{{ version }}.tar.gz
  sha256: e57d846efcaff831dfeaad528fa9ebc60fe3e09165decbbc261592c23851d40a
  patches:
    - patches/cmake-minimum-3.5.patch

build:
  number: 0
  script:
    - cmake ${CMAKE_ARGS} -S . -B build
    - cmake --build build --clean-first --parallel=${CPU_COUNT}
    - cmake --install build
    - export SP_DIR=$(python -c "import site; print(site.getsitepackages()[0])")  # [unix]
    - set "SP_DIR=%PREFIX%\\Lib\\site-packages"  # [win]
    - python -c "import shutil, os; shutil.copytree(os.path.join(os.environ['SRC_DIR'], 'python'), os.path.join(os.environ['SP_DIR'], 'RooUnfold'), dirs_exist_ok=True)"

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ stdlib('c') }}
    - cmake
    - make
    - cross-python_{{ target_platform }}  # [build_platform != target_platform]
    - python  # [build_platform != target_platform]
    - root_base  # [build_platform != target_platform]
  host:
    - python
    - root_base
  run:
    - python
    - root_base

test:
  requires:
    - python
    - root_base
  commands:
    - python -c "import RooUnfold"

about:
  homepage: https://gitlab.cern.ch/RooUnfold/RooUnfold
  summary: 'RooUnfold is a framework for unfolding (AKA "deconvolution" or "unsmearing").'
  description: |
    RooUnfold is a framework for unfolding (AKA "deconvolution" or
    "unsmearing"). It can be used from the ROOT prompt, or compiled and
    linked against the ROOT libraries. It currently implements:
      - iterative ("Bayesian")
      - singular value decomposition (SVD, by HÃ¶cker & Kartvelishvili)
      - bin-by-bin (simple correction factors)
      - TUnfold method by Stefan Schmitt
      - simple inversion without regularisation
      - iterative dynamically stabilized (IDS)
      - Gaussian process regularization
      - Poisson likelihood unfolding
  license: MIT  # TODO: double-check actual license
  license_file: README.md  # TODO: replace with actual license file if available
  doc_url: https://gitlab.cern.ch/RooUnfold/documentation/-/blob/master/RooUnfold_user_guide.pdf
  dev_url: https://gitlab.cern.ch/RooUnfold/RooUnfold

extra:
  recipe-maintainers:
    - kratsg
    - cburgard
