{% set version = "1.1" %}
{% set build = 0 %}
{% set mpi = mpi or "nompi" %}

package:
  name: gauxc
  version: {{ version }}

source:
  - url: https://github.com/wavefunction91/gauxc/archive/refs/tags/v{{ version }}.tar.gz
    sha256: 17de077fb23e44d03b0ed14dcd8117c01e5b3431fbefa2352d751639ada7f91c
    patches:
      - patches/gh-161.patch  # Allow finding highfive library
  - url: https://github.com/wavefunction91/linalg-cmake-modules/archive/9d2c273a671d6811e9fd432f6a4fa3d915b144b8.tar.gz
    sha256: 6e49c6c7c7df14b956d1fee77d9b6aad9ded3210cd639133c69a52b2e5ce4eae
    folder: external/linalg-cmake-modules
  - url: https://github.com/wavefunction91/IntegratorXX/archive/1369be58d7a3235dac36d75dd964fef058830622.tar.gz
    sha256: a2b168ba8721cf4969f2324dd363a52698f3f2a3b71ef451e1d72cce367b002a
    folder: external/integratorxx

{% if mpi == "nompi" %}
{% set build = build + 100 %}
{% endif %}
build:
  number: {{ build }}
  skip: true  # [win]

  string: {{ mpi_prefix }}_h{{ PKG_HASH }}_{{ build }}

  run_exports:
    - {{ pin_subpackage("gauxc", max_pin='x.x') }} {{ mpi_prefix }}_*

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ stdlib('c') }}
    - cmake >3.20,<4
    - ninja
    - llvm-openmp  # [osx]
  host:
    - exchcxx >=1.0,<2
    - gau2grid >=2.0.6,<3
    - hdf5 * {{ mpi_prefix }}_*
    - highfive >=2.4.1,<3
    - libblas  # [linux]
    - libgomp  # [linux]
    - llvm-openmp  # [osx]
    - {{ mpi }}  # [mpi != "nompi"]
  run:
    - llvm-openmp  # [osx]
    - {{ mpi }}  # [mpi != "nompi"]

test:
  commands:
    - test -f $PREFIX/lib/libgauxc$SHLIB_EXT  # [unix]

about:
  home: https://github.com/wavefunction91/gauxc
  summary: >-
     GauXC is a modern, modular C++ library for the evaluation of quantities related to
     the exchange-correlation (XC) energy (e.g. potential, etc) in the Gaussian basis set
     discretization of Kohn-Sham density function theory (KS-DFT) on heterogenous architectures.
  license: BSD-3-Clause and BSL-1.0
  license_file:
    - LICENSE.txt  # BSD-3-Clause
    - NOTICE.md
    - external/linalg-cmake-modules/LICENSE.txt  # BSD-3-Clause
    - external/integratorxx/LICENSE.txt  # BSD-3-Clause

extra:
  recipe-maintainers:
    - awvwgk
