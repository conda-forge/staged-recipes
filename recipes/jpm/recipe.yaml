context:
  name: jpm
  version: "1.1.0"
  commit: c886d61d170194c8e6a605658a17a078b6ab546a
  sha256: df97e2c17abc09d87fdabcf3ea31552dc62abcd9a4e1a54a62c839b2cc3dc200

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/janet-lang/${{ name }}/archive/${{ commit }}.tar.gz
  sha256: ${{ sha256 }}
  patches:
    - patches/0001-Allow-dynamic-libjanet-in-cc-helpers.patch

build:
  number: 0
  skip:
    - win
  script:
    - bash ${{ RECIPE_DIR }}/build.sh

requirements:
  host:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - janet
    - pkg-config
  run:
    - janet
    - git
    - pkg-config
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}

tests:
  - script:
      - jpm help
  - script:
      file: tests/test_new_project.sh
  - script:
      file: tests/test_local_module.sh
  - script:
      file: tests/test_quickbin.sh
  - script:
      file: tests/test_sqlite3.sh
    requirements:
      run:
        - libsqlite
  - script:
      file: tests/test_sqlite_dependency.sh
    requirements:
      run:
        - libsqlite

about:
  homepage: https://github.com/janet-lang/jpm
  summary: Janet Project Manager for building and installing Janet packages
  description: |
    JPM is the Janet Project Manager tool. It automates builds and dependency
    management for Janet projects and can install packages from git or local sources.
  license: MIT
  license_file: LICENSE
  repository: https://github.com/janet-lang/jpm

extra:
  recipe-maintainers:
    - tdejager
