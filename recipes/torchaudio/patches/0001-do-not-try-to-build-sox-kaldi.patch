From 42bd53775f10d90461c85a040f6fdf05f9befc1b Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Fri, 26 Nov 2021 14:14:52 +1100
Subject: [PATCH] do not try to build sox/kaldi

---
 third_party/CMakeLists.txt     | 7 +------
 torchaudio/csrc/CMakeLists.txt | 4 ++--
 2 files changed, 3 insertions(+), 8 deletions(-)

diff --git a/third_party/CMakeLists.txt b/third_party/CMakeLists.txt
index ef984d5..0ddaa9a 100644
--- a/third_party/CMakeLists.txt
+++ b/third_party/CMakeLists.txt
@@ -5,20 +5,15 @@ set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fvisibility=hidden")
 ################################################################################
 # sox
 ################################################################################
-add_library(libsox INTERFACE)
 if (BUILD_SOX)
-  add_subdirectory(sox)
-  target_include_directories(libsox INTERFACE ${SOX_INCLUDE_DIR})
   target_link_libraries(libsox INTERFACE ${SOX_LIBRARIES})
-  list(APPEND TORCHAUDIO_THIRD_PARTIES libsox)
 endif()
 
 ################################################################################
 # kaldi
 ################################################################################
 if (BUILD_KALDI)
-  add_subdirectory(kaldi)
-  list(APPEND TORCHAUDIO_THIRD_PARTIES kaldi)
+  # done in conda-forge
 endif()
 
 set_property(GLOBAL PROPERTY TORCHAUDIO_THIRD_PARTIES "${TORCHAUDIO_THIRD_PARTIES}")
diff --git a/torchaudio/csrc/CMakeLists.txt b/torchaudio/csrc/CMakeLists.txt
index 2187aba..b329d11 100644
--- a/torchaudio/csrc/CMakeLists.txt
+++ b/torchaudio/csrc/CMakeLists.txt
@@ -33,11 +33,11 @@ if(BUILD_RNNT)
   endif()
 endif()
 
-if(BUILD_KALDI)
+if(FALSE)
   list(APPEND LIBTORCHAUDIO_SOURCES kaldi.cpp)
 endif()
 
-if(BUILD_SOX)
+if(FALSE)
   list(
     APPEND
     LIBTORCHAUDIO_SOURCES
-- 
2.32.0.windows.2

