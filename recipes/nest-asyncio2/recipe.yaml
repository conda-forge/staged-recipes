context:
  version: 1.7.1

package:
  name: nest-asyncio2
  version: ${{ version }}

source:
- url: https://pypi.org/packages/source/n/nest-asyncio2/nest_asyncio2-${{ version }}.tar.gz
  sha256: a1fe5bbbd20894dcceb1842322d74992c5834d5ab692af2c4f59a9a4fcf75fe8

build:
  script: python -m pip install . -vv
  noarch: python
  number: 0

requirements:
  host:
  - python ${{ python_min }}.*
  - setuptools >=42
  - pip
  run:
  - python >=${{ python_min }}

tests:
- python:
    imports:
    - nest_asyncio2
    pip_check: true
    python_version: ${{ python_min }}.*

about:
  homepage: https://github.com/Chaoses-Ib/nest-asyncio2
  summary: Patch asyncio to allow nested event loops
  description: |
    By design asyncio does not allow its event loop to be nested. This presents a practical problem: When in an environment where the event loop is already running it's impossible to run tasks and wait for the result. Trying to do so will give the error "RuntimeError: This event loop is already running".

    The issue pops up in various environments, such as web servers, GUI applications and in Jupyter notebooks.

    This module patches asyncio to allow nested use of asyncio.run and loop.run_until_complete.
    nest-asyncio2 is a fork of the unmaintained nest_asyncio, with the following changes:

    - Support setting run_close_loop to avoid leaked event loop.
    - Python 3.12 support
      - loop_factory parameter support
    - Python 3.14 support
      - Fix broken asyncio.current_task() and others
      - Fix DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    - To avoid potential bugs, apply() will warn if asyncio is already patched by nest_asyncio on Python 3.12+.
      You can also set error_on_mispatched=True to turn the warning into a RuntimeError, regardless of the Python version. See #1 for details.

    There is no behavior change on Python < 3.12.
    All interfaces are kept as they are. To migrate, you just need to change the package and module name to nest_asyncio2.
  license: BSD-2-Clause
  license_file: LICENSE

extra:
  recipe-maintainers:
    - claudiushaag
