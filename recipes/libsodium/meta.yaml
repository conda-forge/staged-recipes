{% set name = "libsodium" %}
{% set version = "1.0.20" %}

{% set so_version = "26.2.0" %}
{% set so_major_version = so_version.split('.')[0] %}
package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/jedisct1/libsodium/archive/refs/tags/{{ version }}-RELEASE.tar.gz
  sha256: 8e5aeca07a723a27bbecc3beef14b0068d37e7fc0e97f51b3f1c82d2a58005c1

build:
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ stdlib("c") }}
    - make
    # - zig
  host:
  run:

test:
  requires:
  commands:
    - test -f $PREFIX/lib/libsodium.so.{{ so_version }}  # [linux]
    - test -f $PREFIX/lib/libsodium.so.{{ so_major_version }}  # [linux]
    - test -f $PREFIX/lib/libsodium{{ SHLIB_EXT }}  # [unix]
    - test -f $PREFIX/lib/libsodium.{{ so_major_version }}.dylib  # [osx]
    - test -f $PREFIX/lib/pkgconfig/libsodium.pc  # [unix]
    {% set headers = [
      "core.h", "crypto_aead_aes256gcm.h", "crypto_aead_aegis128l.h", "crypto_aead_aegis256.h", "crypto_auth.h"
      "crypto_aead_chacha20poly1305.h", "crypto_aead_xchacha20poly1305.h", "crypto_auth_hmacsha256.h"
      "crypto_auth_hmacsha512.h", "crypto_auth_hmacsha512256.h", "crypto_box.h", "crypto_box_curve25519xchacha20poly1305.h"
      "crypto_box_curve25519xsalsa20poly1305.h", "crypto_core_ed25519.h", "crypto_core_ristretto255.h"
      "crypto_core_hchacha20.h", "crypto_core_hsalsa20.h", "crypto_core_salsa20.h", "crypto_core_salsa2012.h"
      "crypto_core_salsa208.h", "crypto_generichash.h", "crypto_generichash_blake2b.h", "crypto_hash.h"
      "crypto_hash_sha256.h", "crypto_hash_sha512.h", "crypto_kdf.h", "crypto_kdf_hkdf_sha256.h", "crypto_kdf_hkdf_sha512.h"
      "crypto_kdf_blake2b.h", "crypto_kx.h", "crypto_onetimeauth.h", "crypto_onetimeauth_poly1305.h", "crypto_pwhash.h"
      "crypto_pwhash_argon2i.h", "crypto_pwhash_argon2id.h", "crypto_pwhash_scryptsalsa208sha256.h", "crypto_scalarmult.h"
      "crypto_scalarmult_curve25519.h", "crypto_scalarmult_ed25519.h", "crypto_scalarmult_ristretto255.h"
      "crypto_secretbox.h", "crypto_secretbox_xchacha20poly1305.h", "crypto_secretbox_xsalsa20poly1305.h"
      "crypto_secretstream_xchacha20poly1305.h", "crypto_shorthash.h", "crypto_shorthash_siphash24.h", "crypto_sign.h"
      "crypto_sign_ed25519.h", "crypto_sign_edwards25519sha512batch.h", "crypto_stream.h", "crypto_stream_chacha20.h"
      "crypto_stream_salsa20.h", "crypto_stream_salsa2012.h", "crypto_stream_salsa208.h", "crypto_stream_xchacha20.h"
      "crypto_stream_xsalsa20.h", "crypto_verify_16.h", "crypto_verify_32.h", "crypto_verify_64.h", "export.h", "randombytes.h"
      "randombytes_internal_random.h", "randombytes_sysrandom.h", "runtime.h", "utils.h", "version.h"
    ] %}
    {% for header in headers %}
    - test -f $PREFIX/include/sodium/{{ header }}  # [unix]
    {% endfor %}
    - test -f $PREFIX/include/sodium.h  # [unix]
    - test ! -f $PREFIX/lib/libsodium.a  # [unix]

about:
  home: https://github.com/jedisct1/libsodium
  summary: 'Sodium is an easy-to-use software library for encryption, decryption, signatures, password hashing, and more.'
  description: |
    Sodium is an easy-to-use software library for encryption, decryption, signatures, password hashing, and more.
    It is a portable, cross-compilable, installable, packageable fork of NaCl, with a compatible API, and an
    extended API to improve usability even further.
    Its goal is to provide all of the core operations needed to build higher-level cryptographic tools.
    Sodium supports a variety of compilers and operating systems, including Windows (with MingW or Visual Studio,
    x86 and x64), iOS, Android, as well as Javascript and Webassembly.
  license_file: LICENSE
  doc_url: https://doc.libsodium.org/

extra:
  recipe-maintainers:
    - MementoRC
