From be4010fbcdb1b6d9dc6087b112123577b56f2dca Mon Sep 17 00:00:00 2001
From: Sherman Siu <s8siu@uwaterloo.ca>
Date: Sun, 21 Sep 2025 12:24:37 -0400
Subject: [PATCH 2/2] Include the `BUILD_PREFIX`'s include targets directory
 when building

---
 flashinfer/jit/cpp_ext.py | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/flashinfer/jit/cpp_ext.py b/flashinfer/jit/cpp_ext.py
index a0777b9..ea84784 100644
--- a/flashinfer/jit/cpp_ext.py
+++ b/flashinfer/jit/cpp_ext.py
@@ -75,6 +75,7 @@ def generate_ninja_build_for_op(
 ) -> str:
     system_includes = [
         sysconfig.get_path("include"),
+        "conda_build_include_targets_dir",
         "$torch_home/include",
         "$torch_home/include/torch/csrc/api/include",
         "$cuda_home/include",
@@ -173,12 +174,14 @@ def generate_ninja_build_for_op(
     cxx = os.environ.get("CXX", "c++")
     cuda_home = CUDA_HOME or "/usr/local/cuda"
     nvcc = os.environ.get("PYTORCH_NVCC", "$cuda_home/bin/nvcc")
+    conda_build_include_targets_dir = os.environ.get("CONDA_BUILD_INCLUDE_TARGETS_DIR")
 
     lines = [
         "ninja_required_version = 1.3",
         f"name = {name}",
         f"cuda_home = {cuda_home}",
         f"torch_home = {_TORCH_PATH}",
+        f"conda_build_include_targets_dir = {conda_build_include_targets_dir}",
         f"cxx = {cxx}",
         f"nvcc = {nvcc}",
         "",
