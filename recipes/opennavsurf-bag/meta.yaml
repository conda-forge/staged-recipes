{% set version = "2.0.1" %}

package:
  name: opennavsurf-bag
  version: {{ version }}

source:
  url: https://github.com/OpenNavigationSurface/BAG/archive/refs/tags/release-{{ version }}.tar.gz
  sha256: 7b246eec04f46782b74bc9bf14be5ddf0a157360d17bd2f48a150992c540025d

build:
  number: 0
  skip: true  # [py<38]
  run_exports:
    - hdf5

requirements:
  build:
    - cmake
    - ninja
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - sysroot_linux-64  # [linux64]
    - python  # [build_platform != target_platform]
    - cross-python_{{ target_platform }}  # [build_platform != target_platform]
    - swig
  host:
    - hdf5
    - libxml2
  run:
    - libcxx  # [osx]

outputs:
  - name: libbaglib
    script: install_lib.sh  # [unix]
    script: install_lib.bat  # [win]
    build:
      run_exports:
        - {{ pin_subpackage('libbaglib', max_pin='x.x') }}
    requirements:
      build:
        - cmake
        - ninja
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - sysroot_linux-64  # [linux64]
        - catch2
      host:
        - hdf5
        - libxml2
      run:
        - libcxx  # [osx]
    about:
      summary: The Bathymetric Attributed Grid (BAG) library
      license: BSD-3-Clause
      license_file: LICENSE.txt

  - name: bagpy
    script: install_python.sh  # [unix]
    script: install_python.bat  # [win]
    build:
      skip_compile_pyc:
        python/*.py
    requirements:
      build:
        - cmake
        - ninja
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - python  # [build_platform != target_platform]
        - cross-python_{{ target_platform }}  # [build_platform != target_platform]
        - swig
      host:
        - python
        - pip
        - setuptools
        - pytest
        - setuptools-scm
        - wheel
        - cmake-build-extension
        - hdf5
        - libxml2
        - {{ pin_subpackage('libbaglib', exact=True) }}
      run:
        - python
        - {{ pin_subpackage('libbaglib', exact=True) }}
    test:
      files:
        - run_test.py
      imports:
        - bagPy
      commands:
        - python run_test.py
    about:
      summary: Python wrapper for the Bathymetric Attributed Grid (BAG) library
      license: BSD-3-Clause
      license_file: LICENSE.txt

about:
  home: https://github.com/OpenNavigationSurface/BAG
  license: BSD-3-Clause
  license_file: LICENSE.txt
  summary: |
    BAG consists of library code and examples required to read and write data in the Bathymetric Attributed 
    Grid (BAG) file format.

extra:
  recipe-maintainers:
    - selimnairb
