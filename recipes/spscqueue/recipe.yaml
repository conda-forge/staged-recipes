# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: "1.1"

package:
  name: spscqueue
  version: ${{ version }}

source:
  - url: https://github.com/rigtorp/SPSCQueue/archive/refs/tags/v${{ version }}.tar.gz
    sha256: 10f290c72e60ba0d7999c65926f96fab0b1c2f360ce5bbcfe0cf69448d067af5

build:
  number: 0
  script:
    - if: win
      then: |
        cmake -GNinja %CMAKE_ARGS% %SRC_DIR%
      else: |
        cmake -GNinja $CMAKE_ARGS $SRC_DIR
    - cmake --build . --config Release
    - cmake --install . --config Release

requirements:
  build:
    - ${{ compiler('cxx') }}
    - ${{ stdlib("c") }}
    - cmake
    - ninja
  host: []
  run: []

tests:
  - package_contents:
      include:
        - rigtorp/SPSCQueue.h
      files:
        exists:
          - ${{ "Library/" if win }}lib/cmake/SPSCQueue/SPSCQueueConfig.cmake
          - ${{ "Library/" if win }}lib/cmake/SPSCQueue/SPSCQueueConfigVersion.cmake

about:
  homepage: https://github.com/rigtorp/SPSCQueue
  summary: "A bounded single-producer single-consumer wait-free and lock-free queue written in C++11"
  description: |
    SPSCQueue is a high-performance lock-free queue optimized for single-producer,
    single-consumer scenarios. It provides:

    - Wait-free and lock-free operations
    - Cache line alignment to avoid false sharing
    - Header-only implementation for easy integration
    - C++11 compatible
    - Optimal performance for high-throughput applications

    This library is particularly useful for:
    - High-frequency trading systems
    - Audio/video processing pipelines
    - Real-time applications requiring predictable latency
    - Inter-thread communication with minimal overhead

    Note: This package uses upstream rigtorp/SPSCQueue with a replacement
    CMakeLists.txt file to ensure proper conda build compatibility. The
    replacement file adds conditional SYSTEM includes and improved CMake
    version compatibility while maintaining full API compatibility.

  license: MIT
  license_file: LICENSE
  repository: https://github.com/rigtorp/SPSCQueue
  documentation: https://github.com/rigtorp/SPSCQueue/blob/master/README.md

extra:
  recipe-maintainers:
    - phreed
