{% set name = "couchdb" %}
{% set version = "3.2.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://couchdb.neighbourhood.ie/downloads/{{ version }}/win/apache-couchdb-{{ version }}.msi  # [win]
    sha256: 73e8019eba544a42c24a865d849af1daeef74c4c1c20518725d092e4e667a54a  # [win]
  - url: https://couchdb.neighbourhood.ie/downloads/{{ version }}/mac/Apache-CouchDB.zip  # [osx]
    sha256: 43602aae22f4133f7ef2b5b16fd59c676f1a13e8fc596e3f7504c386a8525fea  # [osx]
  - url: https://archive.apache.org/dist/couchdb/source/3.2.0/apache-couchdb-{{ version }}.tar.gz  # [linux]
    sha256: 8bea574faa6bb0926c670542d8318c322268cf7e6614dab318dea734ccf1b00c  # [linux]
    folder: couchdb
  - url: https://apache.jfrog.io/artifactory/couchdb-deb/pool/s/spidermonkey/couch-libmozjs185-1.0_1.8.5-1.0.0+couch-2~stretch_amd64.deb  # [linux]
    sha256: b4fee09a331f09d6aa83b707d878b0c4257a4709f9f9ea45d58a9e1afc72148a  # [linux]
    folder: mozjs  # [linux]
  - url: https://apache.jfrog.io/artifactory/couchdb-deb/pool/s/spidermonkey/couch-libmozjs185-dev_1.8.5-1.0.0+couch-2~stretch_amd64.deb  # [linux]
    sha256: 7cd04e100f0f9aeabf7f2d4637751a182425e61e55c2eaae7d36cb3a3f991fcf  # [linux]
    folder: mozjsdev  # [linux]

build:
  binary_relocation: False  # [osx]
  missing_dso_whitelist: bin/CouchdbApp/*  # [osx]
  number: 0

requirements: # linux packages don't include system dependencies: https://docs.couchdb.org/en/stable/install/unix.html#dependencies
  build:
    - {{ compiler('c') }}  # [linux]
    - {{ compiler('cxx') }}  # [linux]
    - make  # [linux]
    - sysroot_linux-64 2.17  # [linux64]
  host:
    - libffi 3.2.1  # [linux]
    - nspr  # [linux]
    - erlang  # [linux]
    - icu  # [linux]
  run:
    - openssl 1.1.1  # [linux]
    - icu  # [linux]
    - libffi 3.2.1  # [linux]
    - nspr  # [linux]
    - ncurses  # [linux]
    - libzlib  # [linux]

test:
  commands:
    - couchjs -V

about:
  home: https://couchdb.apache.org/
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE.txt
  summary: |
    Seamless multi-master sync, that
    scales from Big Data to Mobile,
    with an Intuitive HTTP/JSON API
    and designed for Reliability.
  description: |
    Apache CouchDBâ„¢ lets you access your data where you need it. The Couch Replication Protocol is implemented in a variety of projects and products that span every imaginable computing environment from globally distributed server-clusters, over mobile phones to web browsers.

    Store your data safely, on your own servers, or with any leading cloud provider. Your web- and native applications love CouchDB, because it speaks JSON natively and supports binary data for all your data storage needs.

    The Couch Replication Protocol lets your data flow seamlessly between server clusters to mobile phones and web browsers, enabling a compelling offline-first user-experience while maintaining high performance and strong reliability. CouchDB comes with a developer-friendly query language, and optionally MapReduce for simple, efficient, and comprehensive data retrieval. 
  doc_url: https://docs.couchdb.org/en/stable/
  dev_url: https://github.com/apache/couchdb

extra:
  recipe-maintainers:
    - pepijndevos
