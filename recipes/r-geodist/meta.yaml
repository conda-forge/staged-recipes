{% set version = '0.1.1' %}
{% set posix = 'm2-' if win else '' %}

package:
  name: r-geodist
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/geodist_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/geodist/geodist_{{ version }}.tar.gz
  sha256: 18e443731c399395a3adc758bd9e50807c77f8d971f9c2e9473e3d68b702ccc8

build:
  number: 0
  rpaths:
    - lib/R/lib/
    - lib/
  missing_dso_whitelist:
    - '*/R.dll'        # [win]
    - '*/Rblas.dll'    # [win]
    - '*/Rlapack.dll'  # [win]

requirements:
  build:
    - {{ compiler('c') }}              # [not win]
    - {{ compiler('m2w64_c') }}        # [win]
    - {{ stdlib('c') }}                # [not win]
    - {{ posix }}filesystem        # [win]
    - {{ posix }}make
    - {{ posix }}sed               # [win]
    - {{ posix }}coreutils         # [win]
    - {{ posix }}zip               # [win]
    - cross-r-base {{ r_base }}    # [build_platform != target_platform]
  host:
    - r-base
  run:
    - r-base

test:
  commands:
    - $R -e "library('geodist')"           # [not win]
    - "\"%R%\" -e \"library('geodist')\""  # [win]

about:
  home: https://github.com/hypertidy/geodist, https://hypertidy.github.io/geodist/
  license: MIT
  summary: Fast, Dependency-Free Geodesic Distance Calculations
  description: |
    Dependency-free, ultra fast calculation of geodesic distances. Includes the
    reference nanometre-accuracy geodesic distances of Karney (2013), as used by 
    the 'sf' package, as well as Haversine and Vincenty distances. Default distance 
    measure is the "Mapbox cheap ruler" which is generally more accurate than 
    Haversine or Vincenty for distances out to a few hundred kilometres, and is 
    considerably faster.
  license_family: MIT
  license_file:
    - {{ environ["PREFIX"] }}/lib/R/share/licenses/MIT

extra:
  recipe-maintainers:
    - conda-forge/r
