context:
  version: "0.6.1"

package:
  name: corrosion
  version: ${{ version }}

source:
  url: https://github.com/corrosion-rs/corrosion/archive/refs/tags/v${{ version }}.tar.gz
  sha256: e9e95b1ee2bad52681f347993fb1a5af5cce458c5ce8a2636c9e476e4babf8e3
  
  # Remove the patch if it becomes unnecessary after being handled upstream
  # Refer to https://github.com/corrosion-rs/corrosion/issues/663
  patches:
    - if: linux
      then: link-threads.patch

build:
  number: 0

requirements:
  build:
    - ${{ compiler("c") }}
    - ${{ compiler("cxx") }}
    - ${{ compiler("rust") }}
    - ${{ stdlib("c") }}
    - cmake
    - rust-src
    - if: unix
      then: make
    - if: win
      then: jom

tests:
  - package_contents:
      files:
        - if: unix
          then:
            - lib/cmake/Corrosion/CorrosionConfig.cmake
            - lib/cmake/Corrosion/CorrosionConfigVersion.cmake
            - share/cmake/Corrosion.cmake
            - share/cmake/CorrosionGenerator.cmake
            - share/cmake/FindRust.cmake
        - if: win
          then:
            - Library/lib/cmake/Corrosion/CorrosionConfig.cmake
            - Library/lib/cmake/Corrosion/CorrosionConfigVersion.cmake
            - Library/share/cmake/Corrosion.cmake
            - Library/share/cmake/CorrosionGenerator.cmake
            - Library/share/cmake/FindRust.cmake

about:
  homepage: https://corrosion-rs.github.io/corrosion
  repository: https://github.com/corrosion-rs/corrosion
  documentation: https://corrosion-rs.github.io/corrosion
  license: MIT
  license_file: LICENSE
  summary: "Marrying Rust and CMake - Easy Rust and C/C++ Integration!"
  description: |
    Corrosion, formerly known as cmake-cargo, is a tool for integrating Rust into an existing CMake
    project. Corrosion is capable of automatically importing executables, static libraries, and
    dynamic libraries from a Rust package or workspace as CMake targets.

    The imported static and dynamic library types can be linked into C/C++ CMake targets using the usual
    CMake functions such as [`target_link_libraries()`].
    For rust executables and dynamic libraries corrosion provides a `corrosion_link_libraries`
    helper function to conveniently add the necessary flags to link C/C++ libraries into
    the rust target.

extra:
  recipe-maintainers:
    - eunos-1128
