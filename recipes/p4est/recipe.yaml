context:
  version: "2.8.7"

package:
  name: p4est
  version: ${{ version }}

source:
  url: https://github.com/cburstedde/p4est/releases/download/v${{ version }}/p4est-${{ version }}.tar.gz
  sha256: 0A1E912F3529999CA6D62FEE335D51F24B5650B586E95A03EF39EBF73936D7F4

build:
  number: 0
  skip:
    - win
  script:
    - if: unix
      then:
        - cmake -B build $CMAKE_ARGS -DBUILD_SHARED_LIBS=ON -DP4EST_USE_SYSTEM_SC=ON -DP4EST_BUILD_EXAMPLES=OFF -DP4EST_BUILD_TESTING=ON
        - cmake --build build --parallel
        - cmake --install build
        - cd build; ctest --output-on-failure

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ stdlib('c') }}
    - cmake
    - make

  host:
    - if: unix
      then:
        - openmpi-mpicc
    - libsc
    - zlib
    
  run_exports:
    - ${{ pin_subpackage('p4est', upper_bound='x.x.x') }}

tests:
  - package_contents:
      lib:
        - p4est

about:
  homepage: https://www.p4est.org/
  summary: 'The "p4est" forest-of-octrees library'
  description: |
    `p4est` is a C library to manage a collection (a forest) of multiple
    connected adaptive quadtrees or octrees in parallel.
  license: LGPL-2.0-only
  license_family: LGPL
  license_file: COPYING
  repository: https://github.com/cburstedde/p4est

extra:
  recipe-maintainers:
    - claudiushaag
