{% set version = "25.0.2" %}

package:
  name: galaxy-meta
  version: {{ version }}

source:
  - url: https://pypi.org/packages/source/g/galaxy_tool_util/galaxy_tool_util-{{ version }}.tar.gz
    sha256: 06ea221c5cb96adb01e945b4754afbfcb3e02db90cd5eefff835bd553b899d71
    folder: galaxy-tool-util
  - url: https://pypi.org/packages/source/g/galaxy_util/galaxy_util-{{ version }}.tar.gz
    sha256: afc263c4b7ded222f1b84af9b9bbe708b982b98560593cf4602184b705b654c6
    folder: galaxy-util

build:
  number: 0
  noarch: python

requirements:
  host:
    - pip
    - python {{ python_min }}
    - setuptools
  run:
    - python >={{ python_min }}

test:
  requires:
    - python {{ python_min }}
  imports:
    - galaxy

outputs:
  - name: galaxy-tool-util
    build:
      script: {{ PYTHON }} -m pip install ./galaxy-tool-util/ --no-deps -vv
      entry_points:
        - galaxy-tool-test=galaxy.tool_util.verify.script:main
        - galaxy-tool-test-case-validation=galaxy.tool_util.parameters.scripts.validate_test_cases:main
        - galaxy-tool-upgrade-advisor=galaxy.tool_util.upgrade.script:main
        - validate-test-format=galaxy.tool_util.validate_test_format:main
        - mulled-build=galaxy.tool_util.deps.mulled.mulled_build:main
        - mulled-build-channel=galaxy.tool_util.deps.mulled.mulled_build_channel:main
        - mulled-search=galaxy.tool_util.deps.mulled.mulled_search:main
        - mulled-build-tool=galaxy.tool_util.deps.mulled.mulled_build_tool:main
        - mulled-build-files=galaxy.tool_util.deps.mulled.mulled_build_files:main
        - mulled-list=galaxy.tool_util.deps.mulled.mulled_list:main
        - mulled-update-singularity-containers=galaxy.tool_util.deps.mulled.mulled_update_singularity_containers:main
    requirements:
      host:
        - pip
        - python {{ python_min }}
        - setuptools
        # Depend on galaxy-util during build time to avoid packaging galaxy/__init__.py .
        - galaxy-util >={{ version }}
      run:
        - conda-package-streaming
        - galaxy-tool-util-models >={{ version }}
        - galaxy-util >={{ version }}
        - lxml
        - markupsafe
        - packaging
        - pydantic >=2
        - pyyaml
        - requests
        - sortedcontainers
        - typing_extensions
        - whoosh
    test:
      imports:
        - galaxy.tool_util
        - galaxy.tool_util.biotools
        - galaxy.tool_util.client
        - galaxy.tool_util.cwl
        - galaxy.tool_util.data
        - galaxy.tool_util.data.bundles
        - galaxy.tool_util.deps
        - galaxy.tool_util.deps.container_resolvers
        - galaxy.tool_util.deps.mulled
        - galaxy.tool_util.deps.resolvers
        - galaxy.tool_util.linters
        - galaxy.tool_util.locations
        - galaxy.tool_util.ontologies
        - galaxy.tool_util.parameters
        - galaxy.tool_util.parameters.scripts
        - galaxy.tool_util.parser
        - galaxy.tool_util.toolbox
        - galaxy.tool_util.toolbox.filters
        - galaxy.tool_util.toolbox.lineages
        - galaxy.tool_util.toolbox.views
        - galaxy.tool_util.unittest_utils
        - galaxy.tool_util.upgrade
        - galaxy.tool_util.verify
        - galaxy.tool_util.verify.asserts
      commands:
        - galaxy-tool-test --help
        - galaxy-tool-test-case-validation --help
        # - galaxy-tool-upgrade-advisor --help  # Can be restored after https://github.com/galaxyproject/galaxy/pull/19605
        - validate-test-format --help
        - mulled-build --help
        - mulled-build-channel --help
        - mulled-search --help
        - mulled-search -s bwa
        - mulled-build-tool --help
        - mulled-build-files --help
        - mulled-list --help
        - mulled-update-singularity-containers --help
    about:
      summary: Galaxy Tool and Tool Dependency Utilities

  - name: galaxy-util
    build:
      script: {{ PYTHON }} -m pip install ./galaxy-util/ --no-deps -vv
    requirements:
      run:
        - bleach
        - boltons
        - docutils
        - importlib_resources >=5.10.0
        - packaging
        - pyparsing
        - pyyaml
        - requests
        - routes
        - typing_extensions
        - zipstream-new
        # extras_require:
        #- dictobj
        - future >=1.0.0
        - cheetah3
      run_constrained:
        # Disallow installation of conflicting older package.
        - galaxy-lib <0a0
    test:
      imports:
        - galaxy.exceptions
        - galaxy.util
        - galaxy.util.custom_logging
        - galaxy.util.path
        - galaxy.util.tool_shed
    about:
      summary: Galaxy Generic Utilities

about:
  home: https://galaxyproject.org
  license: AFL-3.0
  license_file: LICENSE
  summary: Galaxy meta package
  doc_url: https://docs.galaxyproject.org
  dev_url: https://github.com/galaxyproject/galaxy

extra:
  recipe-maintainers:
    - bernt-matthias
    # - nsoranzo
    # - bgruening
  feedstock-name:
    - galaxy-meta
