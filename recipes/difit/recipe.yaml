context:
  name: difit
  version: "2.2.7"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/yoshiko-pg/${{ name }}/archive/refs/tags/v${{ version }}.tar.gz
  sha256: 552b6138e821a5240fa979149e8503313968dc029abc6b44f12a191c03c8ed17

build:
  script:
    - if: unix
      then:
        - set -ex
        - pnpm install --ignore-scripts
        - pnpm build
        - npm pkg delete scripts.prepare
        - npm pack --ignore-scripts
        - npm install --global ${SRC_DIR}/${PKG_NAME}-${PKG_VERSION}.tgz
        - pnpm-licenses generate-disclaimer --prod --output-file=third-party-licenses.txt
      else:
        - call pnpm install --ignore-scripts
        - if %ERRORLEVEL% neq 0 exit 1
        - call pnpm build
        - if %ERRORLEVEL% neq 0 exit 1
        - call npm pkg delete scripts.prepare
        - if %ERRORLEVEL% neq 0 exit 1
        - call npm pack --ignore-scripts
        - if %ERRORLEVEL% neq 0 exit 1
        - call npm install --global %SRC_DIR%/%PKG_NAME%-%PKG_VERSION%.tgz
        - if %ERRORLEVEL% neq 0 exit 1
        - call pnpm-licenses generate-disclaimer --prod --output-file=third-party-licenses.txt
        - if %ERRORLEVEL% neq 0 exit 1
  number: 0

requirements:
  build:
    - nodejs
    - pnpm
    - pnpm-licenses
  host:
    - nodejs
  run:
    - nodejs

tests:
  - script:
      - difit --help

about:
  homepage: https://github.com/yoshiko-pg/difit
  summary: A lightweight command-line tool that spins up a local web server to display Git commit diffs in a GitHub-like Files changed view
  description: |
    difit is a CLI tool that lets you view and review local git diffs with a GitHub-style viewer.
    In addition to clean visuals, comments can be copied as prompts for AI.
    The local code review tool for the AI era!
  license: MIT
  license_file:
    - LICENSE
    - third-party-licenses.txt
  documentation: https://github.com/yoshiko-pg/difit
  repository: https://github.com/yoshiko-pg/difit

extra:
  recipe-maintainers:
    - pavelzw
