{% set version = "1.4.0" %}
{% set posix = "m2-" if win else "" %}

package:
  name: r-palaeoverse
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/palaeoverse_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/palaeoverse/palaeoverse_{{ version }}.tar.gz
  sha256: efe8ac4ca8ff8ad992a2e7fa6e5ee422d3a0814b8c8e08be7dda124131c54dc4

build:
  number: 0
  noarch: generic
  rpaths:
    - lib/R/lib/
    - lib/
  missing_dso_whitelist:
    - "*/R.dll"        # [win]
    - "*/Rblas.dll"    # [win]
    - "*/Rlapack.dll"  # [win]

requirements:
  build:
    - {{ posix }}zip               # [win]
    - cross-r-base {{ r_base }}    # [build_platform != target_platform]
  host:
    - r-base
    - r-ape
    - r-curl
    - r-geosphere
    - r-h3jsr >=1.3.0
    - r-httr
    - r-lifecycle
    - r-pbapply
    - r-sf
    - r-stringdist
  run:
    - r-base
    - r-ape
    - r-curl
    - r-geosphere
    - r-h3jsr >=1.3.0
    - r-httr
    - r-lifecycle
    - r-pbapply
    - r-sf
    - r-stringdist

test:
  requires:
    - r-testthat
  source_files:
    - tests/
  commands:
    - $R -e "library('palaeoverse')"  # [not win]
    - $R -e "testthat::test_file('tests/testthat.R', stop_on_failure=TRUE)"  # [not win]
    - "\"%R%\" -e \"library('palaeoverse')\""  # [win]
    - "\"%R%\" -e \"testthat::test_file('tests/testthat.R', stop_on_failure=TRUE)\""  # [win]

about:
  home: https://palaeoverse.palaeoverse.org, https://palaeoverse.org
  license: GPL-3.0-or-later
  summary: R package developed by palaeobiologists, for palaeobiologists
  description: |
    Provides functionality to support data preparation and exploration for palaeobiological
    analyses, improving code reproducibility and accessibility. The wider aim of "palaeoverse"
    is to bring the palaeobiological community together to establish agreed standards.
    The package currently includes functionality for data cleaning, binning (time and
    space), exploration, summarisation and visualisation. Reference datasets (i.e. Geological
    Time Scales <https://stratigraphy.org/chart>) and auxiliary functions are also provided.
    Details can be found in: Jones et al., (2023) <doi: 10.1111/2041-210X.14099>.
  license_family: GPL3
  license_file:
    - '{{ environ["PREFIX"] }}/lib/R/share/licenses/GPL-3'
  dev_url: https://github.com/palaeoverse/palaeoverse
  doc_url: https://palaeoverse.palaeoverse.org/

extra:
  recipe-maintainers:
    - conda-forge/r
    - willgearty
