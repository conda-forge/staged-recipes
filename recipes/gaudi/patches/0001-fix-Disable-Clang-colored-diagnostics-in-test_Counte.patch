From 3d5bfbc2d38b39b72773fec4e360ba9f9d7a427a Mon Sep 17 00:00:00 2001
From: Chris Burr <christopher.burr@cern.ch>
Date: Sun, 18 Jan 2026 21:13:02 +0100
Subject: [PATCH] fix: Disable Clang colored diagnostics in
 test_CounterHistoFail

Use -fno-color-diagnostics compile flag to prevent ANSI escape codes
from breaking the regex match on macOS/Clang.
---
 GaudiKernel/CMakeLists.txt | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/GaudiKernel/CMakeLists.txt b/GaudiKernel/CMakeLists.txt
index b24c36cab..70c3cd5c9 100644
--- a/GaudiKernel/CMakeLists.txt
+++ b/GaudiKernel/CMakeLists.txt
@@ -387,12 +387,12 @@ if(BUILD_TESTING)
     ${CMAKE_CURRENT_SOURCE_DIR}/include
     ${PROJECT_SOURCE_DIR}/GaudiPluginService/include
   )
+  # Disable colored diagnostics to avoid ANSI escape codes breaking regex match
+  target_compile_options(test_CounterHistoFail PRIVATE -fno-color-diagnostics)
   set_target_properties(test_CounterHistoFail PROPERTIES EXCLUDE_FROM_ALL TRUE EXCLUDE_FROM_DEFAULT_BUILD TRUE)
   add_test(NAME GaudiKernel.test_CounterHistoFail COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR} --target test_CounterHistoFail)
   set_property(TEST GaudiKernel.test_CounterHistoFail PROPERTY PASS_REGULAR_EXPRESSION "\\+\\+h2d\\[1\\.2\\]\; // ERROR: cannot fill a 2D histogram with a single index")
   set_property(TEST GaudiKernel.test_CounterHistoFail PROPERTY RESOURCE_LOCK build-system)
-  # Disable GCC colored diagnostics to avoid ANSI escape codes in output breaking the regex match
-  set_property(TEST GaudiKernel.test_CounterHistoFail PROPERTY ENVIRONMENT "GCC_COLORS=")
 
   gaudi_add_executable(GaudiKernel_catch2_tests
     SOURCES
-- 
2.48.1

