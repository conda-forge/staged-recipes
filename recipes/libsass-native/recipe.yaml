context:
  name: libsass
  version: "3.6.6"

package:
  name: libsass-native
  version: ${{ version }}

source:
  url: https://github.com/sass/${{ name }}/archive/refs/tags/${{ version }}.tar.gz
  sha256: 11f0bb3709a4f20285507419d7618f3877a425c0131ea8df40fe6196129df15d

build:
  number: 0
  script:
    - if: unix
      then:
        - autoreconf --force --install
        - ./configure --prefix=$PREFIX --disable-tests --enable-shared --enable-static
        - make -j${CPU_COUNT}
        - make install
    - if: win
      then:
        - msbuild win\libsass.sln /p:Configuration=Release /p:Platform=Win64
        - if not exist %LIBRARY_BIN% mkdir %LIBRARY_BIN%
        - if not exist %LIBRARY_LIB% mkdir %LIBRARY_LIB%
        - if not exist %LIBRARY_INC%\sass mkdir %LIBRARY_INC%\sass
        - copy win\bin\libsass.dll %LIBRARY_BIN%\
        - copy win\bin\libsass.lib %LIBRARY_LIB%\
        - copy include\*.h %LIBRARY_INC%\
        - copy include\sass\*.h %LIBRARY_INC%\sass\
        - if not exist %LIBRARY_PREFIX%\win mkdir %LIBRARY_PREFIX%\win
        - copy win\libsass.targets %LIBRARY_PREFIX%\win\

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - if: unix
      then:
        - autoconf
        - automake
        - libtool
        - make

tests:
  - package_contents:
      files:
        - if: unix
          then:
            - lib/libsass.a
            - include/sass.h
            - include/sass/base.h
        - if: win
          then:
            - Library/bin/libsass.dll
            - Library/include/sass.h
            - Library/include/sass/base.h
      lib:
        - libsass

about:
  homepage: https://sass-lang.com/libsass
  summary: 'A C/C++ implementation of a Sass compiler'
  description: |
    LibSass is a C++ port of the original Ruby Sass CSS compiler with a C API.
    We coded LibSass with portability and efficiency in mind. You can expect
    LibSass to be a lot faster than Ruby Sass and on par or faster than the best
    alternative CSS compilers around.
  license: MIT
  license_file: LICENSE
  documentation: https://sass-lang.com/libsass
  repository: https://github.com/sass/libsass

extra:
  recipe-maintainers:
    - danyeaw
