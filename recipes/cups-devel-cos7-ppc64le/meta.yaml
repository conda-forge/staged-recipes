# A few variables that make this a tiny bit more portable
{% set centos_name = "cups" %}
{% set name = centos_name |lower %}
{% set version = '1.6.3' %}
{% set centos_build = '40' %}
# No good way to get this other than to fail once, I think???
{% set so_version = '2' %}
{% set el = 'el7' %}
{% set arch = "ppc64le" %}
{% set cos = "cos7" %}
{% set url_base = "http://mirror.centos.org/altarch/7/os/" + arch + "/Packages/" %}

package:
  name: {{ name }}-{{ cos }}-{{ arch }}
  version: {{ version }}

source:
  - url: {{ url_base }}{{ centos_name }}-devel-{{ version }}-{{ centos_build }}.{{ el }}.{{ arch }}.rpm
    sha256: 56e31e9d26f7fb7486d69f8e755c2b40bd49869797afacbd71929dfa598a9671
    folder: devel
  - url: {{ url_base }}{{ centos_name }}-libs-{{ version }}-{{ centos_build }}.{{ el }}.{{ arch }}.rpm
    sha256: 88b70b811b29c049483c55956a1365a0c57c989f49253470b28fe5abfeca97d6
    folder: libs/usr

build:
  number: 0
  noarch: generic
  missing_dso_whitelist:
    - '*'

test:
  # dummy requirement to workaround a bug with the CDT tests
  requires:
    - zlib
  commands:
    - test -f "$PREFIX/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot/usr/lib/cups/daemon/cups-deviced"

outputs:
  - name: {{ name }}-devel-{{ cos }}-{{ arch }}
    build:
      noarch: generic
      script:
        - mkdir -p {{ PREFIX }}/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot
        - pushd {{ PREFIX }}/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot > /dev/null 2>&1
        - cp -Rf {{ SRC_DIR }}/devel/* .
    requirements:
      - {{ pin_subpackage(name + '-libs-' + cos + '-' + arch, exact=True) }}
    test:
      # dummy requirement to workaround a bug with the CDT tests
      requires:
        - zlib
      commands:
        - test -f "$PREFIX/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot/usr/lib64/lib{{ centos_name }}.so"

  - name: {{ name }}-libs-{{ cos }}-{{ arch }}
    build:
      noarch: generic
      script:
        - mkdir -p {{ PREFIX }}/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot
        - pushd {{ PREFIX }}/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot > /dev/null 2>&1
        - cp -Rf {{ SRC_DIR }}/libs/* .
      missing_dso_whitelist:
        - '*'
    test:
      # dummy requirement to workaround a bug with the CDT tests
      requires:
        - zlib
      commands:
        - test -f "$PREFIX/{{ arch }}-conda_{{ cos }}-linux-gnu/sysroot/usr/lib64/lib{{ centos_name }}.so.{{ so_version }}"

about:
  home: https://dri.sourceforge.net
  license: MIT
  license_family: MIT
  summary: "(CDT) Direct Rendering Manager runtime library"
  description: Direct Rendering Manager runtime library

extra:
  recipe-maintainers:
    - hmaarrfk

