{% set name = "p4api" %}
{% set long_version = "2019.1.1796703" %}
{% set version = "19.1" %}

package:
  name: "{{ name|lower }}"
  version: "{{ long_version }}"

source:
  url: https://swarm.workshop.perforce.com/projects/perforce_software-p4/archives/2018-2.zip
  sha256: 78eedf8386b7ed9791d49be66256cc50f8f212662a7706f7d161883151038987

build:
  number: 0
  script:
    - echo "using gcc-conda : 7.3 : ${CC} ; " >> user-config.jam   # [linux]
    - jam -sPRODUCTION=1 -sSSLINCDIR=$PREFIX/include -sSSLLIBDIR=$PREFIX/lib -sSMARTHEAP=0 -sOSVER=26  -sC++=$CXX -sg++=$CXX -sCc=$CC -sCC=$CC p4api.tar  # [linux]
    - jam -sPRODUCTION=1 -sSSLINCDIR=$PREFIX/include -sSSLLIBDIR=$PREFIX/lib -sSMARTHEAP=0 -sOSVER=106 -sC++=$CXX -sg++=$CXX -sCc=$CC -sCC=$CC p4api.tar  # [osx]
  skip: True  # [not linux]

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - jam
  host:
    - openssl
  run:
    - openssl

test:
  commands:
    - test -f ${PREFIX}/lib/libclient.a            # [unix]
    - test -f ${PREFIX}/lib/libp4script.a          # [unix]
    - test -f ${PREFIX}/lib/libp4script_c.a        # [unix]
    - test -f ${PREFIX}/lib/librpc.a               # [unix]
    - if not exist %LIBRARY_LIB%\libclient.a       # [win]
    - if not exist %LIBRARY_LIB%\libp4script.a     # [win]
    - if not exist %LIBRARY_LIB%\libp4script_c.a   # [win]
    - if not exist %LIBRARY_LIB%\librpc.a          # [win]

about:
  home: http://www.perforce.com
  license: BSD-2-Clause
  license_family: BSD
  license_file: LICENSE.txt
  summary: 'Perforce API'
  doc_url: https://www.perforce.com/manuals/p4api/Content/P4API/Home-p4api.html

extra:
  recipe-maintainers:
    - marcelotrevisani
