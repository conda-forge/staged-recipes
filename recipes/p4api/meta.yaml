{% set name = "p4api" %}
{% set long_version = "2019.1.1796703" %}
{% set version = "19.1" %}

package:
  name: "{{ name|lower }}"
  version: "{{ long_version }}"

source:
  url: https://swarm.workshop.perforce.com/projects/perforce_software-p4/archives/2018-2.zip
  sha256: ac96eb9be81e92d33675f5077e17619b9e3d1979a1b4e86842bc4f28e0e7f1a0

build:
  number: 0
  script:
    - jam -sSSLINCDIR=$PREFIX/include -sSSLLIBDIR=$PREFIX/lib -sSMARTHEAP=0 -sOSVER=26 p4  # [linux]
    - jam -sSSLINCDIR=$PREFIX/include -sSSLLIBDIR=$PREFIX/lib -sSMARTHEAP=0 -sOSVER=106 p4  # [osx]
    - jam -sPRODUCTION=1 p4api.tar
  skip: True  # [win]

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - jam
  host:
    - openssl
  run:
    - openssl

test:
  commands:
    - test -f ${PREFIX}/lib/libclient.a            # [unix]
    - test -f ${PREFIX}/lib/libp4script.a          # [unix]
    - test -f ${PREFIX}/lib/libp4script_c.a        # [unix]
    - test -f ${PREFIX}/lib/librpc.a               # [unix]
    - if not exist %LIBRARY_LIB%\libclient.a       # [win]
    - if not exist %LIBRARY_LIB%\libp4script.a     # [win]
    - if not exist %LIBRARY_LIB%\libp4script_c.a   # [win]
    - if not exist %LIBRARY_LIB%\librpc.a          # [win]

about:
  home: http://www.perforce.com
  license: BSD-2-Clause
  license_family: BSD
  license_file: LICENSE.txt
  summary: Perforce API
  doc_url: https://www.perforce.com/manuals/p4api/Content/P4API/Home-p4api.html

extra:
  recipe-maintainers:
    - marcelotrevisani
