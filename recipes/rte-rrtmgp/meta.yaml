{% set name = "rte_rrtmgp" %}
{% set version = "cmake.dev" %}


package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  # TODO: Set `makepath-cmake` to {{ version }} when we have real version
  url: https://github.com/earth-system-radiation/rte-rrtmgp/archive/refs/heads/makepath-cmake.zip
  sha256: c79a6d076c8061d36dc63770a540d05423633c975b07a3ad95fc824099e6992f

build:
  number: 0

requirements:
  build:
    # General
    - cmake                                  # CMake to configure the project
    - ninja                                  # Ninja to run the build
    - python                                 # Required for testing Python
    - conda-forge::netcdf-fortran >=4.5,<5.0 # Required for testing Fortran NetCDF library
    - netcdf4                                # Required for testing
    - xarray                                 # Required for testing
    - dask                                   # Required for testing
    - numpy                                  # Required for testing
    - matplotlib                             # Required for testing
    - colorcet                               # Required for testing
    # Uinx
    - {{ stdlib("c") }}                      # [unix]
    - {{ compiler('fortran') }}              # [unix]
    # Win
    - {{ stdlib('m2w64_c') }}                # [win]
    - {{ compiler('m2w64_fortran') }}        # [win]
  host:
    # General
    - cmake                                  # CMake to configure the project
    - python                                 # Python required for running tests
    - conda-forge::netcdf-fortran >=4.5,<5.0 # Required runtime for testing
    # Unix
    - {{ compiler('fortran') }}              # [unix]
    # Win
    - {{ compiler('m2w64_fortran') }}        # [win]
  run:
    # General
    - python

test:
  commands:
    # Check if the files exists
    # Unix
    - test -f $PREFIX/lib/librrtmgp.a           # [unix]
    - test -f $PREFIX/lib/librrtmgpkernels.a    # [unix]
    - test -f $PREFIX/lib/librte.a              # [unix]
    - test -f $PREFIX/lib/librtekernels.a       # [unix]
    # Win
    - test -f $PREFIX/lib/librrtmgp.lib         # [win]
    - test -f $PREFIX/lib/librrtmgpkernels.lib  # [win]
    - test -f $PREFIX/lib/librte.lib            # [win]
    - test -f $PREFIX/lib/librtekernels.lib     # [win]

outputs:
  - name: rte_rrtmgp
    files:
      # Unix
      - lib/librrtmgp.a           # [unix]
      - lib/librrtmgpkernels.a    # [unix]
      - lib/librte.a              # [unix]
      - lib/librtekernels.a       # [unix]
      # Win
      - lib/librrtmgp.lib         # [win]
      - lib/librrtmgpkernels.lib  # [win]
      - lib/librte.lib            # [win]
      - lib/librtekernels.lib     # [win]

about:
  home: https://github.com/earth-system-radiation/rte-rrtmgp
  summary: Fortran codes for computing radiative fluxes in planetary atmospheres.
  license: BSD-3-Clause
  license_family: BSD
  license_file: LICENSE.txt
  doc_url: https://earth-system-radiation.github.io/rte-rrtmgp/how-tos/

extra:
  recipe-maintainers:
    - RobertPincus
    - makepath-alex
