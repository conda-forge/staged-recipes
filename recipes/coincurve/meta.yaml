{% set name = "coincurve" %}
{% set version = "18.0.0" %}

package:
  name: {{ name }}-bundle
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: c86626afe417a09d8e80e56780efcae3ae516203b23b5ade84813916e1c94fc1
  patches:
    - update_pyproject.toml.patch
    - update_setup.py.patch
    - update_setup_support.py.patch
    - update_build.py.patch
    - update_MANIFEST.in.patch

build:
  number: 0
  missing_dso_whitelist:
    - "*/libc.so.6"

outputs:
  - name: {{ name }}
    script: build-pkg.sh  # [unix]
    script: bld-pkg.bat  # [win]
    build:
      run_exports:
        strong:
          - {{ pin_subpackage(name, max_pin="x.x") }}
      ignore_run_exports:
        - libsecp256k1-static
        - cffi
        - python
    requirements:
      build:
        - build >=0.10
        - pip
        - python
      host:
        - {{ compiler('c') }}
        - {{ pin_compatible('libsecp256k1-static') }}
        - cffi >=1.3.0
        - python
      run:
        - asn1crypto
        - cffi >=1.3.0
        - python

    test:
      imports:
        - {{ pin_compatible(name) }}
      files:
        - tests
      requires:
        - pip
        - pytest
        - pytest-benchmark
      commands:
        - pip check
        - pytest -v tests

#  - name: {{ name }}-shared
#    script: build-pkg.sh  # [unix]
#    script: bld-pkg.bat  # [win]
#    build:
#      run_exports:
#        strong:
#          - {{ pin_subpackage(name + "-shared", max_pin="x.x") }}
#      ignore_run_exports:
#        - libsecp256k1
#        - cffi
#        - python
#
#    requirements:
#      build:
#        - build >=0.10
#        - python >3.11
#        - cffi >=1.3.0
#        - python
#        - pip
#      host:
#        - {{ compiler('c') }}
#        - asn1crypto
#        - python
#        - cffi >=1.3.0
#        - {{ pin_compatible('libsecp256k1') }}
#      run:
#        - asn1crypto
#        - cffi >=1.3.0
#        - python
#        - {{ pin_compatible('libsecp256k1') }}
#
#    test:
#      imports:
#        - {{ name }}
#      files:
#        - tests
#      requires:
#        - pip
#        - pytest
#        - pytest-benchmark
#      commands:
#        - pip check
#        - pytest -v tests

about:
  home: https://github.com/ofek/coincurve
  summary: Cross-platform Python CFFI bindings for libsecp256k1
  doc_url: https://ofek.dev/coincurve/
  description: |
    This library provides well-tested Python bindings for libsecp256k1, 
    the heavily optimized C library used by Bitcoin Core for operations 
    on the elliptic curve secp256k1.
  license: MIT
  license_file:
    - LICENSE-MIT
    - LICENSE-APACHE

extra:
  recipe-maintainers:
    - https://github.com/ofek
    - https://gihub.com/MementoRC
