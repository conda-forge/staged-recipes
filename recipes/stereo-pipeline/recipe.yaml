context:
  name: stereo-pipeline
  version: "3.5.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
    # Main source code
    - url: https://github.com/NeoGeographyToolkit/StereoPipeline/archive/refs/tags/{{ version }}.zip
      sha256: 3cfd7675848d43770de1ec12dfddbd6cb6c4029314f3251736e0fe77321904d3
      target_directory: src
    
    # Submodules
    
    - url: https://github.com/NeoGeographyToolkit/StereoPipeline/releases/download/geoid1.0/geoids.tgz
      sha256: 2cffdac6efbfa47a94e8adb650489a267de72770f06656df35f37a531d999f5d
      target_directory: geoids
    
    - url: https://github.com/NeoGeographyToolkit/libnabo/archive/refs/tags/3.5.0.zip
      sha256: 4b260a5ff3fc6fff56ff500d2b14c1cc4136ac58a3ed306e78dee8769261ae3c
      target_directory: libnabo

build:
  number: 0
  skip: win
  script: build.sh

requirements:
  build:
    - ${{ compiler("c") }}
    - ${{ compiler("cxx") }}
    - ${{ compiler("fortran") }}
    - ${{ stdlib("c") }}
    - cmake >=3.15
    - make
  host:
    - flann
    - libboost-devel
    - libgdal
    - libblas * *openblas
    - libopencv
    - libjpeg-turbo
    - libpng
    - libtiff
    - visionworkbench

tests:
  - script:
    # Test loading a camera and doing image-to-ground and ground-to-image operations
    # This is disabled till the recipe is complete
    - echo 0
    # - cam_test --image $PREFIX/share/tests/ctx.json --cam1 $PREFIX/share/tests/ctx.json --cam2 $PREFIX/share/tests/ctx.json

about:
  homepage: https://github.com/NeoGeographyToolkit/StereoPipeline
  summary: 'A suite of tools for producing terrain models published by NASA'
  description: |
    The NASA Ames Stereo Pipeline is a collection of tools for producing 3D terrain models from images acquired by satellites of planets and of Earth. It also supports alignment of terrains, correction of errors in camera positions and orientations, and structure from motion.
  license: Apache-2.0
  license_family: Apache
  license_file: COPYING
  documentation: https://stereopipeline.readthedocs.io/en/latest/index.html
  repository: https://github.com/NeoGeographyToolkit/StereoPipeline

extra:
  recipe-maintainers:
    - oleg-alexandrov
