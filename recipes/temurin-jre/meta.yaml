{% set version = "17.0.14+7" %}
{% set version_base = version.split('+')[0] %} 
{% set version_major = version_base.split('.')[0] %}
{% set version_minor = version_base.split('.')[1] %}
{% set build_number = version.split('+')[1] %}
{% set base_url = 'https://github.com/adoptium/temurin' + version_major + '-binaries/releases/download/jdk-' + version_base + '%2B' + build_number + '/OpenJDK' + version_major + 'U-jre_' %}
{% set end_url = "_hotspot_" + version.replace('+', '_') %}
{% set name = "temurin-jre" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url:    "{{ base_url }}aarch64_linux{{ end_url }}.tar.gz"                   # [linux and aarch64]
    sha256: "bab3f352fc7144ac1435924f056872d16f4b32c8bcda58b9a77b636eb1c664f4"  # [linux and aarch64]
  - url:    "{{ base_url }}aarch64_mac{{ end_url }}.tar.gz"                     # [osx and aarch64]
    sha256: "6921193269a32c394fd6d8bb6583e3798810c2b24f122b56ebe85bafd94fc784"  # [osx and aarch64]
  - url:    "{{ base_url }}ppc64le_linux{{ end_url }}.tar.gz"                   # [linux and ppc64le]
    sha256: "2a730e9d34cce4d588739b626a034ed68c065a2db61048ee7886be48ec9fe460"  # [linux and ppc64le]
  - url:    "{{ base_url }}x64_linux{{ end_url }}.tar.gz"                       # [linux and x86_64]
    sha256: "a4b0015872758aac6a5d17139e952a3951ee536ae6d9a99828823a80a71add56"  # [linux and x86_64]
  - url:    "{{ base_url }}x64_mac{{ end_url }}.tar.gz"                         # [osx and x86_64]
    sha256: "f2c7454f7aba076cd414887b31da92e4a50fda7a13d97f6e295c911af60de0b6"  # [osx and x86_64]
  - url:    "{{ base_url }}x64_windows{{ end_url }}.zip"                        # [win64]
    sha256: "d42f84605c8e27c38998b44ac493d1067abbe45be89969c935d71a858393405c"  # [win64]
  - url:    "{{ base_url }}x86-32_windows{{ end_url }}.zip"                     # [win32]
    sha256: "b4c418fd053fd85decacb124c9e84c94fee3bbec3999451132227d4bb6fd82cb"  # [win32]

build:
  number: 0
  ignore_run_exports:
    - sysroot_linux-64
  missing_dso_whitelist:
    - "*/*freetype.*"        # freetype
    - "*/libc.*"             # glibc/libc6
    - "*/libdl.*"            # glibc/libc6
    - "*/libm.*"             # glibc/libc6
    - "*/libpthread.*"       # glibc/libc6
    - "*/librt.*"            # glibc/libc6
    - "*/ld-linux-x86-64.*"  # glibc/libc6
    - "*/libutil.*"          # glibc/libc6
    - "*/libX11.*"           # xorg-libx11
    - "*/libXext.*"          # xorg-libxext
    - "*/libasound.*"        # alsa-lib
    - "*/libXi.*"            # xorg-libxi
    - "*/libXrender.*"       # xorg-libxrender
    - "*/libXtst.*"          # xorg-libxtst
    - "*/jvm.dll"            # [win]
    - "*/java.dll"           # [win]
    - "*/VCRUNTIME140.dll"   # [win]
    - "*/VCRUNTIME140_1.dll" # [win]
    - "*/MSVCP140.dll"       # [win]
    - "*/jli.dll"            # [win]
    - "*/awt.dll"            # [win]
    - "*/net.dll"            # [win]
    - "*/jawt.dll"           # [win]
  rpaths:
    - opt/temurin/lib/server
    - opt/temurin/lib
    - opt/temurin/bin

outputs:
  - name: {{ name|lower }}
    requirements:
      build:                 # [win]
        - symlink-exe-build  # [win]
        - m2-bash            # [win]
        - {{ stdlib('c') }}  # [win]
      run:
        - {{ stdlib('c') }}
        - freetype
    test:
      commands:
        - java -version
        - '%JAVA_HOME%\bin\java.exe -version'   # [win]
        - '$JAVA_HOME/bin/java -version'        # [unix]
  - name: {{ name|lower }}-headless
    requirements:
      run:
        - {{ pin_subpackage(name|lower, exact=True) }}
    test:
      commands:
        - java -version
        - '%JAVA_HOME%\bin\java.exe -version'   # [win]
        - '$JAVA_HOME/bin/java -version'        # [unix]
  - name: {{ name|lower }}-graphics
    build:
      script: bash $RECIPE_DIR/build_graphics.sh                    # [unix]
      script: echo "no x11-related libraries on windows"            # [win]
      number: 0
      ignore_run_exports:
        - sysroot_linux-64
      missing_dso_whitelist:
        - "*/libfreetype.*"      # freetype
        - "*/libc.*"             # glibc/libc6
        - "*/libdl.*"            # glibc/libc6
        - "*/libm.*"             # glibc/libc6
        - "*/libpthread.*"       # glibc/libc6
        - "*/librt.*"            # glibc/libc6
        - "*/ld-linux-x86-64.*"  # glibc/libc6
        - "*/libutil.*"          # glibc/libc6
        - "*/libX11.*"           # xorg-libx11
        - "*/libXext.*"          # xorg-libxext
        - "*/libasound.*"        # alsa-lib
        - "*/libXi.*"            # xorg-libxi
        - "*/libXrender.*"       # xorg-libxrender
        - "*/libXtst.*"          # xorg-libxtst
        - "*/temurin/lib/server/*"
        - "*/temurin/lib/*"
        - "*/temurin/bin/*"
      rpaths:
        - opt/temurin/lib/server
        - opt/temurin/lib
        - opt/temurin/bin
    requirements:
      run:
        - {{ pin_subpackage(name|lower, exact=True) }}
        - xorg-libx11                           # [unix]   
        - xorg-libxext                          # [unix]   
        - xorg-libxt                            # [unix]  
        - xorg-libxtst                          # [unix]   
        - xorg-libxrender                       # [unix]   
        - xorg-libxi                            # [unix]               
        - alsa-lib                              # [linux]
    test:
      commands:
        - java -version
        - '%JAVA_HOME%\bin\java.exe -version'   # [win]
        - '$JAVA_HOME/bin/java -version'        # [unix]

about:
  home: https://adoptium.net/temurin/
  license: GPL-2.0 WITH Classpath-exception-2.0
  license_family: GPL
  license_file: NOTICE
  summary: Eclipse Temurin OpenJDK-based Java Runtime Environment
  description: |
    The Eclipse Temurin project provides code and processes that support the
    building of runtime binaries and associated technologies that are high 
    performance, enterprise-caliber, cross-platform, open-source licensed, 
    and Java SE TCK-tested for general use across the Java ecosystem.

extra:
  recipe-maintainers:
    - jfouret
