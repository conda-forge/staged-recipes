{% set gfortran_version = [8, 2, 0] %}
{% set libgfortran_version = [5, 0, 0] %}
{% set chost = "x86_64-apple-darwin" %}

package:
  name: gfortran_{{ target_platform }}
  version: {{ gfortran_version|join('.') }}

build:
  number: 0
  skip: True                                                  # [not osx]
  binary_has_prefix_files:
    - lib/libgcc_ext.10.*.dylib

  always_include_files:

    - bin/gfortran
    - bin/{{ chost }}-gfortran

    - libexec/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/collect2
    - libexec/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/f951
    - libexec/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/lto-wrapper

    - lib/libgfortran.spec

    # For -fopenmp:
    - lib/libgomp.spec

    # For -ffast-math
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/crtfastmath.o

    # For -static:
    - lib/libgfortran.a
    - lib/libgomp.a

    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/libgcc.a
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/libgcc_eh.a

    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/finclude/**

    # include{,-fixed} may not be needed unless -fopenmp is passed (not sure on that):
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/include-fixed/**
    - lib/gcc/{{ chost }}/{{ gfortran_version|join('.') }}/include/**

    # Stub libraries:
    - lib/libgcc_ext.10.4.dylib
    - lib/libgcc_ext.10.5.dylib

  run_exports:
    strong:
      - libgfortran >={{ libgfortran_version|join('.') }}

requirements:
  build:
    - gfortran_build_{{ target_platform }} ={{ gfortran_version|join('.') }}
  run:
    - libgfortran >={{ libgfortran_version|join('.') }}
    - isl =0.18
    - mpfr =4
    - mpc =1.1
    - gmp =6

test:
  files:
    - hello.f90
    - maths.f90
  commands:
    - gfortran --help

about:
  home: http://gcc.gnu.org/
  summary: Fortran compilers from the GNU Compiler Collection
  license: GPL 3 (with GCC Runtime Library Exception 3.1)

extra:
  recipe-maintainers:
    - beckermr
