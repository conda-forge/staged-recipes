# Copyright (c) Meta Platforms, Inc. and affiliates.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.

# Conda-forge recipe for MCGrad
#
# NOTE: This file is a template for initial conda-forge submission.
# After the package is accepted, the source of truth becomes:
#   https://github.com/conda-forge/mcgrad-feedstock
#
# The conda-forge bot automatically updates version and SHA256 when new
# versions are published to PyPI. You do not need to update this file.

{% set name = "mcgrad" %}
{% set version = "0.1.1" %}
{% set python_min = "3.10" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/mcgrad-{{ version }}.tar.gz
  sha256: cde74ba5285dd834e109affd184b9d72cf4fee84fd26bac3c5347f5b69a1e5ab

build:
  noarch: python
  script: {{ PYTHON }} -m pip install . -vv
  number: 0

requirements:
  host:
    - python {{ python_min }}
    - pip
    - setuptools >=64
    - setuptools-scm >=8
  run:
    - python >={{ python_min }}
    - numpy >=1.20.0
    - pandas >=1.3.0
    - scipy >=1.7.0
    - scikit-learn >=1.0.0
    - pytorch >=1.9.0
    - lightgbm >=3.0.0
    - plotly >=5.0.0
    - pyarrow >=10.0.0
    - cffi >=1.15.0
    - ax-platform >=1.2.1
    - psutil >=7.1.0

test:
  imports:
    - mcgrad
    - mcgrad.base
    - mcgrad.methods
    - mcgrad.metrics
    - mcgrad.plotting
    - mcgrad.tuning
  commands:
    - pip check
  requires:
    - python {{ python_min }}
    - pip

about:
  home: https://mcgrad.dev
  summary: Production-ready multicalibration for machine learning
  description: |
    MCGrad is a scalable and easy-to-use tool for multicalibration. It ensures
    ML model predictions are well-calibrated not just globally (across all data),
    but also across virtually any segment defined by your features (e.g., by
    country, content type, or any combination). MCGrad has been deployed at Meta
    on hundreds of production models.

    Key features:
    - State-of-the-art multicalibration quality across vast numbers of segments
    - Easy-to-use interface - pass features, not segments
    - Highly scalable - fast training and low inference overhead
    - Safe by design with likelihood-improving updates and validation-based early stopping
  license: MIT
  license_family: MIT
  license_file: LICENSE
  doc_url: https://mcgrad.readthedocs.io
  dev_url: https://github.com/facebookincubator/MCGrad

extra:
  recipe-maintainers:
    - TaXxER
    - danielha1
    - Lorenzo-Perini
    - flinder
