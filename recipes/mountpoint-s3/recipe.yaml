context:
  name: mountpoint-s3
  version: "1.21.0"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/awslabs/mountpoint-s3/archive/refs/tags/mountpoint-s3-${{ version }}.tar.gz
  sha256: 18891bf29e20cfdab76f0deda0f51526e2a14369e061688f8fb72b3263a44047

build:
  number: 0
  skip:
    - win
  script:
    env:
      CARGO_PROFILE_RELEASE_STRIP: symbols
      CARGO_PROFILE_RELEASE_LTO: fat
      LIBCLANG_PATH: ${{ PREFIX }}/lib
    content: |
      cargo install --locked --no-track --root "${PREFIX}" --path .
      cargo-bundle-licenses --format yaml --output THIRDPARTY.yml


requirements:
  build:
    - ${{ compiler('rust') }}
    - ${{ stdlib('c') }}
    - cargo-bundle-licenses
    - clangdev
    - cmake
    - pkg-config

  host:
    - libclang
    - libfuse3

  run:
    - python

tests:
  - script:
      - mount-s3 --help

about:
  homepage: https://github.com/awslabs/mountpoint-s3
  summary: 'A simple, high-throughput file client for mounting an Amazon S3 bucket as a local file system.'
  license: Apache-2.0
  license_file: LICENSE

extra:
  recipe-maintainers:
    - dhirschfeld
