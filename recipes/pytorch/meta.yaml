{% set version = "1.0rc1" %}

package:
  name: pytorch
  version: "{{ version }}"

source:
   git_url: https://github.com/pytorch/pytorch
   git_rev: "v{{ version }}"

build:
  number: 0
  detect_binary_files_with_prefix: False
  string: py{{ python }}_cudatoolkit{{ cudatoolkit }}
  skip: True  # [win]
  skip: True  # [osx]

requirements:
  build:
    - cmake
    - {{ compiler('c') }}  # [win]

  host:
    - python
    - numpy 1.11.*
    - setuptools
    - pyyaml
    - cffi
    - mkl >=2018
    - mkl-include
    - typing
    - ninja
    - cudatoolkit {{ cudatoolkit }}
    # magma-cuda is not available on conda-forge at the moment.
    # - {{ magma_cuda }}  # [linux]

  run:
    - python
    - numpy >=1.11
    - mkl >=2018
    - cffi
    - cudatoolkit

test:
 imports:
    - torch
 source_files:
   - test
 commands:
   - OMP_NUM_THREADS=4 python ./test/run_test.py || true  # [not win]
   - python ./test/run_test.py  # [win]

about:
  home: http://pytorch.org/
  license: BSD 3-Clause
  license_family: BSD
  license_file: LICENSE
  summary: PyTorch is an optimized tensor library for deep learning using GPUs and CPUs.
  doc_url: https://pytorch.org/docs/stable/index.html
  dev_url: https://github.com/pytorch/pytorch

extra:
  recipe-maintainers:
    - hadim
