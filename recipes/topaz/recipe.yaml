schema_version: 1

context:
  name: topaz
  version: 0.3.13
  sha256: 108912a6b60c909fe443a92ae80ceb69c4d0f2f1cecc78097cd4c11417cd41ef

recipe:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/tbepler/topaz/archive/refs/tags/v${{ version }}.tar.gz
  sha256: ${{ sha256 }}

build:
  noarch: python
  script: python -m pip install . --no-deps --ignore-installed -vv

outputs:
  - package:
      name: ${{ name }}
      version: ${{ version }}
    build:
      noarch: python
      script: python -m pip install . --no-deps --ignore-installed -vv
    requirements:
      host:
        - python>=3.8,<3.14
        - pip
        - setuptools
        - wheel
      run:
        - python >=3.8,<3.14
        - future
        - pytorch >=2.0
        - torchvision
        - numpy >=1.11
        - tqdm >=4.65.0
        - scipy >=0.17.0
        - pandas >=0.20.3
        - h5py >=3.7.0
        - pillow >=6.2.0
        - scikit-learn >=0.19.0
      run_constraints:
        - if: linux
          then: cuda-version >=11.8
    tests:
      - python:
          imports:
            - topaz
          pip_check: false
      - script:
          - topaz --help
    about:
      license: GPL-3.0-only
      license_file: LICENSE
      summary: Deep learning-based particle picker for cryo-EM.
      homepage: https://github.com/tbepler/topaz
    extra:
      recipe-maintainers:
        - PertuyF
  - package:
      name: ${{ name }}-gpu
      version: ${{ version }}
    build:
      noarch: generic
    requirements:
      run:
        - ${{ name }} ==${{ version }}
        - cudatoolkit >=11.0
    tests:
      - python:
          imports:
            - topaz
          pip_check: false
      - script:
          - topaz --help
    about:
      license: GPL-3.0-only
      license_file: LICENSE
      summary: Metapackage for topaz with CUDA runtime.
      homepage: https://github.com/tbepler/topaz
    extra:
      recipe-maintainers:
        - PertuyF

about:
  license: GPL-3.0-only
  license_file: LICENSE
  summary: Deep learning-based particle picker for cryo-EM.
  homepage: https://github.com/tbepler/topaz

