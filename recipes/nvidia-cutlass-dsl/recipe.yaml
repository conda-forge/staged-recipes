# Recipe for nvidia-cutlass-dsl - NVIDIA's CuTe DSL for high-performance CUDA kernels
# Unfortunately these can't be built from the cutlass repo...
# we need to repackage the binaries in the pypi wheels

context:
  name: nvidia-cutlass-dsl
  version: "4.3.5"

package:
  name: ${{ name }}
  version: ${{ version }}

# This is super hacky but conda-forge CI blocks doing a pip download in the build
# and only binary wheels are published
source:
  # Linux x86_64 wheels
  - if: linux and x86_64 and match(python, "~=3.10.0")
    then:
      url: https://files.pythonhosted.org/packages/e7/92/3f39b64341e2b16dedc7434e7b63a8f457a6fdbd023346d2f00276943495/nvidia_cutlass_dsl-${{ version }}-cp310-cp310-manylinux_2_28_x86_64.whl
      sha256: 776f54fa72333bc8fca274e59b70552adbcd85aaef603c7d58a79ef284890046
  - if: linux and x86_64 and match(python, "~=3.11.0")
    then:
      url: https://files.pythonhosted.org/packages/54/b5/d2f08919a9aa9052d45b2c8adfc310a724e9474e39c612358b1b24282c54/nvidia_cutlass_dsl-${{ version }}-cp311-cp311-manylinux_2_28_x86_64.whl
      sha256: 7a792f02ce548f311a3df313a7cdb4ac4ec1cccb6c7ff9cd68d5470b25a6daf6
  - if: linux and x86_64 and match(python, "~=3.12.0")
    then:
      url: https://files.pythonhosted.org/packages/76/cb/998e79b6f028268bf2653250deb4a2edb618db81244e549ced71112c6f85/nvidia_cutlass_dsl-${{ version }}-cp312-cp312-manylinux_2_28_x86_64.whl
      sha256: 4687eef20c405023daa99dd4653a292fd875d6c9486f8d9a069ff6fcdb00834f
  - if: linux and x86_64 and match(python, "~=3.13.0")
    then:
      url: https://files.pythonhosted.org/packages/0f/16/41b88ded92648d99f3c83880c07a54475feded9b32b4425e30d4b34f6c63/nvidia_cutlass_dsl-${{ version }}-cp313-cp313-manylinux_2_28_x86_64.whl
      sha256: 11d19b7e56ae1bedaf736ea3965af3be1e7af6c2482989c414b606cdd406cf32
  # Linux aarch64 wheels
  - if: linux and aarch64 and match(python, "~=3.10.0")
    then:
      url: https://files.pythonhosted.org/packages/52/3a/89f70082c24d3b88316df9b16df861e1f2cc86389a7b36a670bc7c541977/nvidia_cutlass_dsl-${{ version }}-cp310-cp310-manylinux_2_28_aarch64.whl
      sha256: b4fcc50dbf9f9c6d1f4d6e1748e366c6835c95bea7b54f7111bfa6e66230f74b
  - if: linux and aarch64 and match(python, "~=3.11.0")
    then:
      url: https://files.pythonhosted.org/packages/e8/93/9114f28351d55061d30c68dbec3ba49659ac65607966029f52dab66950e9/nvidia_cutlass_dsl-${{ version }}-cp311-cp311-manylinux_2_28_aarch64.whl
      sha256: 6de9a4a7150ad1832fb8c862c92df4836f347690e4c085e9044160c846010b59
  - if: linux and aarch64 and match(python, "~=3.12.0")
    then:
      url: https://files.pythonhosted.org/packages/78/6c/f45c930f662e0ec7856baa5d4e6f4d1e2ca6b029678f9e05d2df54c865be/nvidia_cutlass_dsl-${{ version }}-cp312-cp312-manylinux_2_28_aarch64.whl
      sha256: 6a79e94d157b16ab34069dd73fb708ff0ef31f486d699b6d5a015217f754cb0b
  - if: linux and aarch64 and match(python, "~=3.13.0")
    then:
      url: https://files.pythonhosted.org/packages/97/09/78a2f9141006f6f1e371a3dfb7a921205bcad6fb27810731169939d3e63d/nvidia_cutlass_dsl-${{ version }}-cp313-cp313-manylinux_2_28_aarch64.whl
      sha256: 9343a5c1335169d791b05aac6fb81e33d7f17c4f8250613a091e6ee8314ed6aa

build:
  number: 0
  script: python -m pip install *.whl --no-deps --no-build-isolation -vv
  # Only Linux is supported (no macOS or Windows wheels available)
  # Wheels only available for Python 3.10-3.13
  skip:
    - win
    - osx
    - match(python, "<3.10")
    - match(python, ">=3.14")
  # These are prebuilt wheels so can't use patchelf since they weren't built w/ a prefix placeholder
  dynamic_linking:
    binary_relocation: false

requirements:
  host:
    - python
    - pip
    - setuptools
  run:
    - python
    - numpy
    - typing_extensions
    - cuda-python >=12.8

tests:
  - python:
      imports:
        - cutlass
        - cutlass.cute
      pip_check: true

about:
  homepage: https://github.com/NVIDIA/cutlass
  summary: NVIDIA CuTe DSL for writing high-performance CUDA kernels
  description: |
    nvidia-cutlass-dsl provides a Python-native interface for writing high-performance
    CUDA kernels based on core CUTLASS and CuTe concepts. It includes MLIR-based
    compilation infrastructure with native integration with deep learning frameworks.
  license: LicenseRef-NvidiaProprietary
  license_file: LICENSE

extra:
  recipe-maintainers:
    - iamthebot

