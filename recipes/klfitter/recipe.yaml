context:
  version: "1.4.0"

package:
  name: klfitter
  version: ${{ version }}

source:
  url: https://github.com/KLFitter/KLFitter/archive/refs/tags/v${{ version }}.tar.gz
  sha256: 660fea5c195cd872d0a4cdfdc4c7a566612882a3afefb58a37ffde99d711a75a
  patches:
    - 1.4.0-cmake-minimum.patch
    - 1.4.0-cmake-flags.patch
    - 1.4.0-cmake-config.patch
    - configurable-static-library-build.patch

build:
  number: 0
  skip:
    - win
  script:
    content: |
      export BATINSTALLDIR="${PREFIX}"
      cmake ${CMAKE_ARGS} \
        -DBUILTIN_BAT=FALSE \
        -DINSTALL_TESTS=OFF \
        -DINSTALL_EXAMPLES=OFF \
        -DCMAKE_CXX_STANDARD=$(root-config --cxxstandard) \
        -DBUILD_STATIC_LIBS=OFF \
        -S . \
        -B build
      cmake build -LH
      cmake --build build --parallel "${CPU_COUNT}"
      cmake --install build

requirements:
  build:
    - ${{ compiler("c") }}
    - ${{ compiler("cxx") }}
    - ${{ stdlib("c") }}
    - cmake  # cmake >=3.1
    - make
  host:
    - root_base
    - bayesian-analysis-toolkit
  run:
    - root_base
    - bayesian-analysis-toolkit

tests:
  - package_contents:
      strict: true
      lib:
        - KLFitter
      include:
        - KLFitter/BoostedLikelihoodTopLeptonJets.h
        - KLFitter/DetectorAtlas_7TeV.h
        - KLFitter/DetectorAtlas_8TeV.h
        - KLFitter/DetectorAtlas_CrystalBall.h
        - KLFitter/DetectorBase.h
        - KLFitter/DetectorSnowmass.h
        - KLFitter/Fitter.h
        - KLFitter/LikelihoodBase.h
        - KLFitter/LikelihoodOneHadronicTop.h
        - KLFitter/LikelihoodSgTopWtLJ.h
        - KLFitter/LikelihoodTTHLeptonJets.h
        - KLFitter/LikelihoodTTZTrilepton.h
        - KLFitter/LikelihoodTopAllHadronic.h
        - KLFitter/LikelihoodTopDilepton.h
        - KLFitter/LikelihoodTopLeptonJets.h
        - KLFitter/LikelihoodTopLeptonJetsUDSep.h
        - KLFitter/LikelihoodTopLeptonJets_Angular.h
        - KLFitter/LikelihoodTopLeptonJets_JetAngles.h
        - KLFitter/LikelihoodTwoTracks.h
        - KLFitter/Particles.h
        - KLFitter/Permutations.h
        - KLFitter/PhysicsConstants.h
      files:
        - lib/cmake/KLFitter/KLFitterConfig-release.cmake
        - lib/cmake/KLFitter/KLFitterConfig.cmake
        - share/KLFitter/transferfunctions/snowmass/par_energy_electrons_eta1.txt
        - share/KLFitter/transferfunctions/snowmass/par_energy_electrons_eta2.txt
        - share/KLFitter/transferfunctions/snowmass/par_energy_jets_eta1.txt
        - share/KLFitter/transferfunctions/snowmass/par_energy_jets_eta2.txt
        - share/KLFitter/transferfunctions/snowmass/par_energy_jets_eta3.txt
        - share/KLFitter/transferfunctions/snowmass/par_misset.txt
        - share/KLFitter/transferfunctions/snowmass/par_pt_muons_eta1.txt
        - share/KLFitter/transferfunctions/snowmass/par_pt_muons_eta2.txt

about:
  homepage: https://github.com/KLFitter/KLFitter
  summary: Kinematic Likelihood Fitter for top quark physics
  description: |
    KLFitter is a library for kinematic fitting using a likelihood
    approach, primarily used for reconstructing particle decay
    topologies in high-energy physics experiments.
  license: LGPL-3.0-or-later
  license_file:
    - COPYING
    - COPYING.LESSER
  repository: https://github.com/KLFitter/KLFitter

extra:
  recipe-maintainers:
    - chrisburr
    - kratsg
    - matthewfeickert
