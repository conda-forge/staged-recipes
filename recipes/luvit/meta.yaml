{% set name = "luv" %}
{% set version = "1.44.2-0" %}
{% set conda_version =  version.replace("-", ".") %}
{% set compat53_version = 0.9 %}

package:
  # Ideally we build a variant for lua/luajit
  name: {{ name|lower }}-luajit
  version: {{ conda_version }}

source:
  - url: https://github.com/luvit/luv/archive/refs/tags/{{ version }}.tar.gz
    sha256: 44ccda27035bfe683e6325a2a93f2c254be1eb76bde6efc2bd37c56a7af7b00a
    folder: luv
  - url: https://github.com/lunarmodules/lua-compat-5.3/archive/refs/tags/v{{ compat53_version }}.tar.gz
    sha256: ad05540d2d96a48725bb79a1def35cf6652a4e2ec26376e2617c8ce2baa6f416
    folder: compat53

build:
  number: 0
  skip: true  # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - cmake
    - make
  host:
    - libuv
    - luajit
  run:
    - libuv  # Missing run_export from libuv

test:
  requires:
    - luajit
  files:
    - test.sh
  commands:
    - test -f "${PREFIX}/lib/libluv${SHLIB_EXT}"
    - test -f "${PREFIX}/include/luv/luv.h"
    - bash test.sh

about:
  home: https://luvit.io
  summary:  Bare libuv bindings for lua.
  license: Apache-2 AND MIT
  license_file:
    - luv/LICENSE.txt
    - compat53/LICENSE
  doc_url: https://github.com/luvit/luv/blob/master/docs.md
  dev_url: https://github.com/luvit/luv.txt

extra:
  recipe-maintainers:
    - AntoinePrv
    - tdejager
