{% set name = "mattergen" %}
{% set version = "1.0.3" %}
{% set python_min = "3.10" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/microsoft/mattergen/archive/refs/tags/v{{ version }}.tar.gz
  sha256: e2f1a651f6b777346c515e746f817f0a9837ccb7586ed6482d993054b408c96b
  patches:
    - gh-197.patch

build:
  noarch: python
  entry_points:
    - mattergen-generate = mattergen.scripts.generate:_main
    - mattergen-train = mattergen.scripts.run:mattergen_main
    - mattergen-finetune = mattergen.scripts.finetune:mattergen_finetune
    - mattergen-evaluate = mattergen.scripts.evaluate:_main
    - csv-to-dataset = mattergen.scripts.csv_to_dataset:main
  script: {{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  number: 0

requirements:
  host:
    - python {{ python_min }}
    - setuptools >=77.0.3
    - pip
  run:
    - python >={{ python_min }}
    - ase >=3.22.1
    - autopep8
    - cachetools
    - contextlib2
    - emmet-core >=0.84.2
    - fire
    - huggingface_hub
    - hydra-core >=1.3.1,<2
    - hydra-joblib-launcher >=1.1.5,<2
    - jupyterlab >=4.2.5
    - python-lmdb
    - matplotlib-base ==3.8.4
    - matscipy >=0.7.0
    - mattersim >=1.1
    - monty >=2024.7.30
    - notebook >=7.2.2
    - numpy
    - omegaconf >=2.3.0,<3
    - pymatgen >=2024.6.4
    - pylint
    - pytest
    - pytorch-lightning >=2.0.6,<2.1
    - seaborn >=0.13.2
    - setuptools
    - smact
    - sympy >=1.11.1
    - pytorch >=2.4.1
    - torchvision >=0.19.1
    - torchaudio >=2.4.1
    - pytorch_cluster
    - torch-geometric >=2.5
    - torch-scatter
    - pytorch_sparse
    - tqdm
    - wandb >=0.10.33

test:
  imports:
    - mattergen
  commands:
    - test -d $SP_DIR/mattergen/conf
    - mattergen-generate --help
    - mattergen-train --help
    - mattergen-finetune --help
    - mattergen-evaluate --help
    - csv-to-dataset --help
  requires:
    - python {{ python_min }}

about:
  home: https://github.com/microsoft/mattergen
  summary: MatterGen is a generative model for inorganic materials design across the periodic table that can be fine-tuned to steer the generation towards a wide range of property constraints.
  license: MIT
  license_file:
    - LICENSE
    - NOTICE

extra:
  recipe-maintainers:
    - awvwgk
