{% set version = "2.3.1" %}
{% set posix = "m2-" if win else "" %}

package:
  name: r-deeptime
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/deeptime_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/deeptime/deeptime_{{ version }}.tar.gz
  sha256: 36fbe33cd02b9ef4cf01f686436223778d4cddd0d034423c08503b4dec8d7a03

build:
  number: 0
  noarch: generic
  rpaths:
    - lib/R/lib/
    - lib/
  missing_dso_whitelist:
    - '*/R.dll'        # [win]
    - '*/Rblas.dll'    # [win]
    - '*/Rlapack.dll'  # [win]

requirements:
  build:
    - {{ posix }}zip  # [win]
    - cross-r-base {{ r_base }}  # [build_platform != target_platform]
  host:
    - r-base
    - r-cli
    - r-curl
    - r-deeptimedata
    - r-ggfittext
    - r-ggforce
    - r-ggh4x
    - r-ggplot2 >=3.5.0
    - r-grimport2
    - r-gridextra
    - r-gtable
    - r-lattice
    - r-lifecycle
    - r-rlang >=1.1.0
    - r-scales
  run:
    - r-base
    - r-cli
    - r-curl
    - r-deeptimedata
    - r-ggfittext
    - r-ggforce
    - r-ggh4x
    - r-ggplot2 >=3.5.0
    - r-grimport2
    - r-gridextra
    - r-gtable
    - r-lattice
    - r-lifecycle
    - r-rlang >=1.1.0
    - r-scales

test:
  requires:
    - r-testthat
  source_files:
    - tests/
  commands:
    - $R -e "library('deeptime')"  # [not win]
    - $R -e "testthat::test_file('tests/testthat.R', stop_on_failure=TRUE)"  # [not win]
    - "\"%R%\" -e \"library('deeptime')\""  # [win]
    - "\"%R%\" -e \"testthat::test_file('tests/testthat.R', stop_on_failure=TRUE)\""  # [win]

about:
  home: https://github.com/willgearty/deeptime
  license: GPL-3.0-or-later
  summary: Facilitates highly customizable and reproducible visualizations of data over geological time intervals
  description: |
    Extends the functionality of other plotting packages (notably 'ggplot2')
    to help facilitate the plotting of data over long time intervals,
    including, but not limited to, geological, evolutionary, and ecological data.
    The primary goal of 'deeptime' is to enable users to add highly customizable
    timescales to their visualizations.
    Other functions are also included to assist with other areas of deep time
    visualization.
  license_family: GPL
  license_file:
    - '{{ environ["PREFIX"] }}/lib/R/share/licenses/GPL-3'
  dev_url: https://github.com/willgearty/deeptime
  doc_url: http://williamgearty.com/deeptime/

extra:
  recipe-maintainers:
    - conda-forge/r
    - willgearty
