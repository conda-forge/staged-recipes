context:
  name: mamba-ssm
  version: 2.2.5

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/state-spaces/mamba/archive/refs/tags/v${{ version }}.tar.gz
  sha256: 1e072841619af9c171709b2c6ff17daa0d9bf7caf0fcb083f5c11754b63c6cdb

build:
  number: 0
  script:
    env:
      MAMBA_FORCE_BUILD: "TRUE"
    content: ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  skip:
    # mamba-ssm requires CUDA (or ROCm) GPU
    - cuda_compiler_version == "None"

requirements:
  host:
    - ninja
    - packaging
    - pip
    - python
    - pytorch * cuda*
    - setuptools >=61.0.0
    - triton
    - wheel
  run:
    - einops
    - packaging
    - python
    - pytorch
    - setuptools >=61.0.0
    - transformers

tests:
  - python:
      imports:
        - mamba_ssm
      # disabled pip check because ninja is not available
      # see https://github.com/conda-forge/ninja-feedstock/issues/26
      pip_check: false

about:
  summary: Mamba state-space model
  license: Apache-2.0
  license_file: LICENSE
  homepage: https://github.com/state-spaces/mamba

extra:
  recipe-maintainers:
    - weiji14
