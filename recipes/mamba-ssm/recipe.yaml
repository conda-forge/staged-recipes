context:
  name: mamba-ssm
  version: 2.2.4

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/${{ name[0] }}/${{ name }}/mamba_ssm-${{ version }}.tar.gz
  sha256: e4114c69302796c91b71e90032c2d974f611608fab331582a80de6eaf075efb9

build:
  number: 0
  script: ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  skip:
    # mamba-ssm requires CUDA (or ROCm) GPU
    - cuda_compiler_version == "None"
    # CUDA < 12 not supported by pytorch anymore
    - cuda_compiler_version == "11.8"

requirements:
  host:
    - ninja
    - packaging
    - pytorch * cuda*
    - pip
    - python
    - setuptools >=61.0.0
    # Remove triton<3.2.0 pin when https://github.com/triton-lang/triton/pull/6570
    # is available in a triton>3.3.0 release.
    - triton <3.2.0
    - wheel
  run:
    - einops
    - packaging
    - python
    - pytorch
    - setuptools >=61.0.0
    - transformers

tests:
  - python:
      imports:
        - mamba_ssm
      # disabled pip check because ninja is not available
      # see https://github.com/conda-forge/ninja-feedstock/issues/26
      pip_check: false

about:
  summary: Mamba state-space model
  license: Apache-2.0
  license_file: LICENSE
  homepage: https://github.com/state-spaces/mamba

extra:
  recipe-maintainers:
    - weiji14
