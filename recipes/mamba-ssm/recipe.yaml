context:
  name: mamba-ssm
  version: 2.2.4

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/${{ name[0] }}/${{ name }}/mamba_ssm-${{ version }}.tar.gz
  sha256: e4114c69302796c91b71e90032c2d974f611608fab331582a80de6eaf075efb9

build:
  number: 0
  script: ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  skip:
    # mamba-ssm requires CUDA (or ROCm) GPU
    - cuda != "true"
    # CUDA < 12 not supported by pytorch anymore
    - cuda == "true" and match(cuda_compiler_version, "<12")

requirements:
  host:
    - ninja
    - packaging
    - pytorch
    - pip
    - python >=3.9
    - setuptools >=61.0.0
    - wheel
  run:
    - einops
    - packaging
    - python >=3.9
    - pytorch
    - setuptools >=61.0.0
    - transformers

tests:
  - python:
      imports:
        - mamba_ssm
      pip_check: true

about:
  summary: Mamba state-space model
  license: Apache-2.0
  license_file: LICENSE
  homepage: https://github.com/state-spaces/mamba

extra:
  recipe-maintainers:
    - weiji14
