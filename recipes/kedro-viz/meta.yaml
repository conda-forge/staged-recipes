{% set name = "kedro-viz" %}
{% set version = "6.4.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/kedro-org/{{ name }}/archive/refs/tags/v{{ version }}.tar.gz
  sha256: 3fb5b867e319e171cb6cb8dba399f86407847c077262bc4fe4b1a2415fe18c85

build:
  noarch: python
  script: 
    - rm -rf build build dist kedro_viz/html pip-wheel-metadata kedro_viz.egg-info
    - cp -R {{ RECIPE_DIR }}/package.json {{ SRC_DIR }}/package.json
    - echo {" --------------------------------------------------------this replaces the metadata-code-themes.scss in the /src/components/metadata/styles/--------------------------------------------------------"}
    - cp {{ RECIPE_DIR }}/metadata-code-themes.scss {{ SRC_DIR }}/src/components/metadata/styles/metadata-code-themes.scss
    - echo {" --------------------------------------------------------this adds the a11y-light.css in the metadata/styles dir--------------------------------------------------------"}
    - cp {{ RECIPE_DIR }}/a11y-light.css {{ SRC_DIR }}/src/components/metadata/styles/a11y-light.css
    - echo {" --------------------------------------------------------this adds the a11y-dark.css in the metadata/styles dir- --------------------------------------------------------"}
    - cp {{ RECIPE_DIR }}/a11y-dark.css {{ SRC_DIR }}/src/components/metadata/styles/a11y-dark.css
    #- cp -R {{ RECIPE_DIR }}/src {{ SRC_DIR }}/src
    - npm install sass react-scripts
    - NODE_OPTIONS=--openssl-legacy-provider npm run build
    #- npm run build
    - cp -R build {{ SRC_DIR }}/package/kedro_viz/html
    - {{ PYTHON }} -m pip install ./package -vv
  number: 0

requirements:
  build:
    - nodejs >16.0,<17.0
  host:
    - python >=3.7,<3.11
    - pip
    - nodejs >16.0,<17.0
    - yarn
  run:
    - python >=3.7,<3.11
    - semver >=2.10
    - kedro >=0.17.5
    - ipython >=7.0.0,<9.0
    - fastapi >=0.73.0,<0.96.0
    - fsspec >=2021.4,<2024.1
    - aiofiles ==22.1.0  # Pinned to 22.1.0
    - uvicorn >=0.22.0,<0.23.0  # Limited to <0.23.0
    - watchgod >=0.8.2,<0.9.0
    - plotly >=4.0
    - pandas >=0.24
    - sqlalchemy >=1.4,<3
    - strawberry-graphql >=0.192.0,<1.0
    - networkx >=1.0
    - orjson >=3.9,<4.0
    - secure >=0.3.0

test:
  imports:
    - kedro_viz

about:
  home: https://github.com/kedro-org/kedro-viz
  summary: Kedro-Viz helps visualise Kedro data and analytics pipelines
  license: Apache-2.0
  license_file:
    - COPYING.txt
    - LICENSE.md

extra:
  recipe-maintainers:
    - rxm7706
