{% set version = "3.3" %}

package:
    name: opensim
    version: {{ version }}

source:
    fn: OpenSim-{{ version }}-source.zip
    url: https://simtk.org/frs/download_start.php/file/5025/OpenSim-{{ version }}-source.zip
    sha256: 597482e78202f8480d205f10084ca4663236d76aa59de00a0408cdefbac43e7c

build:
    number: 200
    # NOTE : For C++11 builds, vc14/VS 2015 are the only acceptable targets
    # which only Python 3.5 supports. So skip previous Python versions.
    skip: true                # [win and not py35]
    features:
        - vc14                # [win and py35]
    # NOTE : This is needed to ensure the paths to Simbody's binaries, like
    # simbody-visualizer, are corrected.
    detect_binary_files_with_prefix: true

# TODO: Doxygen is the only dependency that is omitted here, so the rendered
# documentation is not built.
requirements:
    build:
        - toolchain
        - cmake >=2.8.6
        - simbody 3.5.4
        - python                  # [win]
    run:
        - simbody 3.5.4
test:
  requires:
    - python 3.5.*  # [win and py35]
  #commands:
    #- test -f $PREFIX/libexec/simbody/simbody-visualizer              # [unix]
    #- if not exist %LIBRARY_BIN%\\simbody-visualizer.exe exit 1       # [win]
    #- test -f $PREFIX/include/simbody/Simbody.h                       # [unix]
    #- test -f $PREFIX/include/simbody/SimTKcommon.h                   # [unix]
    #- test -f $PREFIX/include/simbody/SimTKlapack.h                   # [unix]
    #- test -f $PREFIX/include/simbody/SimTKmath.h                     # [unix]
    #- test -f $PREFIX/include/simbody/SimTKsimbody_aux.h              # [unix]
    #- test -f $PREFIX/include/simbody/SimTKsimbody.h                  # [unix]
    #- if not exist %LIBRARY_INC%\\Simbody.h exit 1                    # [win]
    #- if not exist %LIBRARY_INC%\\SimTKcommon.h exit 1                # [win]
    #- if not exist %LIBRARY_INC%\\SimTKlapack.h exit 1                # [win]
    #- if not exist %LIBRARY_INC%\\SimTKmath.h exit 1                  # [win]
    #- if not exist %LIBRARY_INC%\\SimTKsimbody_aux.h exit 1           # [win]
    #- if not exist %LIBRARY_INC%\\SimTKsimbody.h exit 1               # [win]
    #- test -f $PREFIX/lib/libSimTKcommon.so                           # [linux]
    #- test -f $PREFIX/lib/libSimTKmath.so                             # [linux]
    #- test -f $PREFIX/lib/libSimTKsimbody.so                          # [linux]
    #- test -f $PREFIX/lib/libSimTKcommon.dylib                        # [osx]
    #- test -f $PREFIX/lib/libSimTKmath.dylib                          # [osx]
    #- test -f $PREFIX/lib/libSimTKsimbody.dylib                       # [osx]
    #- if not exist %LIBRARY_BIN%\\SimTKcommon.dll exit 1              # [win]
    #- if not exist %LIBRARY_BIN%\\SimTKmath.dll exit 1                # [win]
    #- if not exist %LIBRARY_BIN%\\SimTKsimbody.dll exit 1             # [win]

about:
    home: http://opensim.stanford.edu
    license: Apache-2.0
    summary: >
        OpenSim is software that lets users develop models of musculoskeletal
        structures and create dynamic simulations of movement.

extra:
    recipe-maintainers:
        - moorepants
