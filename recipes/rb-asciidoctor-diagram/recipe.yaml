# Recipe for asciidoctor-diagram Ruby gem
# A family of Asciidoctor extensions that generate images from a broad range of embedded plain text diagram descriptions
schema_version: 1

context:
  name: asciidoctor-diagram
  version: "3.0.1"
  ruby_version: "3.4.0"

package:
  name: rb-${{ name|lower }}
  version: ${{ version }}

source:
  url: https://rubygems.org/downloads/${{ name }}-${{ version }}.gem
  sha256: a91bde8ef01b0c1c114ca5404b9c3b95ae930980167ffd477d49150cf610f4a4

build:
  noarch: generic
  number: 0
  script:
    interpreter: nu
    content:
      - mkdir $"($env.PREFIX)/lib/ruby/gems/${{ ruby_version }}"
      - let gem_dir = ($env.PREFIX | path join "lib" "ruby" "gems" "${{ ruby_version }}")
      - ^($env.PREFIX | path join "bin" "gem") install -N -l -V --norc --ignore-dependencies --install-dir $gem_dir -n ($env.PREFIX | path join "bin") ${{ name }}-${{ version }}.gem
      - ^($env.PREFIX | path join "bin" "gem") unpack ${{ name }}-${{ version }}.gem
      - cp ${{ name }}-${{ version }}/LICENSE.txt .

requirements:
  build:
    - nushell ==0.106.1
    - ruby ==${{ ruby_version }}
  host:
    - ruby >=2.7,<4.0
  run:
    - ruby >=2.7,<4.0
    - asciidoctor >=1.5.7,<3.0
    - rb-rexml >=3.2.5

tests:
  - script:
      - ruby -r 'asciidoctor-diagram'
    requirements:
      run:
        - ruby >=2.7,<4.0

about:
  homepage: https://github.com/asciidoctor/asciidoctor-diagram
  license: MIT
  license_file: LICENSE.txt
  summary: Asciidoctor diagramming extension
  description: |
    A family of Asciidoctor extensions that generate images from a broad range of
    embedded plain text diagram descriptions, including PlantUML, ditaa, Kroki,
    and many others. The extension supports AsciiToSVG, BlockDiag (BlockDiag,
    SeqDiag, ActDiag, NwDiag), Ditaa, Erd, GraphViz, Mermaid, Msc, PlantUML,
    Shaape, SvgBob, Syntrax, UMLet, Vega, Vega-Lite and WaveDrom.
  documentation: https://docs.asciidoctor.org/diagram-extension/latest/
  repository: https://github.com/asciidoctor/asciidoctor-diagram

extra:
  recipe-maintainers:
    - conda-forge/ruby
