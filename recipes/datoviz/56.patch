From cb26f64243574625bbd9f8a84d92a246baf116a5 Mon Sep 17 00:00:00 2001
From: Mark Harfouche <mark.harfouche@gmail.com>
Date: Sun, 25 Jun 2023 13:09:54 -0400
Subject: [PATCH] Make IPython an optional dependency

---
 bindings/cython/datoviz/__init__.py | 11 +++++++----
 bindings/cython/requirements.txt    |  1 -
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/bindings/cython/datoviz/__init__.py b/bindings/cython/datoviz/__init__.py
index 94da4475..6d8c832f 100644
--- a/bindings/cython/datoviz/__init__.py
+++ b/bindings/cython/datoviz/__init__.py
@@ -7,9 +7,6 @@
 import time
 import __main__ as main
 
-from IPython import get_ipython
-from IPython.terminal.pt_inputhooks import register
-
 try:
     from .pydatoviz import App, colormap, colorpal, demo
 except ImportError:
@@ -113,6 +110,7 @@ def inputhook(context):
 
 
 def enable_ipython():
+    from IPython import get_ipython
     ipython = get_ipython()
     if ipython:
         logger.info("Enabling Datoviz IPython event loop integration")
@@ -139,7 +137,12 @@ def is_interactive():
 
 
 # print(f"In IPython: {in_ipython()}, is interactive: {is_interactive()}")
-register('datoviz', inputhook)
+try:
+    from IPython.terminal.pt_inputhooks import register
+
+    register('datoviz', inputhook)
+except ImportError:
+    pass
 
 
 # Event loops
diff --git a/bindings/cython/requirements.txt b/bindings/cython/requirements.txt
index c2c93a88..6643ed6c 100644
--- a/bindings/cython/requirements.txt
+++ b/bindings/cython/requirements.txt
@@ -1,4 +1,3 @@
 numpy
-ipython
 imageio
 colorcet
